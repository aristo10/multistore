import{cL as S,r as n,cM as P,cN as e,cV as M,dd as I}from"./vendor-3a94a37a.js";import{Q as L,ae as v,s as U,bP as C,bR as E,bS as F,L as D,aX as y,bU as _}from"./index-ed7845ca.js";import{U as A}from"./UploaderWithDrag-568744bd.js";import{M as T}from"./vendor-large-f75deccb.js";function O({selectedImage:c,setSelectedImage:d,isMultiple:u,maxCount:x,filter:h={}}){const m=S(),[i,b]=n.useState({page:1,count:15,...h}),{list:l,loading:g,total:j}=P(s=>s.media),o=s=>{if(u){if(x&&c.length>=x){M.error(`You can select maximum ${x} images`);return}const t=c.find(a=>a.id===s.id);d(t?a=>a.filter(f=>f.id!==s.id):a=>[...a,s])}else d([s])};let r=null;g?r=e.jsx(D,{}):(l==null?void 0:l.length)>0&&(r=e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(s=>{const t=c.find(w=>w.id===s.id),{isImage:a,typeText:f}=L(s.fileType);return e.jsx("div",{onClick:()=>o(s),className:v("border-2 border-transparent h-[100px] w-[100px] relative cursor-pointer overflow-hidden bg-slate-400/20",{"border-blue-500":t}),children:a?e.jsx("img",{src:`${window.env.VITE_APP_API}/media/view/${s.id}`,alt:s.fileName,className:"content-center w-full h-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg font-semibold text-blue-600 opacity-20 h-full w-full flex justify-center items-center",children:e.jsx("span",{children:f})}),e.jsxs("span",{className:"absolute bottom-0 left-0 p-1 text-xs font-semibold",children:[e.jsx("div",{className:"mb-0.5",children:U(s.fileName,60)}),e.jsx("a",{href:window.env.VITE_APP_API+"/media/view/"+s.id,download:!0,target:"_blank",rel:"noreferrer",className:"text-blue-500 hover:text-blue-600",children:e.jsx("span",{className:`
                    px-2 py-0.5 bg-blue-500 text-white rounded-md hover:bg-blue-600
                    `,children:"Download"})})]})]})},s.id)})})})),n.useEffect(()=>{m(C(i))},[m,i]);const p=(s,t)=>{b(a=>({...a,page:s,count:t}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-2  justify-between  pb-2 sticky top-0 bg-white w-full",children:[e.jsx(E,{setPageConfig:b}),e.jsx(F,{defaultPageSize:i.count,onChange:p,total:j})]}),r]})}function R({isOpen:c,isMultiple:d=!1,onInsert:u,maxCount:x,button:h,filter:m}){const i=S(),[b,l]=n.useState(c),[g,j]=n.useState([]),[o,r]=n.useState("gallery"),[p,s]=n.useState([]),[t,a]=n.useState(!1),f=()=>{u&&u(p),s([]),l(!1)},w=async()=>{a(!0);const N=new FormData;g.forEach(k=>{N.append("files[]",k.originFileObj)}),(await i(_(N))).payload.message==="success"&&(r("gallery"),j([]),i(C({page:1,count:10}))),a(!1)};return e.jsxs(e.Fragment,{children:[h?e.jsx("span",{onClick:()=>l(!0),children:h}):e.jsx("div",{onClick:()=>l(!0),className:"bg-gray-300 rounded w-[100px] h-[100px] flex items-center justify-center cursor-pointer",children:e.jsx(I,{size:30,className:"text-blue-500"})}),e.jsx(T,{title:"Insert Media",width:window.innerWidth>768?"80%":"100%",className:"imageGalleryModal",centered:!0,open:b,footer:null,onCancel:()=>l(!1),children:e.jsxs("div",{className:"flex flex-col h-[calc(95vh-60px)] md:h-[calc(85vh-60px)]",children:[e.jsxs("div",{className:"border-b shadow-[0,10px,15px,-3px,rgba(0,0,0,0.1),0,4px,6px,-4px,rgba(0,0,0,0.1)]",children:[e.jsx("button",{onClick:()=>r("gallery"),className:v("px-2",{"border-b-blue-500 border-b-2 font-medium":o==="gallery"}),children:"Media"}),e.jsx("button",{onClick:()=>r("upload"),className:v("px-2",{"border-b-blue-500 border-b-2 font-medium":o==="upload"}),children:"Upload"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto my-2 relative",children:o==="gallery"?e.jsx(O,{selectedImage:p,setSelectedImage:s,isMultiple:d,maxCount:x,filter:m}):e.jsx(A,{fileList:g,setFileList:j})}),e.jsx("div",{children:e.jsx("div",{className:"flex justify-end gap-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{disabled:t,color:"gray",onClick:()=>l(!1),children:"Cancel"}),o==="gallery"?e.jsx(y,{disabled:p.length<=0,onClick:f,color:"primary",children:"Insert"}):e.jsx(y,{loading:t,onClick:w,color:"primary",children:"Upload"})]})})})]})})]})}export{R as M};
