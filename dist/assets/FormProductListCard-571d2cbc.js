import{cN as e,r as w,d4 as E,dd as K,cM as T,d9 as O}from"./vendor-3a94a37a.js";import{ae as k,bk as M,C as q}from"./index-ed7845ca.js";import{B as I}from"./BigDrawer-240149a9.js";import{A as R}from"./AddProductAttribute-4ec2c5fe.js";import{A as B}from"./AddProductAttributeValue-d16feddc.js";import{b as V,d as D,F as f,I as A}from"./vendor-large-f75deccb.js";import{M as z}from"./MediaGallery-5095f29f.js";const $=t=>{const{label:r,closable:l,onClose:s}=t,o=a=>{a.preventDefault(),a.stopPropagation()};return e.jsx(D,{onMouseDown:o,closable:l,onClose:s,style:{marginRight:3},children:r})},L=({name:t,data:r,attributeValue:l,attributeValueHandler:s})=>{var x;const a=r.filter(i=>i.status==="true").map(i=>({id:i.id,label:i.name,value:i.name})),u=i=>{const j=i.map(v=>a.find(S=>S.value===v).id);s(t,j)},h=(x=l[t])==null?void 0:x.map(i=>{var j;return(j=r.find(v=>v.id==i))==null?void 0:j.name});return e.jsx(V,{mode:"multiple",tagRender:$,style:{width:"100%"},defaultValue:h,maxTagCount:0,options:a,maxTagPlaceholder:i=>i.length+" items Selected",placeholder:"Nothing Selected",onChange:u})},_=t=>{const{label:r,closable:l,onClose:s}=t,o=a=>{a.preventDefault(),a.stopPropagation()};return e.jsx(D,{onMouseDown:o,closable:l,onClose:s,style:{marginRight:3},children:r})},H=({data:t,attributes:r,attributesHandler:l})=>{const o=t.map(u=>({label:u.name,value:u.name,status:u.status})).filter(u=>u.status==="true"),a=u=>{l(u)};return e.jsx(V,{mode:"multiple",tagRender:_,style:{width:"100%"},defaultValue:r.map(u=>u.name),maxTagCount:0,options:o,maxTagPlaceholder:`${r.length} items Selected`,placeholder:"Nothing Selected",onChange:a})};function J({name:t,restField:r,form:l,index:s,isMultiple:o=!1,className:a,isUpdate:u,initialSku:h}){const x=w.useRef(null),[i,j]=w.useState(""),v=async d=>{j("loading"),x.current&&clearTimeout(x.current),d.target.value!==""?x.current=setTimeout(async()=>{const p=M({query:"sku",key:d.target.value});try{const{data:m}=await E.get(`product?${p}`);m&&j(m.status)}catch{}},500):j("")};let y={};if(i==="true")y={validateStatus:"error",help:"Sku already exists"};else if(i==="false")if(!o)y={validateStatus:"success",help:"Sku is available"};else{const d=l.getFieldValue("productGroup"),p=l.getFieldValue(["productGroup",s,"sku"]);d.filter((b,N)=>N!==s).some(b=>b.sku===p)?y={validateStatus:"error",help:"Same SKU Detected!"}:y={validateStatus:"success",help:"SKU available"}}else i==="loading"&&(y={validateStatus:"validating",help:"Validating SKU..."});const S=[{validator:()=>new Promise((d,p)=>{i==="true"?p("This SKU already in use!"):i==="false"?d():p("Please enter the SKU!")})}],c=[{validator:(d,p)=>new Promise((m,n)=>{i==="true"?n("This Sku already in use!"):i==="false"||h===p?m():n("Please enter the Sku!")})}];return e.jsx(e.Fragment,{children:r?e.jsx(f.Item,{...r,label:o?e.jsxs(e.Fragment,{children:["SKU",s===0&&e.jsx("span",{onClick:()=>ee(l),className:"cursor-pointer font-semibold text-xs text-blue-500 ml-1",children:"Generate SKU"})]}):"SKU",name:[t,"sku"],className:k("",{[a]:a,"mb-1 w-1/2":!a}),hasFeedback:!0,required:!0,...y,rules:o?[{validator:(d,p)=>new Promise((m,n)=>{const g=l.getFieldValue("productGroup").filter((P,U)=>U!==s).some(P=>P.sku===p);i==="true"?n("This SKU already in use!"):i==="false"||p?g?n("This SKU already in use!"):m():n("Please enter Sku!")})}]:S,children:e.jsx(A,{onChange:v,placeholder:"Sku"})}):e.jsx(f.Item,{style:{marginBottom:"15px"},label:"SKU",name:t,className:k("",{[a]:a,"mb-1 w-1/2":!a}),hasFeedback:!0,required:!0,...y,rules:u?c:S,children:e.jsx(A,{onChange:v,placeholder:"Sku"})})})}function Q({form:t,index:r}){const[l,s]=w.useState([]),o=h=>{s(!1),t.setFieldsValue({productGroup:[...t.getFieldValue("productGroup").map((x,i)=>i===r?{...x,productThumbnailImage:h[0].id}:x)]})},a=h=>{s(!0)},u=t.getFieldValue(["productGroup",r,"productThumbnailImage"]);return e.jsx(e.Fragment,{children:e.jsx(z,{onInsert:o,filter:{image:"image"},button:e.jsx("div",{className:"relative",children:l?e.jsx("div",{className:"w-[200px] h-[130px] bg-gray-300 rounded flex items-center justify-center",children:e.jsx(K,{size:30,className:"text-blue-500"})}):e.jsx("img",{src:`${window.env.VITE_APP_API}/media/view/${u}`,alt:u,onError:a,className:"w-[200px] h-[130px] object-cover rounded"})})})})}function ue({discount:t,discountLoading:r,setAttributeId:l,form:s,productGroupName:o}){const a=T(c=>{var d;return(d=c.productAttribute)==null?void 0:d.list}),u=W(a),[h,x]=w.useState([]),[i,j]=w.useState({}),v=c=>{const p=Object.values(c).reduce((m,n)=>[...m,...n],[]);l(p)},y=c=>{const d=c.map(p=>a.find(n=>n.name===p));x(d)},S=(c,d)=>{const m=Object.keys(i).find(n=>n===c);if(m){const n={...i,[m]:d},b=F(u,n),N=G(b),g=C(N,s,o);s.setFieldsValue({productGroup:g}),j(n),v(n)}else{const n={...i,[c]:d},b=F(u,n),N=G(b),g=C(N,s,o);s.setFieldsValue({productGroup:g}),j(n),v(n)}};return w.useEffect(()=>{if(a!=null&&a.length){const c=h.map(d=>a.find(m=>m.name===d.name));x(c)}},[a]),e.jsxs(e.Fragment,{children:[(a==null?void 0:a.length)&&e.jsx(f.Item,{style:{marginBottom:"15px"},label:e.jsxs(e.Fragment,{children:["Attribute"," ",e.jsx(I,{title:"Attribute",children:e.jsx(R,{})})]}),children:e.jsx(H,{data:a,attributes:h,attributesHandler:y})}),e.jsx("div",{className:"border-l border-blue-300",children:h==null?void 0:h.map(c=>e.jsx(f.Item,{style:{marginBottom:"15px",marginLeft:"20px"},label:e.jsxs(e.Fragment,{children:[c.name," ",e.jsx(I,{title:c.name,children:e.jsx(B,{id:c.id,fromProductCreate:!0})})]}),name:c.name.toLowerCase(),children:e.jsx(L,{name:c.name,data:c.productAttributeValue,attributeValueHandler:S,attributeValue:i})},c.id))}),e.jsx("div",{children:e.jsx(f.List,{name:"productGroup",initialValue:[{}],rules:[{required:!0,message:"Product is required"}],children:(c,{add:d,remove:p})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-auto",children:e.jsx("div",{className:"w-full flex gap-4 flex-wrap",children:c.map(({key:m,name:n,...b},N)=>e.jsxs(q,{className:"",children:[e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsx(f.Item,{className:"mb-1 max-w-[200px]",children:e.jsx(Q,{form:s,index:N})}),e.jsx(f.Item,{className:"mb-0",children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{p(n)},children:e.jsx(O,{size:25})})})]}),e.jsx(f.Item,{...b,name:[n,"name"],label:"Product Name",className:"mb-1 max-w-full",rules:[{required:!0,message:"Product name is required"}],children:e.jsx(A,{size:"small",placeholder:"Enter item name"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{restField:b,name:n,form:s,isMultiple:!0,index:N},N),e.jsx(f.Item,{...b,name:[n,"discountId"],label:e.jsxs(e.Fragment,{children:["Discount",N===0&&e.jsx("span",{onClick:()=>Y("discountId",s),className:"cursor-pointer font-semibold text-xs text-blue-500 ml-1",children:"Copy to all"})]}),className:"mb-1 w-1/2",children:e.jsx(V,{showSearch:!0,className:"w-full",placeholder:"Select discount",optionFilterProp:"children",allowClear:!0,loading:r,children:t==null?void 0:t.map(g=>e.jsx(V.Option,{value:g.id,children:`${g.type=="percentage"?`${g.value}%`:`Flat ${g.value}`}`},g.id))})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f.Item,{...b,label:"UPC No",name:[n,"upcNo"],className:"mb-1 w-full",children:e.jsx(A,{size:"small",placeholder:"Enter UPC No"})}),e.jsx(f.Item,{...b,name:[n,"eanNo"],label:"EAN No",className:"mb-1 w-full",children:e.jsx(A,{size:"small",placeholder:"Enter EAN No"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f.Item,{...b,name:[n,"isbnNo"],label:"ISBN No",className:"mb-1 w-full",children:e.jsx(A,{size:"small",placeholder:"Enter ISBN No"})}),e.jsx(f.Item,{...b,name:[n,"partNo"],label:"Part No",className:"mb-1 w-full",children:e.jsx(A,{size:"small",placeholder:"Enter part number"})})]})]},m))})}),c.length===0&&e.jsx("div",{className:"text-center py-10",children:"Please select attribute and attribute value"})]})})})]})}function W(t){return(t==null?void 0:t.reduce((l,s)=>[...l,...s.productAttributeValue],[]))||[]}function F(t,r){const l={};for(const s in r){const o=r[s];l[s]=[],o.forEach(a=>{const u=t.find(h=>h.id===a);u&&l[s].push(u)})}return l}function G(t){const r=Object.keys(t),l=r.map(o=>t[o]);return X(...l).map(o=>{const a={};return r.forEach((u,h)=>{a[u]=o[h]}),a})}function X(...t){return t.reduce((r,l)=>r==null?void 0:r.flatMap(s=>l==null?void 0:l.map(o=>s.concat(o))),[[]])}function C(t,r,l){return t.map(s=>{const o=(r.getFieldValue("productGroupName")&&r.getFieldValue("productGroupName")+"-"||l&&l+"-"||"")+Object.keys(s).map(u=>s[u].name).join("/"),a=Object.keys(s).map(u=>s[u].id);return{name:o,productAttributeValueId:a}})}function Y(t,r){const l=r.getFieldValue("productGroup"),s=l[0][t]||"";if(!s)return;const o=l.map(a=>({...a,[t]:s}));r.setFieldsValue({productGroup:o})}function Z(){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";return t[Math.floor(Math.random()*t.length)]+t[Math.floor(Math.random()*t.length)]}function ee(t){var o;const r=t.getFieldValue("productGroup"),l=((o=r[0])==null?void 0:o.sku)||"";if(!l)return;const s=r.map((a,u)=>({...a,sku:l+Z()}));t.setFieldsValue({productGroup:s})}export{H as A,ue as F,J as S,Q as U};
