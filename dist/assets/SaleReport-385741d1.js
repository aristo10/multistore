import{cM as Y,cS as p,cN as a,cL as R,r as N,cO as $,cQ as S}from"./vendor-3a94a37a.js";import{aX as w,ac as I,d as g,al as f,fR as Q,C as L,c6 as O}from"./index-ed7845ca.js";import{R as z}from"./ReportTable-b23b8ac7.js";import{i as E}from"./invoiceGenerator-eaeb8720.js";import{u as q}from"./useCurrency-4b14dd3d.js";import{F as h,b,D as C}from"./vendor-large-f75deccb.js";function M({data:i,info:d,saleInfo:n,pageConfig:o,title:D,type:s,btnName:c}){const{currencyName:v}=q()||{},m=Y(l=>{var j;return(j=l==null?void 0:l.setting)==null?void 0:j.data})||null,e=[],r=[{label:"Total Unit Quantity",value:`${d!=null&&d.totalUnitQuantity?d.totalUnitQuantity:0}`},{label:"Total  Amount",value:`${d!=null&&d.totalAmount?d.totalAmount.toFixed(2):0}`},{label:"Total Due",value:`${d!=null&&d.dueAmount?d.dueAmount.toFixed(2):0}`},{label:"Total Paid",value:`${d!=null&&d.paidAmount?d.paidAmount.toFixed(2):0}`},{label:"Total Return",value:`${d!=null&&d.totalReturnAmount?d.totalReturnAmount.toFixed(2):0}`},{label:"Total Instant Paid Return",value:`${d!=null&&d.instantPaidReturnAmount?d.instantPaidReturnAmount.toFixed(2):0}`},{label:"Total Profit",value:`${d!=null&&d.profit?d.profit.toFixed(2):0}`}],A=["SL","Date","Invoice","Staff","Product ","QTY","Total","Discount","Vat","Grand Total","Paid","Due","Return","Profit"],F=i.map((l,j)=>{var P;return[`${j+1}`,p(l.date).format("YYYY-MM-DD"),l==null?void 0:l.id,(P=l==null?void 0:l.user)==null?void 0:P.username,l.saleInvoiceProduct.map(u=>{var T,k;return(T=u==null?void 0:u.product)!=null&&T.name?(k=u==null?void 0:u.product)==null?void 0:k.name:""}).join(`,
`),l==null?void 0:l.saleInvoiceProduct.map(u=>u==null?void 0:u.productQuantity).join(`
`),`${l.totalAmount?l.totalAmount.toFixed(2):0}`,`${l.totalDiscountAmount?l.totalDiscountAmount.toFixed(2):0}`,`${l.totalTaxAmount?l.totalTaxAmount.toFixed(2):0}`,`${l.totalAmount?l.totalAmount+l.totalTaxAmount-l.totalDiscountAmount:0}`,`${l.paidAmount?l.paidAmount.toFixed(2):0}`,`${l.dueAmount?l.dueAmount.toFixed(2):0}`,`${l.returnAmount?l.returnAmount.toFixed(2):0}`,`${l.profit?l.profit.toFixed(2):0}`]}),t=[{value:`Customer: ${n!=null&&n.customer?n==null?void 0:n.customer:"All"}`},{value:`Sale Person: ${n!=null&&n.salePerson?n==null?void 0:n.salePerson:"All"}`}],y=[{value:`From Date: ${p(o==null?void 0:o.startDate).format("YYYY-MM-DD")}`},{value:`To Date: ${p(o==null?void 0:o.endDate).format("YYYY-MM-DD")}`},{value:`Currency: ${v}`}],x={jsPDF:{orientation:"landscape"},tableFontSize:8,infoTopFontSize:8,bottomRightFontSize:10,bottomLeftFontSize:8,footerFontSize:10};return a.jsx("div",{className:"flex gap-2",children:a.jsx(w,{className:"bg-primary flex  justify-center items-center px-4 py-2 text-white rounded",onClick:()=>E(s,{title:D,TopRightInfo:y,companyInfo:m,customerInfo:t,bottomLeftContent:e,bottomRightContent:r,tableBody:F,tableHead:A,settings:x}),children:c})})}function G({setPageConfig:i,pageConfig:d,setShowTable:n}){const o=R(),[D,s]=N.useState(!1),{list:c,loading:v}=Y(t=>t.customers),{list:m,loading:e}=Y(t=>t.users),{list:r,loading:A}=Y(t=>t.store),F=async t=>{s(!0),(await o(Q({...t,startDate:t.startDate.format("YYYY-MM-DD"),endDate:t.endDate.format("YYYY-MM-DD"),query:"report"}))).payload.message==="success"&&n(!0),s(!1)};return N.useEffect(()=>{o(I({query:"all"})),o(g({query:"all"})),o(f())},[o]),a.jsx("div",{className:"flex flex-col items-center gap-2 p-5 m-4 rounded bg-white w-2/5",children:a.jsxs(h,{layout:"vertical",className:"w-full",initialValues:{startDate:$(d.startDate,"YYYY-MM-DD"),endDate:$(d.endDate,"YYYY-MM-DD")},onFinish:F,children:[a.jsx(h.Item,{label:"Select store",name:"storeId",className:"w-full",children:a.jsx(b,{placeholder:"All",loading:A,allowClear:!0,maxTagPlaceholder:t=>a.jsxs("div",{className:"",children:[t.length," Selected"]}),maxTagCount:0,mode:"multiple",showSearch:!1,style:{width:"100%"},children:r==null?void 0:r.map(t=>a.jsx(b.Option,{value:t.id,children:t==null?void 0:t.name},t.id))})}),a.jsxs("div",{className:"w-full flex gap-2",children:[a.jsx(h.Item,{label:"Sale person",name:"salePersonId",className:"w-1/2",children:a.jsx(b,{placeholder:"All",loading:e,allowClear:!0,showSearch:!1,style:{width:"100%"},maxTagCount:0,onChange:t=>i(y=>{var x;return{...y,salePerson:(x=m.find(l=>l.id===t))==null?void 0:x.username}}),children:m==null?void 0:m.map(t=>a.jsx(b.Option,{value:t.id,children:t==null?void 0:t.username},t.id))})}),a.jsx(h.Item,{label:"Select Customer",name:"customerId",className:"w-1/2",children:a.jsx(b,{placeholder:"All",loading:v,allowClear:!0,showSearch:!1,style:{width:"100%"},maxTagCount:0,onChange:t=>i(y=>{var x;return{...y,customer:(x=c.find(l=>l.id===t))==null?void 0:x.username}}),children:c==null?void 0:c.map(t=>a.jsx(b.Option,{value:t.id,children:t==null?void 0:t.username},t.id))})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(h.Item,{label:"From",name:"startDate",className:"w-1/2",children:a.jsx(C,{onChange:t=>i({...d,startDate:t.format("YYYY-MM-DD")})})}),a.jsx(h.Item,{label:"To",name:"endDate",className:"w-1/2",children:a.jsx(C,{onChange:t=>i({...d,endDate:t.format("YYYY-MM-DD")})})})]}),a.jsx(h.Item,{children:a.jsx(w,{loading:D,type:"submit",className:"w-full bg-green-500 text-white rounded p-2",children:"Generate Report"})})]})})}function K(){const[i,d]=N.useState(!1),{list:n,loading:o,info:D}=Y(e=>e.sales),[s,c]=N.useState({query:"report",startDate:p().startOf("month").format("YYYY-MM-DD"),endDate:p().endOf("month").format("YYYY-MM-DD"),salePerson:null,customer:null}),v=[{id:1,title:"Invoice No",dataIndex:"id",key:"id",render:(e,{id:r})=>a.jsx(S,{to:`/admin/sale/${r}`,children:r})},{id:2,title:"Date",dataIndex:"date",key:"date",render:e=>p(e).format("ll")},{id:3,title:"Customer Name ",dataIndex:"customer",key:"customerId",render:e=>a.jsx(S,{to:`/admin/customer/${e==null?void 0:e.id}`,children:e==null?void 0:e.username})},{id:4,title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount",render:e=>Number(e).toFixed(2)},{id:5,title:"Discount",dataIndex:"discount",key:"discount",render:e=>Number(e).toFixed(2)},{id:7,title:"Paid Amount",dataIndex:"paidAmount",key:"paidAmount",render:e=>Number(e).toFixed(2),responsive:["md"]},{id:6,title:"Due Amount",dataIndex:"dueAmount",key:"dueAmount",render:e=>Number(e).toFixed(2),responsive:["md"]},{id:8,title:"Profit",dataIndex:"profit",key:"profit",render:e=>Number(e).toFixed(2),responsive:["md"]},{id:9,title:"Sale Person",dataIndex:"user",key:"user",render:e=>a.jsx(S,{to:`/admin/hrm/staff/${e==null?void 0:e.id}`,children:e==null?void 0:e.username}),responsive:["md"]}],m=[{id:2,title:"Date",dataIndex:"date",key:"date",renderCsv:e=>p(e).format("ll")},{id:1,title:"Invoice No",dataIndex:"id",key:"id",renderCsv:e=>e},{id:3,title:"Staff ",dataIndex:"user",key:"staff",renderCsv:e=>e==null?void 0:e.username},{id:5,title:"Product",dataIndex:"saleInvoiceProduct",key:"saleInvoiceProduct",renderCsv:e=>e.length>0?e.map(r=>{var A;return(A=r==null?void 0:r.product)==null?void 0:A.name}):"-"},{id:4,title:"QTY",dataIndex:"saleInvoiceProduct",key:"totalAmount",renderCsv:e=>e.length>0?e.map(r=>r==null?void 0:r.productQuantity):0},{id:4,title:"Total ",dataIndex:"totalAmount",key:"totalAmount",renderCsv:e=>Number(e).toFixed(2)},{id:5,title:"Discount",dataIndex:"totalDiscountAmount",key:"discount",renderCsv:e=>Number(e).toFixed(2)},{id:7,title:"Paid Amount",dataIndex:"paidAmount",key:"paidAmount",renderCsv:e=>Number(e).toFixed(2)},{id:6,title:"Due Amount",dataIndex:"dueAmount",key:"dueAmount",renderCsv:e=>Number(e).toFixed(2)},{id:8,title:"Profit",dataIndex:"profit",key:"profit",renderCsv:e=>Number(e).toFixed(2)}];return a.jsx("div",{className:"card card-custom mt-3 ",children:a.jsx("div",{className:"card-body",children:a.jsxs(L,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Sale Report",children:[i?a.jsxs("div",{className:"flex justify-between p-5 items-start ",children:[a.jsx("div",{children:a.jsx(w,{onClick:()=>d(e=>!e),className:"bg-green-500 text-white",children:"Generate Again"})}),a.jsxs("div",{className:"flex px-5 gap-2 items-center ",children:[a.jsx(M,{data:n,info:D,saleInfo:s,title:"Sale Report",pageConfig:s,type:"print",btnName:"Print"}),a.jsx(M,{data:n,saleInfo:s,title:"Sale Report",info:D,pageConfig:s,type:"download",btnName:"Export PDF"}),a.jsx("div",{children:a.jsx(O,{list:n,columns:m,title:"Sale Report",className:"bg-primary",btnName:"Export CSV"})})]})]}):a.jsx(G,{setPageConfig:c,pageConfig:s,setShowTable:d}),i&&a.jsx(z,{list:n,columns:v,loading:o})]})})})}export{K as default};
