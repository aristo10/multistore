import{cL as I,r as v,cM as P,cN as t,cY as k,cZ as T,cV as C}from"./vendor-3a94a37a.js";import{ae as V,af as z,ag as N}from"./index-ed7845ca.js";function A({className:l,form:s,totalCalculator:f,setSelectedProduct:n}){const r=I(),[m,j]=v.useState(""),g=v.useRef(null),{list:a}=P(e=>e.productSearch),b=e=>{var o,u,i,d,S;if(!s.getFieldValue("storeId")){C.error("Please select a store first");return}const c=s.getFieldValue("saleInvoiceProduct")||[];if(c.find(p=>p.productId===e.id)){const p=c.map(x=>e.id===x.productId?{...x,productQuantity:x.productQuantity?x.productQuantity+1:1}:e);s.setFieldsValue({saleInvoiceProduct:p})}else n&&n(p=>[...p,e]),s.setFieldsValue({saleInvoiceProduct:[...c,{productId:e.id,productName:e.name,productQuantity:n?1:0,productSalePrice:(o=e.stockInfo[0])==null?void 0:o.productSalePrice,productVat:((u=e.productGroup.productSalesTax)==null?void 0:u.percentage)||0,productDiscount:(i=e.discount)!=null&&i.value?parseInt((d=e.discount)==null?void 0:d.value):0,discountType:((S=e.discount)==null?void 0:S.type)||"flat"}]});f()},w=async e=>{g.current&&clearTimeout(g.current),j(e.target.value),g.current=setTimeout(async()=>{var c,y,o,u,i;if(e.target.value!==""){const d=await r(z({query:"search",key:e.target.value,count:7}));((o=(y=(c=d.payload)==null?void 0:c.data)==null?void 0:y.getAllProduct)==null?void 0:o.length)===1&&(b((i=(u=d.payload)==null?void 0:u.data)==null?void 0:i.getAllProduct[0]),h())}else r(N())},500)},h=()=>{m!==""&&(j(""),r(N()))};return v.useEffect(()=>()=>{h()},[]),t.jsxs("div",{className:V("relative w-full ",{[l]:l}),children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:m,onChange:w,className:`w-full py-2 px-5 rounded-lg outline-0 ${(a==null?void 0:a.length)>0&&"rounded-b-none"}`,placeholder:"Search Product"}),m&&t.jsx("button",{type:"button",onClick:h,className:"text-black/50 absolute  right-8 h-full pl-2 pr-4 z-10 ",children:t.jsx(k,{size:25})}),t.jsx("button",{type:"button",className:"text-gray-400 absolute  right-0 h-full pl-2 pr-4 z-10 ",children:t.jsx(T,{size:25})})]}),(a==null?void 0:a.length)>0&&t.jsx("div",{className:"absolute bg-white shadow-md z-20 w-full rounded-b-lg max-h-80 md:max-h-[600px] overflow-y-auto ",children:a.map(e=>t.jsx(E,{onSelect:b,product:e,handleClear:h},e.id))})]})}function E({product:l,onSelect:s,handleClear:f}){const{name:n,productQuantity:r}=l;return t.jsxs("div",{onClick:()=>{s(l),f()},className:"flex justify-between items-center gap-2 py-1 w-full px-5 hover:bg-slate-950/10 text-sm",children:[t.jsx("div",{className:"flex items-center gap-3 justify-start",children:t.jsx("h1",{className:"font-medium text-gray-700",children:n})}),t.jsx("div",{className:"",children:r>0?t.jsxs("span",{className:"bg-green-500/10 text-green-700 rounded px-2 flex gap-2",children:["Stock: ",t.jsx("span",{children:r})]}):t.jsx("span",{className:"bg-red-500/10 text-red-700 rounded px-2",children:"Stock out"})})]})}export{A as S};
