import{r as u,cL as S,cM as c,cN as s,cO as C,cP as I,c_ as G,cT as A}from"./vendor-3a94a37a.js";import{H as O,I as H,t as M,a as R,v as P,w as $,f_ as q,f$ as v,as as E,G as z,d as J,L as K,be as U,N as W,g0 as X}from"./index-ed7845ca.js";import{F as a,C as B,a as L,B as f,b as i,D,I as Q}from"./vendor-large-f75deccb.js";function Y({data:l,loading:t}){const[o]=a.useForm(),[p,d]=u.useState(!1),r=S(),{list:g,loading:x}=c(e=>e.company),{list:j,loading:N}=c(e=>e.contact),{list:k,loading:b}=c(e=>e.opportunity),{list:m,loading:T}=c(e=>e.quote),{list:h,loading:n}=c(e=>e.taskType),{list:y,loading:w}=c(e=>e.taskStatus);u.useEffect(()=>{r(O()),r(H()),r(M()),r(R()),r(P()),r($())},[r]);const V=async e=>{const _={...e,companyId:parseInt(e.companyId),contactId:parseInt(e.contactId),opportunityId:parseInt(e.opportunityId),quoteId:parseInt(e.quoteId),crmTaskStatusId:parseInt(e.crmTaskStatusId),taskTypeId:parseInt(e.taskTypeId)};(await r(q({id:l.id,values:_}))).payload.message==="success"&&(r(v(l.id)),r(E.util.invalidateTags(["Tasks"])),d(!1))},F=e=>{d(!1),o.resetFields(),console.log("Failed:",e)};return s.jsx(s.Fragment,{children:s.jsx(B,{bordered:!1,headStyle:{display:"none"},bodyStyle:{padding:0},children:l&&s.jsx(a,{form:o,colon:!1,labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}},layout:"inline",onFieldsChange:()=>d(!0),onFinish:V,onFinishFailed:F,initialValues:{contactId:(l==null?void 0:l.contactId)||"",companyId:(l==null?void 0:l.companyId)||"",opportunityId:(l==null?void 0:l.opportunityId)||"",quoteId:(l==null?void 0:l.quoteId)||"",taskTypeId:(l==null?void 0:l.taskTypeId)||"",crmTaskStatusId:(l==null?void 0:l.crmTaskStatusId)||"",description:(l==null?void 0:l.description)||"",startDate:C(l==null?void 0:l.startDate)||"",endDate:C(l==null?void 0:l.endDate)||""},children:s.jsx(L,{className:"bg-transparent w-full",bordered:!0,children:s.jsx(L.Panel,{header:s.jsx("span",{className:"font-bold text-md dark:text-white",children:"Details"}),extra:s.jsx(s.Fragment,{children:p&&s.jsx(a.Item,{children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(f,{type:"primary",htmlType:"submit",children:"Save"}),s.jsx(f,{loading:t,type:"danger",onClick:F,children:"Cancel"})]})})}),children:s.jsx("div",{className:"flex flex-wrap xl:px-10",children:s.jsxs("div",{className:"w-full xl:w-[50%] flex flex-col gap-2 p-3",children:[s.jsx(a.Item,{className:"flex flex-col",label:"Task Type",name:"taskTypeId",children:s.jsx(i,{bordered:!1,className:"md:ml-5",loading:n,children:h.map(e=>s.jsx(i.Option,{value:e.id,children:e==null?void 0:e.taskTypeName},e.id))})}),s.jsx(a.Item,{className:"flex flex-col",label:"Task Status",name:"crmTaskStatusId",children:s.jsx(i,{bordered:!1,className:"md:ml-5",loading:w,children:y.map(e=>s.jsx(i.Option,{value:e.id,children:e==null?void 0:e.taskStatusName},e.id))})}),s.jsx(a.Item,{className:"flex flex-col",label:"Company",name:"companyId",children:s.jsx(i,{bordered:!1,className:"md:ml-5",loading:x,children:g.map(e=>s.jsx(i.Option,{value:e.id,children:e==null?void 0:e.companyName},e.id))})}),s.jsx(a.Item,{className:"flex flex-col",label:"Contact",name:"contactId",children:s.jsx(i,{bordered:!1,className:"md:ml-5",loading:N,children:j.map(e=>s.jsxs(i.Option,{value:e.id,children:[e==null?void 0:e.firstName," ",e==null?void 0:e.lastName]},e.id))})}),s.jsx(a.Item,{className:"flex flex-col",label:"Opportunity",name:"opportunityId",children:s.jsx(i,{bordered:!1,className:"md:ml-5",loading:b,children:k.map(e=>s.jsx(i.Option,{value:e.id,children:e.opportunityName},e.id))})}),s.jsx(a.Item,{className:"flex flex-col",label:"Quote",name:"quoteId",children:s.jsx(i,{bordered:!1,className:"md:ml-5",loading:T,children:m==null?void 0:m.map(e=>s.jsx(i.Option,{value:e.id,children:e.quoteName},e.id))})}),s.jsx(a.Item,{label:"Start date",name:"startDate",children:s.jsx(D,{bordered:!1,suffix:s.jsx(I,{}),className:"md:ml-5"})}),s.jsx(a.Item,{label:"End date",name:"endDate",children:s.jsx(D,{bordered:!1,suffix:s.jsx(I,{}),className:"md:ml-5"})}),s.jsx(a.Item,{label:"Description",name:"description",children:s.jsx(Q,{bordered:!1,className:"md:ml-5",suffix:s.jsx(I,{})})})]})})},"1")})})})})}function Z({data:l,loading:t}){const o=S(),p=G(),{id:d}=A(),[r]=a.useForm(),[g,x]=u.useState(!1),{list:j,loading:N}=c(n=>n.users),{list:k,loading:b}=c(n=>n.priority),m=async()=>{window.confirm("Are you sure you want to delete?")&&(await o(U(d))).payload.message==="success"&&(p(-1),o(W()))},T=async n=>{const y={...n,assigneeId:parseInt(n.assigneeId),opportunityId:parseInt(n.opportunityId),priorityId:parseInt(n.priorityId),taskStatusId:parseInt(n.taskStatusId)};(await o(q({id:l.id,values:y}))).payload.message==="success"&&(o(v(l.id)),o(E.util.invalidateTags(["Tasks"])),x(!1))},h=n=>{x(!1),r.resetFields(),console.log("Failed:",n)};return u.useEffect(()=>{o(P()),o(z()),o(O()),o(J({query:"all"}))},[o]),s.jsx(s.Fragment,{children:l?s.jsx(B,{bordered:!0,headStyle:{display:"none"},bodyStyle:{padding:0},children:s.jsx(a,{form:r,colon:!1,labelCol:{span:2},wrapperCol:{span:8},layout:"inline",onFieldsChange:()=>x(!0),onFinish:T,onFinishFailed:h,initialValues:{name:(l==null?void 0:l.name)||"",assigneeId:(l==null?void 0:l.assigneeId)||"",opportunityId:(l==null?void 0:l.opportunityId)||"",taskStatusId:(l==null?void 0:l.taskStatusId)||"",priorityId:(l==null?void 0:l.priorityId)||""},children:s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"flex justify-between items-center px-5 p-3 border-b",children:[s.jsxs("div",{className:"flex gap-2 dark:text-white",children:[s.jsx("span",{children:"Task Name:"}),s.jsx("span",{className:"font-bold",children:l.name})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[g&&s.jsx(a.Item,{children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(f,{type:"primary",htmlType:"submit",children:"Save"}),s.jsx(f,{loading:t,type:"danger",onClick:h,children:"Cancel"})]})}),s.jsx(f,{danger:!0,onClick:m,children:"Delete"})]})]}),s.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[s.jsx(a.Item,{label:"Task Name",name:"name",children:s.jsx(Q,{bordered:!1,suffix:s.jsx(I,{}),className:"md:ml-5"})}),s.jsx(a.Item,{className:"flex flex-col",label:"Assignee",name:"assigneeId",tooltip:"Change the assignee of this Task",children:s.jsx(i,{bordered:!1,loading:N,className:"md:ml-5",children:j.map(n=>s.jsxs(i.Option,{value:n.id,children:[n==null?void 0:n.firstName," ",n==null?void 0:n.lastName]},n.id))})}),s.jsx(a.Item,{className:"flex flex-col",label:"Task Priority",name:"priorityId",children:s.jsx(i,{bordered:!1,loading:b,className:"md:ml-5",children:k.map(n=>s.jsx(i.Option,{value:n.id,children:n.name},n.id))})})]})]})})}):s.jsx(K,{})})}function as({data:l}){let{id:t}=A();t=t||(l==null?void 0:l.id);const o=S(),{task:p,loading:d}=c(r=>r.task);return u.useEffect(()=>(o(v(t)),()=>{X()}),[o,t]),s.jsx("div",{className:"relative  w-full h-[calc(100vh-52.8px)] overflow-hidden flex flex-row",children:s.jsxs("div",{className:"w-full overflow-y-auto overflow-x-hidden flex flex-col gap-8",children:[s.jsx(Z,{data:p,loading:d}),s.jsx(Y,{data:p,loading:d})]})})}export{as as default};
