import{cM as b,cL as F,cS as v,r as d,cN as e,da as q,cX as U,cU as H,cT as X,dt as G,cQ as K}from"./vendor-3a94a37a.js";import{aZ as k,aX as B,gO as V,C,am as W,L as Z}from"./index-ed7845ca.js";import{L as J}from"./List-9eb27318.js";import{T as _,a as ee}from"./Tabs-8f68912a.js";import{i as T}from"./invoiceGenerator-eaeb8720.js";import{s as te}from"./emailConfigSlice-145edc06.js";import{u as se}from"./useCurrency-4b14dd3d.js";import{F as j,I as P,a as O,c as re,i as oe,B as ae,r as D}from"./vendor-large-f75deccb.js";import{T as L}from"./TagInput-f33dd18b.js";import{textEditorModule as ie,textEditorFormats as ne}from"./AddProduct-aa890cea.js";import"./ImageUploader-c0ae741f.js";import"./MediaGallery-5095f29f.js";import"./UploaderWithDrag-568744bd.js";import"./BigDrawer-240149a9.js";import"./AddManufacturer-2f6bafee.js";import"./AddProductBrand-894ab785.js";import"./UploadMany-c4472299.js";import"./AddProductSubcategory-71762def.js";import"./AddProductCategory-6511f02f.js";import"./AddUoM-1dc09ff9.js";import"./AddVatTax-97a0925d.js";import"./FormProductListCard-571d2cbc.js";import"./AddProductAttribute-4ec2c5fe.js";import"./AddProductAttributeValue-d16feddc.js";import"./AddDiscount-05e89f9a.js";function ce({data:t,title:p}){const m=b(n=>{var l;return(l=n==null?void 0:n.setting)==null?void 0:l.data})||null,u=F(),s=[],i=[],f=["SI","Product Name","Quantity"],h=t.productList.map((n,l)=>[l+1,n.product.name,n.reorderProductQuantity]),x=[],c=[{value:`Invoice No: ${t==null?void 0:t.reorderInvoiceId}`},{value:`Invoice Date: ${v(t==null?void 0:t.createdAt).format("YYYY-MM-DD")}`}],r={jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:12,bottomLeftFontSize:8,footerFontSize:10};return d.useEffect(()=>{!m&&u(k())},[u,m]),e.jsx("div",{className:"",children:e.jsx(B,{className:"bg-primary flex justify-center items-center px-4 py-[9px] text-white rounded",onClick:()=>T("print",{title:p,TopRightInfo:c,companyInfo:m,customerInfo:x,bottomLeftContent:s,bottomRightContent:i,tableBody:h,tableHead:f,settings:r}),children:"Print"})})}function le(t,p,m,u){const s=[],i=[],f=["SI","Product Name","Quantity"],h=t.productList.map((n,l)=>[l+1,n.product.name,n.reorderProductQuantity]),x=[],c=[{value:`Invoice No: ${t==null?void 0:t.reorderInvoiceId}`},{value:`Invoice Date: ${v(t==null?void 0:t.createdAt).format("YYYY-MM-DD")}`}];return T(null,{title:m,TopRightInfo:c,customerInfo:x,companyInfo:p,bottomLeftContent:s,bottomRightContent:i,tableBody:h,tableHead:f,settings:{jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:8,footerFontSize:10}})}function de({setSendForm:t,setIsModalOpen:p,modal:m,body:u,subject:s,Invoice:i}){const[f]=j.useForm(),h=F(),[x,c]=d.useState(!1),[r,n]=d.useState([]),[l,w]=d.useState([]),[I,z]=d.useState([]),[S,E]=d.useState(u),{singlePurchase:g,loading:R}=b(o=>o.purchaseOrder),y=b(o=>{var a;return(a=o==null?void 0:o.setting)==null?void 0:a.data})||null,{currencyName:$}=se()||{},Q=async o=>{c(!0);try{let a=new FormData;a.append("receiverEmail",o.receiverEmail),a.append("subject",o.subject),a.append("body",S),r&&r.forEach(N=>{N.name==="Purchase Order.pdf"?a.append("files[]",N.originFileObj,"Purchase Order.pdf"):a.append("files[]",N.originFileObj)}),l.length>0&&a.append("cc[]",l),I.length>0&&a.append("bcc[]",I),(await h(te(a))).payload.message==="success"&&(t(!1),p(!1),c(!1),f.resetFields())}catch(a){console.log(a)}c(!1)},Y=()=>{};d.useEffect(()=>{!y&&h(k())});const A=o=>{n(o.fileList);const{status:a}=o.file;a==="done"?D.success(`${o.file.name} file uploaded successfully.`):a==="error"&&D.error(`${o.file.name} file upload failed.`)};d.useEffect(()=>{g&&y&&n(o=>o.some(a=>a.name===`Purchase Order-${i}.pdf`)?o:[...o,{name:`Purchase Order-${i}.pdf`,originFileObj:le(g,y,"Purchase Order")}])},[y,$,g]);const M=o=>{E(o)};return e.jsx(e.Fragment,{children:!R&&g&&e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:" "}),!m&&e.jsx("button",{onClick:()=>t(!1),className:"bg-red-100 p-1 rounded text-red-500",children:e.jsx(q,{size:20})})]}),e.jsxs(j,{onFinish:Q,onFinishFailed:Y,colon:!1,layout:"vertical",form:f,initialValues:{subject:s,body:u},children:[e.jsx(j.Item,{style:{width:"100%"},label:"To",rules:[{required:!0,message:"Please input receiver email!"}],name:"receiverEmail",children:e.jsx(P,{placeholder:"Receiver Email"})}),e.jsx(O,{bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:o})=>e.jsx(re,{rotate:o?90:0}),className:"site-collapse-custom-collapse mb-4 ",children:e.jsxs(O.Panel,{header:"CC & BCC",children:[e.jsx(L,{label:"CC",tags:l,setTags:w}),e.jsx(L,{label:"BCC",tags:I,setTags:z})]},"1")}),e.jsx(j.Item,{style:{width:"100%"},label:"Subject",name:"subject",children:e.jsx(P,{placeholder:"Subject"})}),e.jsx(j.Item,{label:"Attachment",children:e.jsxs(oe,{name:"files",onChange:A,multiple:!0,fileList:r,beforeUpload:()=>!1,children:[e.jsx("div",{className:"ant-upload-drag-icon flex justify-center my-2",children:e.jsx(U,{size:30})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})}),e.jsx(j.Item,{style:{marginBottom:"25px"},label:"Body",children:e.jsx(H,{value:S,onChange:M,modules:ie,formats:ne})}),e.jsx(j.Item,{children:e.jsx(ae,{loading:x,size:"large",htmlType:"submit",type:"primary",children:"Send"})})]})]})})}function Re(){var c;const{id:t}=X(),p=F(),[m,u]=d.useState(!1),{singlePurchase:s}=b(r=>r.purchaseOrder),i=b(r=>{var n;return(n=r==null?void 0:r.setting)==null?void 0:n.data})||null;d.useEffect(()=>{p(V(t))},[p,t]);const f=[{id:1,title:"ID",dataIndex:"productId",key:"id"},{id:2,title:"Name",dataIndex:"product",key:"name",render:r=>e.jsxs(K,{to:`/admin/product/${r==null?void 0:r.id}`,children:[r.name," "]}),tdClass:"whitespace-normal"},{id:4,title:"Sku",dataIndex:"product",key:"sku",render:r=>r.sku},{id:5,title:"Quantity",dataIndex:"reorderProductQuantity",key:"productQuantity"},{id:3,title:"Date",key:"createdAt",render:r=>v(r).format("ll")}],h=`Purchase Order Request - Order ID #${s==null?void 0:s.reorderInvoiceId} `,x=`
  <div>
        <p>I hope this message finds you well.</p>
  </div>
<br>
   <p>Please find attached a purchase order detailing the required products and quantities. We kindly request your confirmation of product availability and pricing.
    </p>
    <p>Best Regards,</p>
<br>
    <div>
        <strong>${i==null?void 0:i.companyName}</strong><br>
        ${i==null?void 0:i.phone}<br>
        ${i==null?void 0:i.email}
    </div>`;return e.jsx(e.Fragment,{children:s?e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(C,{className:"w-2/3",bodyClass:"p-0",children:[e.jsx("div",{className:"flex justify-between mx-2 py-2 border-b items-center",children:e.jsxs("div",{className:" flex gap-3",children:[e.jsx("div",{children:s&&e.jsx(ce,{data:s,title:"Purchase Order"})}),e.jsx(B,{className:"flex-row-reverse",color:"gray",icon:e.jsx(G,{size:15}),onClick:()=>{u(!0)},children:"Send"})]})}),m?e.jsx(de,{setSendForm:u,invoice:s,subject:h,body:x,Invoice:s==null?void 0:s.reorderInvoiceId}):e.jsx(_,{className:"mt-4",children:e.jsx(ee,{label:"Products",children:e.jsx("div",{className:"m-4",children:e.jsx(W,{columns:f,data:s==null?void 0:s.productList})})})})]}),e.jsx("div",{className:"w-1/3 flex flex-col gap-2",children:e.jsx(C,{title:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"font-normal",children:["Purchase Order No"," ",e.jsxs("span",{className:"font-semibold",children:["#",t]})]})}),children:e.jsx(e.Fragment,{children:e.jsx(J,{labelClassName:"w-[40%]",list:[{label:"Invoice Date",value:v(s.createdAt).format("ll")},{label:"Store",value:(c=s.store)==null?void 0:c.name}]})})})})]}):e.jsx(Z,{})})}export{Re as default};
