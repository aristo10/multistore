import{cN as e,d9 as R,cL as B,cM as L,r as w,cO as ee,cV as Y,c_ as se}from"./vendor-3a94a37a.js";import{a1 as J,ac as te,aj as W,cy as le,a$ as ae,bA as ne,cA as ie,aP as ce,al as oe,bS as re,s as H,cz as de}from"./index-ed7845ca.js";import{u as me}from"./useCurrency-4b14dd3d.js";import{F as m,I as X,h as Q,b as I,D as ue,B as G,P as xe,M as pe,p as he,C as je}from"./vendor-large-f75deccb.js";import{A as ge}from"./AddCustomer-f6c915fd.js";import{B as fe}from"./BigDrawer-240149a9.js";import{S as ye}from"./Search-32fc9847.js";import"./UploadMany-c4472299.js";function be({totalCalculator:d,subTotal:j,form:u,selectedProduct:b,setSelectedProduct:f}){const N=me(),A=c=>{var v,V,P,S,s,p,T,F;const x=(V=(v=u.getFieldValue("saleInvoiceProduct"))==null?void 0:v.find((y,a)=>a===c))==null?void 0:V.productId,t=b==null?void 0:b.find(y=>x===y.id);let l=null;t!=null&&t.productProductAttributeValue&&(l=t.productProductAttributeValue.map((y,a)=>{var h,q,z;return e.jsxs("span",{className:"text-xs",children:[e.jsxs("span",{className:"mr-1",children:[(q=(h=y.productAttributeValue)==null?void 0:h.productAttribute)==null?void 0:q.name,":"," "]}),e.jsx("span",{children:(z=y.productAttributeValue)==null?void 0:z.name}),a<t.productProductAttributeValue.length-1&&e.jsx("span",{children:", "})]},y.id)}));let r=null;(P=t==null?void 0:t.stockInfo[0])!=null&&P.productQuantity&&(r=e.jsxs("span",{className:"text-xs",children:[e.jsx("span",{className:"mr-1",children:"Stock: "}),e.jsx("span",{children:t.stockInfo[0].productQuantity})]}));let n=null;return(s=(S=t==null?void 0:t.productGroup)==null?void 0:S.uom)!=null&&s.name&&(n=e.jsxs("span",{className:"text-xs",children:[e.jsx("span",{className:"mr-1",children:"UoM: "}),e.jsx("span",{children:`${(p=t==null?void 0:t.productGroup)==null?void 0:p.uomValue}/${(F=(T=t==null?void 0:t.productGroup)==null?void 0:T.uom)==null?void 0:F.name}`})]})),{stock:r,attributes:l,uom:n,id:t==null?void 0:t.id}},C=c=>{f(x=>x.filter(t=>t.id!==c))};return e.jsx("div",{className:"products-container",children:e.jsx(m.List,{name:"saleInvoiceProduct",rules:[{required:!0,message:"Product is required"}],children:(c,{remove:x})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-auto mt-2",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"font-Popins text-black bg-tableHeaderBg border-gray-200 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pl-2 text-left rounded-tl-lg",children:"SL"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Product"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Quantity"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"price"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Discount"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Amount"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Tax%"}),e.jsx("th",{className:"py-2 pl-2 text-left rounded-tr-lg"})]})}),e.jsx("tbody",{className:"bg-tableBg px-1",children:c.map(({key:t,name:l,...r},n)=>{var V,P,S,s;const v=A(n);return e.jsxs("tr",{className:`hover:bg-slate-900/10 py-1 ${n===c.length-1?"":"border-b"}`,children:[e.jsx("td",{className:"py-2 pl-2 align-top",children:n+1}),e.jsxs("td",{className:"py-2 pl-2 align-top",children:[e.jsx(m.Item,{...r,name:[l,"productName"],className:"mb-0",children:e.jsx(X,{disabled:!0})}),e.jsx("div",{className:"px-2",children:v.attributes}),e.jsx("div",{className:"px-2",children:v.uom})]}),e.jsxs("td",{className:"py-2 pl-2 align-top",children:[e.jsx(m.Item,{...r,name:[l,"productQuantity"],className:"mb-0",rules:[{required:!0,message:"quantity is required"}],children:e.jsx(Q,{style:{width:"100%"},size:"small",placeholder:"Quantity",onChange:()=>d(n)})}),e.jsx("div",{className:"px-2",children:v.stock})]}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx(m.Item,{...r,name:[l,"productSalePrice"],className:"mb-0",rules:[{required:!0,message:"Price is required"}],children:e.jsx(Q,{size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>d(n)})})}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx("div",{className:"flex items-center",children:e.jsx(m.Item,{...r,name:[l,"productDiscount"],className:"mb-0 max-w-[150px]",rules:[{required:!0,message:"Discount is required"}],children:e.jsx(Q,{className:"discountType",addonAfter:e.jsx(m.Item,{...r,name:[l,"discountType"],noStyle:!0,children:e.jsxs(I,{size:"small",style:{width:50},defaultValue:"flat",popupClassName:"bg-white",onChange:()=>d(n),children:[e.jsx(I.Option,{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:N==null?void 0:N.currencySymbol}})},"flat"),e.jsx(I.Option,{children:"%"},"percentage")]})}),placeholder:"0",style:{width:"100%"},size:"small",onChange:()=>d(n)})})})}),e.jsx("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs",children:((P=(V=j[n])==null?void 0:V.subPrice)==null?void 0:P.toFixed(2))||0})}),e.jsxs("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:[e.jsx(m.Item,{...r,name:[l,"productVat"],className:"mb-0 max-w-[100px]",rules:[{required:!0,message:"Tax is required"}],children:e.jsx(Q,{size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>d(n)})}),e.jsxs("div",{className:"text-xs",children:["Total:"," ",((s=(S=j[n])==null?void 0:S.subVatAmount)==null?void 0:s.toFixed(2))||0]})]}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx(m.Item,{className:"mb-0",children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{C(v.id),x(l),d()},children:e.jsx(R,{size:25})})})})]},t)})})]})}),c.length===0&&e.jsx("div",{className:"text-center py-10",children:"No product selected yet"})]})})})}const Ne=({form:d,subTotal:j,setIsModalOpen:u,totalCalculator:b,setSelectedProduct:f,selectedProduct:N,storeId:A})=>{const{Option:C}=I,c=B(),x=L(l=>l.customers.list),t=async()=>{A?u(!0):Y.error("Please Select a Store")};return w.useEffect(()=>{c(J()),c(te({page:1,count:10}))},[c]),e.jsxs(m,{form:d,className:"m-lg-1",onFinish:t,name:"dynamic_form_nest_item",layout:"vertical",size:"large",autoComplete:"off",initialValues:{date:ee(),customerId:1},onKeyDown:l=>{l.key==="Enter"&&l.preventDefault()},children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-3 mb-3 lg:mb-5",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(m.Item,{style:{marginBottom:"-10px"},label:e.jsxs(e.Fragment,{children:["Customer",e.jsx(fe,{className:"",title:"new Customer",children:e.jsx(ge,{drawer:!0})})]}),className:"w-full",name:"customerId",rules:[{required:!0,message:"Please Select a Customer!"}],children:e.jsx(I,{className:"w-full",loading:!x,showSearch:!0,placeholder:"Select a customer ",optionFilterProp:"children",filterOption:(l,r)=>r.children.toString().toLowerCase().includes(l.toLowerCase()),children:x&&x.map(l=>e.jsx(C,{value:l.id,children:l.username},l.id))})})}),e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(m.Item,{label:"Date",name:"date",className:"w-full",style:{marginBottom:"-10px"},rules:[{required:!0,message:"Please input Date!"}],required:!0,children:e.jsx(ue,{})})})]}),e.jsx(be,{subTotal:j,setSelectedProduct:f,selectedProduct:N,form:d,totalCalculator:b})]})};function ve({totalCalculator:d}){const j=B(),{list:u,loading:b}=L(f=>f.accounts);return w.useEffect(()=>{j(W())},[j]),e.jsx(m.List,{name:"paidAmount",children:(f,{add:N,remove:A})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"bg-tableBg",children:f.map(({key:C,name:c,...x},t)=>e.jsx("div",{className:" py-1 ",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(m.Item,{...x,name:[c,"amount"],className:"mb-0",rules:[{required:!0,message:"Amount is required"}],children:e.jsx(Q,{className:"discountType",addonAfter:e.jsx(m.Item,{...x,name:[c,"paymentType"],noStyle:!0,rules:[{required:!0,message:"Payment type is required"}],children:e.jsx(I,{loading:b,size:"small",popupClassName:"min-w-[200px]",style:{width:100},placeholder:"Select Payment type",optionFilterProp:"children",filterOption:(l,r)=>r.children.includes(l),filterSort:(l,r)=>l.children.toLowerCase().localeCompare(r.children.toLowerCase()),children:u==null?void 0:u.map(l=>e.jsx(I.Option,{value:l.id,children:l.name},l.id))})}),placeholder:"0",style:{width:"100%"},size:"small",onChange:()=>d&&d(t)})}),e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{A(c),d&&d(t)},children:e.jsx(R,{size:25})})]})},C))}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx(G,{type:"dashed",size:"small",onClick:()=>N(),className:"flex items-center justify-center",block:!0,icon:e.jsx(xe,{}),children:"Add Payment"})})]})})}const K=localStorage.getItem("id");function we({isModalOpen:d,setIsModalOpen:j,form:u,totalTaxAmount:b,total:f,totalPayable:N,totalDiscount:A,totalCalculator:C,due:c,storeId:x,productForm:t}){const l=se(),r=B(),[n,v]=w.useState(),{isSaleCommission:V,currency:P}=le(["isSaleCommission","currency"]),{list:S,loading:s}=L(o=>o.termsAndConditions),{user:p}=L(o=>o.users),[T,F]=w.useState(0),y=u.getFieldValue("commissionType");let a=u.getFieldValue("saleCommission");y==="percentage"&&(a=f*a/100);const h=async o=>{var k,$,M;try{const D=(k=t==null?void 0:t.getFieldValue("saleInvoiceProduct"))==null?void 0:k.map(g=>{const _=(g==null?void 0:g.productQuantity)||0,U=(g==null?void 0:g.productSalePrice)||0,O={productId:g.productId,productQuantity:g.productQuantity,productUnitSalePrice:g.productSalePrice,tax:g.productVat};return O.productDiscount=g.productDiscount,g.discountType==="percentage"&&(O.productDiscount=U*_*(g==null?void 0:g.productDiscount)/100),O}),i={...o,customerId:t.getFieldValue("customerId"),date:t.getFieldValue("date"),paidAmount:o.paidAmount||[],saleInvoiceProduct:D,userId:parseInt(K),storeId:x,saleCommission:a||null},E=await r(ie(i));E.payload.message==="success"&&(u.resetFields(),l(`/admin/sale/${(M=($=E.payload)==null?void 0:$.data)==null?void 0:M.id}`))}catch{}},q=o=>{F(o)},z=o=>{F(o)};return w.useEffect(()=>{r(ae()),r(W()),r(ne(K))},[r]),w.useEffect(()=>{p&&u.setFieldsValue({saleCommission:p.commissionValue,commissionType:p.commissionType})},[u,p]),e.jsx(e.Fragment,{children:e.jsx(pe,{title:"Sale",open:d,footer:!1,onCancel:()=>j(!1),children:e.jsxs(m,{form:u,className:"m-lg-1",onFinish:h,name:"dynamic_form_nest_item",initialValues:{discount:0,paidAmount:[{amount:c||0,paymentType:1}],vatId:[]},onKeyDown:o=>{o.key==="Enter"&&o.preventDefault()},layout:"vertical",size:"large",autoComplete:"off",children:[V==="true"&&e.jsxs(e.Fragment,{children:[e.jsx(m.Item,{name:"saleCommission",className:"mb-0 max-w-full",label:"Sale Commission",children:e.jsx(Q,{className:"discountType",addonAfter:e.jsx(m.Item,{name:"commissionType",noStyle:!0,children:e.jsxs(I,{size:"small",style:{width:50},defaultValue:"flat",popupClassName:"bg-white",onChange:z,children:[e.jsx(I.Option,{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:P==null?void 0:P.currencySymbol}})},"flat"),e.jsx(I.Option,{children:"%"},"percentage")]})}),placeholder:"0",style:{width:"100%"},onChange:q,size:"small"})}),e.jsx("div",{className:"flex items-center justify-between p-1 text-gray-600 duration-200",children:e.jsxs("span",{children:["Total:"," ",a?Number(a).toFixed(2):0]})})]}),e.jsx(m.Item,{className:"mb-0",label:e.jsxs(e.Fragment,{children:["Terms and conditions",n&&e.jsx("button",{onClick:()=>v(!1),className:"py-1 px-2 bg-red-200 rounded ml-1 text-gray-500",children:"Cancel"})]}),name:"termsAndConditions",children:n?e.jsx(X.TextArea,{onChange:o=>v(o),value:n}):e.jsx(I,{className:"w-full",loading:s,showSearch:!0,placeholder:"Select Terms and conditions",onSelect:o=>v(o),children:S&&(S==null?void 0:S.map(o=>e.jsx(I.Option,{value:o.subject,children:o.title},o.id)))})}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("strong",{children:"Total amount: "}),e.jsx("strong",{children:f.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Total discount: "}),e.jsx("span",{children:Number(A).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Total tax amount: "}),e.jsx("span",{children:b.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("strong",{children:"Total payable: "}),e.jsx("strong",{children:N.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("strong",{children:"Due: "}),e.jsx("strong",{children:c.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Paid Amount: "}),e.jsx(ve,{totalCalculator:C})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(m.Item,{className:"w-full mb-0",children:e.jsx(G,{block:!0,type:"primary",htmlType:"submit",children:"Sale Now"})})})]})})})}function Se({form:d,totalCalculator:j,setSelectedProduct:u,storeId:b,setStoreId:f}){const N=B(),[A,C]=w.useState({page:1,count:10,status:"true"}),{list:c,total:x,loading:t}=L(s=>s.products),{list:l,loading:r,defaultStore:n}=L(s=>s.store),v=(s,p)=>{C(T=>({...T,page:s,count:p}))};w.useEffect(()=>{N(ce(A)),N(oe())},[N,A]);const V=s=>{var y,a,h,q,z,o;if(!b)return Y.error("Please select a store first"),null;const T=d.getFieldValue("saleInvoiceProduct")||[];T.find(k=>k.productId===s.id)||(u(k=>[...k,s]),d.setFieldsValue({saleInvoiceProduct:[...T,{productId:s.id,productSalePrice:(y=s.stockInfo[0])==null?void 0:y.productSalePrice,productQuantity:(a=s==null?void 0:s.stockInfo[0])!=null&&a.productQuantity?1:0,productName:s.name,productVat:((h=s.productGroup.salesTax)==null?void 0:h.percentage)||0,productDiscount:(q=s.discount)!=null&&q.value?parseInt((z=s.discount)==null?void 0:z.value):0,discountType:((o=s.discount)==null?void 0:o.type)||"flat"}]}),j())},P=({item:s,index:p})=>{var F,y,a;const T=h=>{h.target.src="/images/default.jpg"};return e.jsx(je,{style:{width:"100%",border:"none",height:"120px"},bodyStyle:{backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",height:"120px"},className:"relative  bg-white hover:bg-white hover:shadow-md duration-150 overflow-hidden cursor-pointer",onClick:()=>{V(s)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-[80px] h-[44px] relative",children:e.jsx("img",{alt:"example",className:"absolute object-cover w-full h-full",src:s.productThumbnailImageUrl||"",onError:T,style:{width:"100%",height:"auto"}})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("p",{className:"font-bold mb-0",children:H(s.name,20)}),e.jsxs("p",{className:"mb-0",style:{fontSize:"12px"},children:["Price : ",(F=s.stockInfo[0])==null?void 0:F.productSalePrice]}),e.jsxs("p",{className:`${(y=s.stockInfo[0])!=null&&y.productQuantity?"bg-violet-600":"bg-red-600"} text-white p-1 absolute top-0 left-0`,style:{fontSize:"12px"},children:["QTY: ",((a=s.stockInfo[0])==null?void 0:a.productQuantity)||0]}),e.jsxs("p",{style:{fontSize:"12px"},children:[" ","SKU : ",H(s.sku,10)]})]})]})})},S=s=>{C(p=>({...p,storeId:s})),f(s),d.setFieldsValue({saleInvoiceProduct:[]})};return w.useEffect(()=>{n!=null&&n.id&&f(n.id)},[n==null?void 0:n.id]),e.jsxs("div",{className:"flex flex-col max-h-[200px] lg:max-h-[calc(100vh-180px)] overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 pb-3 lg:pb-0",children:[e.jsx(ye,{className:"w-full mt-4 mx-2",form:d,totalCalculator:j,setSelectedProduct:u}),e.jsx(m.Item,{rules:[{required:!0,message:"Please select a store"}],className:"mb-0",children:e.jsx(I,{className:"w-[200px] mt-4 mb-0",loading:r,showSearch:!0,onChange:S,placeholder:"Select a store",optionFilterProp:"children",value:b,children:l==null?void 0:l.map(s=>e.jsx(I.Option,{value:s.id,children:s.name},s.id))})})]}),e.jsx("div",{className:"hidden lg:grid flex-grow  grid-cols-1 lg:grid-cols-2 3xl:grid-cols-3 gap-2 mt-5",children:c?c.map((s,p)=>e.jsx(P,{index:p,item:s},p)):t&&e.jsx("div",{className:"w-100 flex justify-center items-center",children:e.jsx(he,{size:"large"})})}),e.jsx("div",{className:"hidden lg:block",children:x>=11&&e.jsx("div",{className:"mt-4",children:e.jsx(re,{onChange:v,total:x})})})]})}const De=d=>{const[j]=m.useForm(),u=m.useForm()[0],b=B(),[f,N]=w.useState(null),[A,C]=w.useState([]),[c,x]=w.useState([]),[t,l]=w.useState(0),[r,n]=w.useState(!1),{list:v,loading:V}=L(a=>a.vatTax),{validList:P,loading:S}=L(a=>a.coupon);w.useEffect(()=>{b(J()),b(de())},[b]);const s=()=>{const a=j.getFieldValue("saleInvoiceProduct"),h=(a==null?void 0:a.reduce((D,i)=>{const E=(i==null?void 0:i.productQuantity)||0,g=(i==null?void 0:i.productSalePrice)||0;let _=(i==null?void 0:i.productDiscount)||0;(i==null?void 0:i.discountType)==="percentage"&&(_=g*E*(i==null?void 0:i.productDiscount)/100);const U=(i==null?void 0:i.productVat)||0,O=g*E-_,Z=U/100*O;return[...D,{subDiscount:_,subVatAmount:Z,subPrice:O}]},[]))||[];x(h);const q=h.reduce((D,i)=>D+i.subPrice,0),z=h.reduce((D,i)=>D+i.subVatAmount,0),o=q+z,k=u.getFieldValue("paidAmount")||[],$=k==null?void 0:k.reduce((D,i)=>D+(i.amount?parseInt(i.amount):0),0),M=o-$;l(M)},p=c.reduce((a,h)=>a+h.subPrice,0),T=c.reduce((a,h)=>a+h.subVatAmount,0),F=c.reduce((a,h)=>a+h.subDiscount,0),y=p+T;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"h-full min-h-[calc(100vh-160px)] relative pb-2",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row gap-3 h-full",children:[e.jsx("div",{className:"2xl:w-2/5  xl:w-1/2 p-2 bg-[#F1F1F1] h-full",children:e.jsx(Se,{setSelectedProduct:C,form:j,setStoreId:N,storeId:f,totalCalculator:s})}),e.jsx("div",{className:"2xl:w-3/5 xl:w-1/2 p-5",children:e.jsx(Ne,{form:j,storeId:f,setSelectedProduct:C,selectedProduct:A,totalCalculator:s,subTotal:c,setIsModalOpen:n})})]}),e.jsx(we,{form:u,isModalOpen:r,productForm:j,storeId:f,setIsModalOpen:n,due:t,total:p,totalPayable:y,totalTaxAmount:T,totalDiscount:F,totalCalculator:s,vatTaxList:v,vatTaxLoading:V,validList:P,validLoading:S})]}),e.jsx("div",{className:"sticky bottom-0 right-0 w-full  border rounded bg-white p-2 px-5 mt-3 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium md:font-semibold text-lg",children:"Net Total"}),":"," ",e.jsx("span",{className:"font-bold text-base lg:text-xl",children:y.toFixed(3)})]}),e.jsx("div",{children:e.jsx(G,{onClick:()=>j.submit(),type:"primary",children:e.jsx("strong",{children:"Continue Sale"})})})]})})]})};export{De as default};
