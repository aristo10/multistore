import{cM as w,cS as $,cN as e,cQ as S,cL as L,r as C,cT as z,dt as E,dc as O}from"./vendor-3a94a37a.js";import{fp as M,am as G,s as W,aZ as Y,aX as k,aW as Q,g$ as H,C as T,bt as K,L as U}from"./index-ed7845ca.js";import{L as D}from"./List-9eb27318.js";import{T as X,a as I}from"./Tabs-8f68912a.js";import{u as B}from"./useCurrency-4b14dd3d.js";import{P as Z}from"./PurchaseProductListCard-59db7397.js";import{V as _}from"./ViewBtn-ffc9b5cb.js";import{i as q}from"./invoiceGenerator-eaeb8720.js";import{n as J}from"./numberToWords-4c291141.js";import ee from"./AddTransaction-603c2655.js";import{S as te}from"./SendPurchaseInvoice-d5c1d00e.js";import{n as oe,d as re,e as ae}from"./vendor-large-f75deccb.js";import"./AddAccount-8cfc0f4b.js";import"./BigDrawer-240149a9.js";import"./emailConfigSlice-145edc06.js";import"./purchasePDF-c30bf5e1.js";import"./TagInput-f33dd18b.js";import"./AddProduct-aa890cea.js";import"./ImageUploader-c0ae741f.js";import"./MediaGallery-5095f29f.js";import"./UploaderWithDrag-568744bd.js";import"./AddManufacturer-2f6bafee.js";import"./AddProductBrand-894ab785.js";import"./UploadMany-c4472299.js";import"./AddProductSubcategory-71762def.js";import"./AddProductCategory-6511f02f.js";import"./AddUoM-1dc09ff9.js";import"./AddVatTax-97a0925d.js";import"./FormProductListCard-571d2cbc.js";import"./AddProductAttribute-4ec2c5fe.js";import"./AddProductAttributeValue-d16feddc.js";import"./AddDiscount-05e89f9a.js";function ne(o){var R;const n=w(j=>{var g;return(g=j==null?void 0:j.setting)==null?void 0:g.data})||null,{currencySymbol:u}=B()||{},t=M(u),{status:s,totalPaidAmount:p,totalReturnAmount:c,instantPaidReturnAmount:x,dueAmount:r,singlePurchaseInvoice:d,returnPurchaseInvoice:A,transactions:m}=o||{},{totalAmount:i,totalTax:b,purchaseInvoiceProduct:l,store:F,supplier:P,note:N,createdAt:y,id:v}=d||{},f=(i||0)+(b||0)+(x||0)-(c||0),a=`Your order has been received. Order ID #${v} `,h=`<div>
        <p>Dear <strong>${(R=d==null?void 0:d.supplier)==null?void 0:R.name}</strong>,</p>
        <p>Greetings! We trust this message reaches you in great spirits. We are immensely grateful for the privilege of having you as our esteemed supplier.</p>
    </div>
<br>
    <div class="order-info">
        <strong>Order Information:</strong><br>
        Order ID: ${v}<br>
        Order Date: ${$(d==null?void 0:d.date).format("ll")}
    </div>
<br>
    <div class="invoice-details">
        <strong>Invoice Details:</strong><br>
        Total Amount: ${t}${i?Number(i).toFixed(2):0}<br>
        Total Tax: ${t}${b?Number(b).toFixed(2):0}<br>
  ${c?`Return Product Value: ${t}${c?Number(c).toFixed(2):0}<br>`:""}
  ${x?`Return Amount: ${t}${x?Number(x).toFixed(2):0}<br>`:""}
  Grand Total: ${t}${i?Number(f).toFixed(2):0}<br>
        Paid Amount: ${t}${p?Number(p).toFixed(2):0}<br>
        Due Amount: ${t}${r?Number(r).toFixed(2):0}
    </div>
<br>
    <div class="company-info">
        Best Regards,<br>
        <strong>${n==null?void 0:n.companyName}</strong><br>
        ${n==null?void 0:n.phone}<br>
        ${n==null?void 0:n.email}
    </div>`;return{subject:a,body:h}}const le=({list:o})=>{const n=[{id:2,title:"ID",dataIndex:"id",key:"id"},{id:3,title:"Total Amount",key:"totalAmount",render:({totalAmount:t,tax:s})=>`${t+(s||0)}`},{id:4,title:"Note",dataIndex:"note",key:"note"},{id:3,title:"Date",dataIndex:"date",key:"date",render:t=>$(t).format("ll")},{id:1,title:"Action",key:"returnPurchaseInvoiceProduct",render:({id:t})=>e.jsx(_,{path:`/admin/purchase-return-list/${t}`})}],u=t=>t.map(s=>({...s,key:s.id}));return e.jsx("div",{className:"m-2",children:e.jsx(G,{scroll:{x:!0},loading:!o,columns:n,data:o?u(o):[]})})},se=({list:o})=>{const n=[{id:1,title:"ID",dataIndex:"id",key:"id",render:t=>e.jsx(S,{to:`/admin/transaction/${t}`,children:t})},{id:2,title:"Date",dataIndex:"date",key:"date",render:t=>$(t).format("ll")},{id:3,title:"Debit",dataIndex:"debit",key:"debit",render:t=>t.name},{id:4,title:"Credit",dataIndex:"credit",key:"credit",render:t=>t.name},{id:5,title:"Amount",dataIndex:"amount",key:"amount"},{id:6,title:"Type ",dataIndex:"type",key:"type"},{id:7,title:"Particulars",dataIndex:"particulars",key:"particulars",render:t=>e.jsx("div",{title:t,children:W(t,20)})}],u=t=>t.map(s=>({...s,key:s.id}));return e.jsx("div",{className:"m-2",children:e.jsx(G,{scroll:{x:!0},loading:!o,columns:n,data:o?u(o):[]})})};function ie({data:o,title:n}){var N,y,v,f;const{currencyName:u}=B()||{},t=w(a=>{var h;return(h=a==null?void 0:a.setting)==null?void 0:h.data})||null,s=L(),p=J(Math.round(o.totalAmount+(o.totalTax?o.totalTax:0))),{totalPaidAmount:c,dueAmount:x,singlePurchaseInvoice:r}=o||{},d=Number((r.totalAmount||0)+(r.totalTax||0)-(o.totalReturnAmount||0)+(o.instantPaidReturnAmount||0)),A=[{label:"GRAND TOTAL IN WORDS: ",value:`${p.toUpperCase()} ${u}`||""},{label:"Terms And Conditions: ",value:o.termsAndConditions?o.termsAndConditions:""},{label:"Notes: ",value:r.note?r.note:""}],m=[{label:"Total Amount",value:` ${r.totalAmount.toFixed(2)}`},{label:"Total Tax (+)",value:` ${r.totalTax.toFixed(2)}`},o.totalReturnAmount&&{label:"Return Product Value (-)",value:` ${o.totalReturnAmount?o.totalReturnAmount.toFixed(2):0}`},o.instantPaidReturnAmount&&{label:"Return Amount (+)",value:`${o.instantPaidReturnAmount?o.instantPaidReturnAmount.toFixed(2):0}`},{label:"Grand Total",value:`${d.toFixed(2)}`,style:{borderTop:!0}},{label:"Paid Amount (-)",value:` ${c.toFixed(2)}`},{label:"Due Amount:",value:` ${x.toFixed(2)}`,style:{borderTop:!0}}],i=["SL","Name","Quantity","Price","Amount","Tax"],b=(N=r==null?void 0:r.purchaseInvoiceProduct)==null?void 0:N.map((a,h)=>[h+1,a.product.name,a.productQuantity,` ${a.productUnitPurchasePrice}`,` ${a.productFinalAmount}`,` ${a.tax}`]),l=[{value:`Supplier Id: ${r==null?void 0:r.supplierId}`},{value:`Supplier Name: ${(y=r==null?void 0:r.supplier)==null?void 0:y.name}`},{value:`Address: ${(v=r==null?void 0:r.supplier)==null?void 0:v.address}`},{value:`Contact No: ${(f=r==null?void 0:r.supplier)==null?void 0:f.phone}`}],F=[{value:`Invoice No: ${r==null?void 0:r.id}`},{value:`Invoice Date: ${$(o==null?void 0:o.date).format("YYYY-MM-DD")}`},{value:`Currency: ${u}`}],P={jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:8,footerFontSize:10};return C.useEffect(()=>{!t&&s(Y())},[s,t]),e.jsx("div",{className:"",children:e.jsx(k,{color:"primary",onClick:()=>q("print",{title:n,TopRightInfo:F,customerInfo:l,companyInfo:t,bottomLeftContent:A,bottomRightContent:m,tableBody:b,tableHead:i,settings:P,leftBottomSecondColumnX:55}),children:"Print"})})}const Oe=()=>{const{id:o}=z(),[n,u]=C.useState(!1),[t,s]=C.useState(!1),p=L(),c=w(V=>V.purchases.purchase),{subject:x,body:r}=ne(c),{status:d,totalPaidAmount:A,totalReturnAmount:m,instantPaidReturnAmount:i,dueAmount:b,singlePurchaseInvoice:l,returnPurchaseInvoice:F,transactions:P}=c||{},{totalAmount:N,totalTax:y,purchaseInvoiceProduct:v,store:f,supplier:a,note:h,createdAt:R,id:j}=l||{},g=(N||0)+(y||0)+(i||0)-(m||0);return C.useEffect(()=>(p(Q(o)),()=>{p(H())}),[p,o]),e.jsxs("div",{children:[e.jsx("div",{children:l?e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(T,{className:"w-2/3",bodyClass:"p-0",children:[e.jsx("div",{className:"flex justify-between mx-2 py-2 border-b items-center",children:e.jsxs("div",{className:" flex gap-3",children:[e.jsx("div",{children:e.jsx(ie,{title:"Purchase Invoice",data:c})}),e.jsx(k,{className:"flex-row-reverse",color:"gray",icon:e.jsx(E,{size:15}),onClick:()=>{u(!0)},children:"Send"}),e.jsx(oe,{content:e.jsx(K,{items:[{key:"1",label:e.jsx(S,{to:`/admin/payment/supplier/${j}`,state:{dueAmount:b},children:"Payment"})},{key:"status",label:e.jsxs(S,{to:`/admin/purchase/return/${o}`,children:["Return Product"," "]})}]}),placement:"bottomRight",arrow:!1,trigger:"click",children:e.jsx(k,{color:"gray",icon:e.jsx(O,{size:15}),className:"  px-3"})})]})}),n?e.jsx("div",{children:e.jsx(te,{subject:x,body:r,setSendForm:u,supplierEmail:a==null?void 0:a.email,invoice:l})}):e.jsxs(X,{className:"mt-4",children:[e.jsx(I,{label:"Products",children:e.jsx(Z,{list:v})}),e.jsx(I,{label:"Return products",children:e.jsx(le,{list:F})}),e.jsx(I,{label:"Transactions",children:e.jsx(se,{list:P})})]})]}),e.jsxs("div",{className:"w-1/3 flex flex-col gap-2",children:[e.jsx(T,{title:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"font-normal",children:["Invoice No"," ",e.jsxs("span",{className:"font-semibold",children:["#",j]})]})}),children:e.jsx(e.Fragment,{children:e.jsx(D,{labelClassName:"w-[40%]",list:[{label:"Invoice Date",value:$(R).format("ll")},{label:"Payment",value:e.jsx(re,{color:d==="PAID"?"green":"red",children:d})},{label:"Store",value:f==null?void 0:f.name}]})})}),e.jsx(T,{title:"Payment Details ",children:e.jsx(D,{list:[{label:"Total Amount",value:l!=null&&l.totalAmount?Number(l.totalAmount).toFixed(2):0},{label:"Total Tax",value:e.jsx("div",{className:"before:content-['+'] relative before:absolute before:text-green-500 before:font-bold before:-left-3 before:top-0",children:l!=null&&l.totalTax?Number(l.totalTax).toFixed(2):0}),hidden:(l==null?void 0:l.totalTaxAmount)===0},{label:"Return Product Value",value:e.jsx("div",{className:"before:content-['-'] relative before:absolute before:text-red-500 before:font-bold before:-left-3 before:top-0",children:m?Number(m).toFixed(2):0}),hidden:m===0&&i===0},{label:"Return Amount",value:e.jsxs("div",{className:"before:content-['+'] relative before:absolute before:text-green-500 before:font-bold before:-left-3 before:top-0",children:[i?Number(i).toFixed(2):0,m!=i&&e.jsx(k,{onClick:()=>s(!0),className:"absolute right-4 -top-[23px] inline-block w-auto min-w-[100px] border-blue-400 border-[1.5px] rounded px-3",children:"Get Refund"})]}),hidden:m===0&&i===0},{label:"Grand Total",value:e.jsx("div",{className:"before:content-['='] relative before:absolute before:text-blue-500 before:font-bold before:-left-3 before:top-0",children:g.toFixed(2)}),className:"border-t pt-1"},{label:"Paid Amount",value:e.jsx("div",{className:"before:content-['-'] relative before:absolute before:text-red-500 before:font-bold before:-left-3 before:top-0",children:A?Number(A).toFixed(2):0}),className:"border-b pb-1"},{label:"Due Amount",value:b?Number(b).toFixed(2):0}]})}),e.jsx(T,{title:"Supplier Details",children:e.jsx(D,{labelClassName:"w-[40%]",list:[{label:"Name",value:e.jsx(S,{to:`/admin/supplier/${a.id}`,children:a.name})},{label:"Phone",value:a.phone},{label:"Address",value:a.address}]})}),e.jsx(T,{children:e.jsx(D,{labelClassName:"w-[40%] font-bold",list:[{label:"Note",value:h,className:"flex-col gap-1"}]})})]})]}):e.jsx(U,{})}),e.jsx(ae,{title:"Get Refund",width:"40%",onClose:()=>s(!1),open:t,bodyStyle:{paddingBottom:80},children:e.jsx(ee,{preFieldValue:{relatedId:j,type:"purchase_return"}})})]})};export{Oe as default};
