import{cN as e,cV as me,r as p,c_ as G,cL as K,cM as S,cO as xe,cQ as ue,cS as pe,cT as he}from"./vendor-3a94a37a.js";import{d as je,ac as fe,aP as ge,a1 as Ne,cz as be,cA as ye,am as ve,gP as we,gQ as Pe,L as Ie}from"./index-ed7845ca.js";import{C as R}from"./card.components-753b0382.js";import{C as Ce}from"./CommonDelete-4339174a.js";import{C as Se}from"./CreateDrawer-a7af16b9.js";import{N as Ae}from"./NewQuotationInvoice-63e8ba59.js";import{A as De}from"./AddCustomer-f6c915fd.js";import{B as Ve}from"./BigDrawer-240149a9.js";import{F as n,b as w,I as Y,h as O,j as Te,B as E,P as Qe,D as Fe,C as W,m as ke,G as qe}from"./vendor-large-f75deccb.js";import{V as ze}from"./ViewBtn-ffc9b5cb.js";import"./invoiceGenerator-eaeb8720.js";import"./numberToWords-4c291141.js";import"./useCurrency-4b14dd3d.js";import"./UploadMany-c4472299.js";function Me({form:d,productList:r,productLoading:t,totalCalculator:a,subTotal:f}){const B=(N,P)=>{const A=d.getFieldValue("saleInvoiceProduct"),o=r.find(h=>h.id===N);o.productQuantity===0&&me.error("Product is out of stock");const m=A.map((h,x)=>x===P?{...h,productQuantity:o.productQuantity?1:0,productSalePrice:o.productSalePrice,productVat:o.productVat?o.productVat:0,unitMeasurement:o==null?void 0:o.unitMeasurement}:h);d.setFieldsValue({saleInvoiceProduct:m}),a(P)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsx("div",{className:"col-span-1 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"SL"}),e.jsx("div",{className:"col-span-3 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Product"}),e.jsx("div",{className:"col-span-1 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"U.M."}),e.jsx("div",{className:"col-span-1 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Quantity"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Sale Price"}),e.jsx("div",{className:"col-span-1 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Vat"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Total"}),e.jsx("div",{className:"col-span-1 md:text-base xxs:text-xs sm:text-sm",children:"Delete"})]}),e.jsx("hr",{style:{backgroundColor:"black",marginTop:"0.5rem"}}),e.jsx(n.List,{name:"saleInvoiceProduct",rules:[{required:!0,message:"Product is required"}],children:(N,{add:P,remove:A})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-[300px] overflow-y-auto overflow-x-hidden mt-2",children:N.map(({key:o,name:m,...h},x)=>{var D,V,T,Q;return e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsx("div",{className:"col-span-1",children:x+1}),e.jsx("div",{className:"col-span-3",children:e.jsx(n.Item,{...h,name:[m,"productId"],rules:[{required:!0,message:"Product is required"}],children:e.jsx(w,{placeholder:"Select Product",showSearch:!0,loading:t,optionFilterProp:"children",filterOption:(c,u)=>u.children.toLowerCase().includes(c.toLowerCase()),onChange:c=>{B(c,x)},children:r==null?void 0:r.map(c=>e.jsx(w.Option,{value:c.id,children:c.name},c.id))})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(n.Item,{...h,name:[m,"unitMeasurement"],children:e.jsx(Y,{disabled:!0,style:{width:"100%"},size:"small",placeholder:"U.M.",onChange:()=>a(x)})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(n.Item,{...h,name:[m,"productQuantity"],rules:[{required:!0,message:"quantity is required"}],children:e.jsx(O,{style:{width:"100%"},size:"small",placeholder:"Quantity",onChange:()=>a(x)})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(n.Item,{...h,name:[m,"productSalePrice"],rules:[{required:!0,message:"Price is required"}],children:e.jsx(O,{size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>a(x)})})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"font-weight-bold md:text-base xxs:text-xs",children:[((V=(D=f[x])==null?void 0:D.subVat)==null?void 0:V.percentage)||0,"%"]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs",children:((Q=(T=f[x])==null?void 0:T.subPrice)==null?void 0:Q.toFixed(2))||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx(n.Item,{children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center bg-red-600 text-white p-2 rounded-md",onClick:()=>{A(m),a(x)},children:e.jsx(Te,{className:""})})})})]},o)})}),e.jsx(n.Item,{style:{marginTop:"20px"},children:e.jsx(E,{type:"dashed",onClick:()=>P(),block:!0,icon:e.jsx(Qe,{}),children:"Add Product"})})]})})]})}const Le=Number(localStorage.getItem("id"));function Oe({quote:d}){var _;const{Option:r}=w,[t,a]=p.useState(!1),[f,B]=p.useState([]),[N,P]=p.useState(0),[A,o]=p.useState(0),[m,h]=p.useState(0),[x,D]=p.useState(0),[V,T]=p.useState("false"),Q=G(),c=K(),[u]=n.useForm(),F=S(s=>s.customers.list),{list:J,loading:X}=S(s=>s.products),{validList:I,loading:Z}=S(s=>s.coupon),[ee,se]=p.useState(Le),k=S(s=>s.users.list),{list:z,loading:te}=S(s=>s.vatTax);p.useEffect(()=>{c(je({query:"all"})),c(fe({page:1,count:10})),c(ge({page:1,count:10})),c(Ne()),c(be())},[c]);const ae=async s=>{try{const i=s.saleInvoiceProduct.reduce((y,v)=>{const M=v.productId;return y[M]?y[M].productQuantity+=v.productQuantity:y[M]={...v},y},{}),q=Object.values(i),b={...s,userId:ee,isHold:V,saleInvoiceProduct:q},g=await c(ye(b));T("false"),g.payload.message==="success"?(u.resetFields(),a(!1),Q(V==="true"?"/admin/hold-sale":`/admin/sale/${g.payload.data.id}`)):a(!1)}catch{a(!1)}},le=(s,i)=>i>=0&&i<=m?Promise.resolve():Promise.reject(`Paid amount must be gater than or equal ${m}`),ne=(s,i)=>i>=0&&i<=N?Promise.resolve():Promise.reject(`Discount must be gater than or equal ${N}`),C=()=>{const s=u.getFieldValue("saleInvoiceProduct"),i=(s==null?void 0:s.reduce((j,l)=>{var H;const L=(l==null?void 0:l.productQuantity)||0,U=(l==null?void 0:l.productSalePrice)||0,oe=(((H=l==null?void 0:l.productVat)==null?void 0:H.percentage)||0)/100*U*L;return[...j,{subVat:(l==null?void 0:l.productVat)||0,subPrice:U*L+oe}]},[]))||[];B(i);const q=i.reduce((j,l)=>j+l.subPrice,0)||0;P(q);const b=q&&q-(u.getFieldValue("discount")||0)||0;o(b);let g=b;const y=u.getFieldValue("couponCode");if(y){const j=I==null?void 0:I.find(l=>l.couponCode===y);j.type==="percentage"?g=b-j.value/100*b:g=b-j.value}const v=u.getFieldValue("vatId"),ce=((v==null?void 0:v.map(j=>{var l;return(l=z.find(L=>j===L.id))==null?void 0:l.percentage}))||[]).reduce((j,l)=>j+l,0),$=g+ce/100*g;h($);const re=g&&$-(u.getFieldValue("paidAmount")||0)||0;D(re)},ie=()=>{u.setFieldsValue({paidAmount:m}),D(0)},de=(_=d==null?void 0:d.quoteProduct)==null?void 0:_.map(s=>{var i;return{productId:s.productId,unitMeasurement:s.unitMeasurement,productQuantity:s.productQuantity,productSalePrice:s.unitPrice,productVat:(i=s.product)==null?void 0:i.productVat}});return p.useEffect(()=>{C()},[]),e.jsxs(n,{form:u,name:"dynamic_form_nest_item",onFinish:ae,onFinishFailed:()=>{a(!1)},size:"large",autoComplete:"off",initialValues:{paidAmount:0,discount:0,date:xe(),vatId:[],saleInvoiceProduct:de,userId:(d==null?void 0:d.quoteOwnerId)||null},children:[e.jsx(Me,{form:u,totalCalculator:C,subTotal:f,productList:J,productLoading:X}),e.jsxs("div",{className:"flex gap-5 my-5",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(n.Item,{label:"Customer",className:"w-full",name:"customerId",rules:[{required:!0,message:"Please Select a Customer!"}],children:e.jsx(w,{className:"w-full",loading:!F,showSearch:!0,placeholder:"Select a customer ",optionFilterProp:"children",filterOption:(s,i)=>i.children.toLowerCase().includes(s.toLowerCase()),children:F&&(F==null?void 0:F.map(s=>e.jsx(r,{value:s.id,children:s.username},s.id)))})}),e.jsx(Ve,{className:"mb-[25px]",title:"new Customer",btnTitle:"customer",children:e.jsx(De,{drawer:!0})})]}),e.jsxs("div",{className:"flex gap-5",children:[e.jsx(n.Item,{label:"Date",required:!0,className:"w-1/2",name:"date",rules:[{required:!0,message:"Please input Date!"}],children:e.jsx(Fe,{style:{marginBottom:"10px"},label:"date",size:"small",format:"YYYY-MM-DD"})}),e.jsx(n.Item,{className:"w-1/2",label:"Sales Person ",name:"userId",required:!0,children:e.jsx(w,{className:"w-full",loading:!k,showSearch:!0,placeholder:"Select sales person ",optionFilterProp:"children",onChange:s=>se(s),filterOption:(s,i)=>i.children.toLowerCase().includes(s.toLowerCase()),children:k&&(k==null?void 0:k.map(s=>e.jsx(r,{value:s.id,children:s.username},s.id)))})})]}),e.jsx(n.Item,{className:"",label:"Shipping Address",name:"address",children:e.jsx(Y,{className:"",placeholder:"Enter shipping address",size:"small",style:{marginBottom:"10px"}})}),e.jsx(n.Item,{className:"",label:"Note",name:"note",children:e.jsx(Y,{className:"",size:"small",placeholder:"Write sale Note",style:{marginBottom:"10px"},label:"note"})})]}),e.jsxs("div",{className:"w-1/2",children:[" ",e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"p-1 flex justify-between",children:[e.jsx("strong",{children:"Total: "}),e.jsxs("strong",{children:[N.toFixed(2)," "]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"",children:"Discount: "}),e.jsx(n.Item,{className:"mb-0",name:"discount",rules:[{validator:ne}],children:e.jsx(O,{className:"w-72",size:"small",onChange:()=>C()})})]}),e.jsxs("div",{className:"py-1 flex justify-between items-center mb-1",children:[e.jsx("span",{children:"After Discount: "}),e.jsx("span",{children:A.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"",children:"Vat/Tax: "}),e.jsx(n.Item,{className:"mb-0 w-4/5 flex justify-end",name:"vatId",children:e.jsx(w,{mode:"multiple",className:"w-72 ",placeholder:"Select Vat/Tax type",maxTagCount:1,size:"small",loading:te,onChange:()=>C(),children:z==null?void 0:z.map(s=>e.jsxs(r,{value:s.id,children:[s.title,e.jsxs("span",{className:"italic",children:["@",s.percentage,"%"]})]},s.id))})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"",children:"Coupon Code: "}),e.jsx(n.Item,{className:"mb-0 w-4/5 flex justify-end",name:"couponCode",children:e.jsx(w,{className:"w-72",allowClear:!0,placeholder:"Select coupon code",size:"small",loading:Z,showSearch:!0,onChange:()=>C(),children:I==null?void 0:I.map(s=>e.jsx(r,{value:s.couponCode,children:e.jsx("span",{className:"italic",children:s.couponCode})},s.id))})})]}),e.jsxs("div",{className:"py-1 flex justify-between items-center mb-1",children:[e.jsx("span",{children:"Total Payable: "}),e.jsx("span",{children:m.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"",children:"Paid Amount: "}),e.jsxs("div",{className:"w-92 flex items-center justify-between gap-2",children:[e.jsx("button",{className:"bg-primary py-1 rounded px-2 text-white",type:"button",onClick:ie,children:"Paid All"}),e.jsx(n.Item,{className:"mb-0",name:"paidAmount",rules:[{validator:le}],children:e.jsx(O,{className:"w-72",onChange:()=>C(),size:"small"})})]})]}),e.jsxs("div",{className:"py-1 mb-1 flex justify-between",children:[e.jsx("strong",{children:"Due Amount:"}),e.jsx("strong",{children:x.toFixed(2)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n.Item,{style:{marginTop:"15px"},className:"w-1/2",children:e.jsx(E,{block:!0,type:"dashed",htmlType:"button",loading:t,onClick:()=>{a(!0),T("true"),setTimeout(()=>{u.submit()},.5)},children:"Save Draft"})}),e.jsx(n.Item,{style:{marginTop:"15px"},className:"w-1/2",children:e.jsx(E,{block:!0,type:"primary",htmlType:"submit",loading:t,onClick:()=>a(!0),children:"Sale Product"})})]})]})]})]})}const Be=({quoteProduct:d})=>{const r=[{title:"ID",dataIndex:"productId",key:"productId"},{title:"Name",dataIndex:"product",key:"product.name",render:a=>e.jsx(ue,{to:`/admin/product/${a.id}`,children:a.name})},{title:"Product Quantity",dataIndex:"productQuantity",key:"productQuantity"},{title:"Product Unit Price",dataIndex:"unitPrice",key:"unitPrice"},{title:"Create Date",dataIndex:"createdAt",key:"createdAt",render:a=>pe(a).format("YYYY-MM-DD")},{title:"Action",key:"Action",render:({id:a})=>e.jsx(ze,{path:`/admin/product/${a}`})}],t=a=>a.map(f=>({...f,key:f.id}));return e.jsx(W,{className:"header-solid h-full",bordered:!1,title:e.jsx("h6",{className:"font-semibold m-0 text-center",children:"Quote Product List"}),bodyStyle:{paddingTop:"0"},children:e.jsx("div",{className:"mt-4",children:e.jsx(ve,{scroll:{x:!0},loading:!d,columns:r,data:d?t(d):[]})})})},Ye=Be;function as(){const{id:d}=he(),r=K(),{quote:t,loading:a}=S(f=>f.quote);return G(),p.useEffect(()=>{r(we(d))},[r,d]),e.jsx("div",{children:e.jsx("div",{children:t?e.jsx(p.Fragment,{children:e.jsxs(W,{bordered:!1,className:" h-full",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h5",{children:[e.jsx(ke,{}),e.jsxs("span",{children:["ID : ",t.id," |"]})]}),e.jsx("div",{className:"card-header flex justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{permission:"create-saleInvoice",title:"Create Invoice",width:85,children:e.jsx(Oe,{quote:t})}),!a&&t&&e.jsx(Ae,{title:"Quotation",data:t}),e.jsx(Ce,{permission:"delete-quote",deleteThunk:Pe,id:d,className:"p-3",navigatePath:"/admin/quote/"})]})})]}),e.jsxs("div",{className:"card-body mt-4",children:[e.jsxs("div",{className:"flex justify-between gap-10",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(qe.Ribbon,{text:t.status?"Accepted":"Pending",color:t.status?"green":"red",children:e.jsxs(R,{title:"Quote Information",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[14px] font-medium",children:"Quote Name:"}),e.jsxs("span",{className:"text-[14px] font-bold",children:[" ",t.quoteName]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[14px] font-medium",children:"Quote Date:"}),e.jsxs("span",{className:"text-[14px] font-bold",children:[" ",t.quoteDate]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[14px] font-medium",children:"Expiration Date:"}),e.jsxs("span",{className:"text-[14px] font-bold",children:[" ",t.expirationDate]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[14px] font-medium",children:"Terms And Conditions"}),e.jsxs("span",{className:"text-[14px] font-bold",children:[" ",t.termsAndConditions]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-center mt-2 mb-2 border-b",children:"Description"}),e.jsx("p",{children:t.description})]})]})})}),e.jsx("div",{className:"w-1/2",children:e.jsxs(R,{title:"Price Summary",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[14px] font-medium",children:"Total Amount:"}),e.jsxs("span",{className:"text-[14px] font-bold",children:[" ",t.totalAmount]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[14px] font-medium",children:"Discount:"}),e.jsxs("span",{className:"text-[14px] font-bold",children:[" ",t.discount]})]})]})})]}),e.jsx("br",{}),t&&e.jsx(Ye,{quoteProduct:t.quoteProduct})]})]})},t.id):e.jsx(Ie,{})})})}export{as as default};
