import{cL as S,r as o,cM as C,cN as e}from"./vendor-3a94a37a.js";import{Q as k,ae as v,s as I,bP as N,bQ as P,bR as M,bS as T,L as D,bT as F,aX as y,bU as L}from"./index-ed7845ca.js";import{C as U}from"./CommonDelete-4339174a.js";import{U as A}from"./UploaderWithDrag-568744bd.js";import{w as E}from"./vendor-large-f75deccb.js";function _({selectedImage:c,setSelectedImage:x}){const t=S(),[i,n]=o.useState({page:1,count:36}),{list:a,loading:u,total:f}=C(s=>s.media),[g,b]=o.useState(null),j=(s,d)=>{if(d.shiftKey){const l=a.slice(Math.min(s,g),Math.max(s,g)+1);x(l)}else{const l=a[s];c.find(r=>r.id===a[s].id)?x(r=>r.filter(h=>h.id!==a[s].id)):(x(r=>[...r,l]),b(s))}};let m=null;u?m=e.jsx(D,{}):(a==null?void 0:a.length)>0&&(m=e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map((s,d)=>{const l=c.find(h=>h.id===s.id),{isImage:w,typeText:r}=k(s.fileType);return e.jsx("div",{onClick:h=>j(d,h),className:v("border-2 border-transparent h-[100px] w-[100px] relative cursor-pointer bg-slate-400/20 overflow-hidden",{"border-blue-500":l}),title:s.fileName,children:w?e.jsx("img",{src:`${window.env.VITE_APP_API}/media/view/${s.id}`,alt:s.fileName,className:"content-center w-full h-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg font-semibold text-blue-600 opacity-20 h-full w-full flex justify-center items-center",children:e.jsx("span",{children:r})}),e.jsxs("span",{className:"absolute bottom-0 left-0 p-1 text-xs font-semibold",children:[e.jsx("div",{className:"mb-0.5",children:I(s.fileName,60)}),e.jsx("a",{href:window.env.VITE_APP_API+"/media/view/"+s.id,download:!0,target:"_blank",rel:"noreferrer",className:"text-blue-500 hover:text-blue-600",children:e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Download"})})]})]})},s.id)})})}));const p=(s,d)=>{n(l=>({...l,page:s,count:d}))};return o.useEffect(()=>(t(N(i)),()=>{t(P())}),[t,i]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-2  justify-between  pb-2 sticky top-0 bg-white w-full",children:[e.jsx(M,{setPageConfig:n}),e.jsx(T,{defaultPageSize:i.count,onChange:p,total:f})]}),m]})}function z(){const c=S(),{list:x}=C(s=>s.media),[t,i]=o.useState("gallery"),[n,a]=o.useState([]),[u,f]=o.useState([]),[g,b]=o.useState(!1),j=async()=>{b(!0);const s=new FormData;u.forEach(l=>{s.append("files[]",l.originFileObj)}),(await c(L(s))).payload.message==="success"&&(i("gallery"),f([]),c(N({page:1,count:36}))),b(!1)},m=s=>{s.target.checked?a([...x]):a([])};let p=null;return t==="gallery"?p=e.jsx(_,{selectedImage:n,setSelectedImage:a}):t==="upload"&&(p=e.jsx(A,{fileList:u,setFileList:f})),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col h-[calc(95vh-60px)] md:h-[calc(85vh-60px)]",children:[e.jsx("div",{className:"border-b shadow-[0,10px,15px,-3px,rgba(0,0,0,0.1),0,4px,6px,-4px,rgba(0,0,0,0.1)]",children:e.jsxs("div",{className:"flex justify-between items-end gap-2",children:[e.jsxs("div",{children:[t!=="upload"&&e.jsxs(e.Fragment,{children:[e.jsx(E,{onChange:m,className:"mx-2 "}),n.length>0&&e.jsx("span",{className:"text-sm mr-2",children:n.length})]}),e.jsx("button",{onClick:()=>i("gallery"),className:v("px-2",{"border-b-blue-500 border-b-2 font-medium":t==="gallery"}),children:"Media"}),e.jsx("button",{onClick:()=>i("upload"),className:v("px-2",{"border-b-blue-500 border-b-2 font-medium":t==="upload"}),children:"Upload"})]}),e.jsx("div",{className:"relative",children:n.length>0&&e.jsx("div",{className:"absolute -top-[30px] right-0",children:e.jsx(U,{deleteThunk:F,id:n.map(s=>s.id),permission:"delete-media",loadThunk:N,query:{page:1,count:36},className:"text-lg text-red-500",button:e.jsx(y,{className:"py-[2px] px-[4px] bg-red-500 hover:bg-red-600 text-white",children:"Delete"})})})})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto my-2 relative",children:p}),e.jsx("div",{children:e.jsx("div",{className:"flex justify-end gap-4",children:e.jsx("div",{className:"flex gap-2",children:t==="upload"&&e.jsx(y,{loading:g,onClick:j,color:"primary",children:"Upload"})})})})]})})}export{z as default};
