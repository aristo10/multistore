import{cL as P,cM as v,cN as e,d9 as q,r as x,c_ as L}from"./vendor-3a94a37a.js";import{al as Q,cm as F,cn as A}from"./index-ed7845ca.js";import{F as u,b as j,h as O,B as I,P as V}from"./vendor-large-f75deccb.js";function E({form:n,pageConfig:c}){P();const{list:o,loading:y}=v(s=>s.productSortList),N=(s,f)=>{const l=n.getFieldValue("reorderStocks"),p=o.find(d=>s===s),m=l.map((d,t)=>t===f?{...p,productQuantity:0}:d);n.setFieldsValue({reorderStocks:m})};return e.jsx(e.Fragment,{children:e.jsx(u.List,{name:"reorderStocks",rules:[{required:!0,message:"Product is required"}],children:(s,{add:f,remove:l})=>e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"font-Popins text-black bg-tableHeaderBg border-gray-200 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pl-2 text-left",children:"SL"}),e.jsx("th",{className:"py-2 pl-2 text-left min-w-[60%]",children:"Product"}),e.jsx("th",{className:"py-2 pl-2 text-left ",children:"Quantity"}),e.jsx("th",{className:"py-2 pl-2 text-left"})]})}),e.jsx("tbody",{className:"bg-tableBg",children:s.map(({key:p,name:m,...d},t)=>e.jsxs("tr",{className:`hover:bg-slate-900/10 py-1 ${t===s.length-1?"":"border-b"}`,children:[e.jsx("td",{className:"py-2 pl-2 align-top",children:t+1}),e.jsx("td",{className:"py-2 pl-2 align-top ",children:e.jsx(u.Item,{...d,name:[m,"productId"],className:"max-w-[600px]",rules:[{required:!0,message:"Product is required"}],children:e.jsx(j,{placeholder:"Select Product",showSearch:!0,loading:y,optionFilterProp:"children",filterOption:(i,h)=>h.children.toLowerCase().includes(i.toLowerCase()),onChange:i=>{N(i,t)},children:o==null?void 0:o.map(i=>{var h;return e.jsx(j.Option,{value:i.productId,children:(h=i.product)==null?void 0:h.name},i.productId)})})})}),e.jsxs("td",{className:"py-2 pl-2 align-top",children:[" ",e.jsx(u.Item,{...d,name:[m,"productQuantity"],rules:[{required:!0,message:"quantity is required"}],children:e.jsx(O,{size:"small",placeholder:"Quantity"})})]}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx(u.Item,{children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{l(m)},children:e.jsx(q,{size:25})})})})]},p))})]}),e.jsx("div",{className:"max-h-[calc(100vh-300px)] grid w-full overflow-y-auto overflow-x-visible mt-2"}),s.length===0&&e.jsx("div",{className:"text-center py-10",children:"No product selected yet"}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx(I,{onClick:()=>f(),className:"flex items-center justify-center w-48",block:!0,icon:e.jsx(V,{}),children:"Add Product"})})]})})})}function R({list:n,storeId:c}){const[o,y]=x.useState({page:1,count:100,status:"true"}),[N,s]=x.useState(!1),f=L(),l=P(),{list:p,loading:m,defaultStore:d}=v(r=>r.store),[t]=u.useForm(),i=async r=>{var b;let g=r.reorderStocks.map(a=>({stockId:a.id,productId:a.productId,productQuantity:a.productQuantity}));g=g==null?void 0:g.reduce((a,S)=>{const w=a.find(C=>C.productId===S.productId);return w?w.productQuantity+=S.productQuantity:a.push(S),a},[]);const k={storeId:r.storeId||c,reorderStocks:g};try{const a=await l(A(k));a.payload.message==="success"?(t.resetFields(),s(!1),f(`/admin/purchase-order/${(b=a.payload.data[0])==null?void 0:b.reorderInvoiceId}`)):s(!1)}catch{s(!1)}},h=r=>{l(F({...o,storeId:r})),t.setFieldsValue({reorderStocks:[{}]})};return x.useEffect(()=>{(n==null?void 0:n.length)>0&&t.setFieldsValue({reorderStocks:n.map(r=>({...r,productQuantity:0}))})},[t,n]),x.useEffect(()=>{d&&!c?t.setFieldValue("storeId",d.id):c&&t.setFieldValue("storeId",c)},[d,t,c]),x.useEffect(()=>{l(Q())},[l,c]),x.useEffect(()=>{c||l(F(o))},[l,o,c]),e.jsx("div",{className:"w-full",children:e.jsxs(u,{form:t,className:"w-full ",name:"dynamic_form_nest_item",onFinish:i,onFinishFailed:()=>{s(!1)},layout:"vertical",size:"large",autoComplete:"off",initialValues:{},children:[e.jsx(u.Item,{className:"max-w-[200px]",name:"storeId",rules:[{required:!0,message:"Store is required"}],children:e.jsx(j,{className:"w-full",loading:m,showSearch:!0,onChange:h,placeholder:"Select a store",optionFilterProp:"children",children:p==null?void 0:p.map(r=>e.jsx(j.Option,{value:r.id,children:r.name},r.id))})}),e.jsx(E,{form:t,setPageConfig:y,pageConfig:o}),e.jsx(u.Item,{style:{marginTop:"15px"},children:e.jsx(I,{block:!0,type:"primary",htmlType:"submit",loading:N,onClick:()=>s(!0),children:"Create Purchase Order"})})]})})}export{R as A};
