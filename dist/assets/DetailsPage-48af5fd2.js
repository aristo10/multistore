import{cN as e,dC as F,dD as S,r as x,dE as E,dF as L,cM as u,cT as N,cL as y,cO as j,dG as w}from"./vendor-3a94a37a.js";import{he as O,hf as T,dT as k,U as B,hg as R,hh as P,hi as G}from"./index-ed7845ca.js";import{Q as b,F as h,I as V,s as Y,B as f,U as z,r as W,M as D,S as I,V as U,W as J,T as q,d as g,X as Q,b as C}from"./vendor-large-f75deccb.js";const X=({url:l})=>e.jsx("div",{className:"pdf-thumbnail h-[120px] w-[180px] overflow-hidden",children:e.jsx(F,{file:l,children:e.jsx(S,{pageNumber:1,width:100})})});function H({handleClosePDF:l,selectedPDF:s}){const[a,r]=x.useState(null),[n,t]=x.useState(1),c=({numPages:d})=>{r(d)},i=()=>t(n-1<=1?1:n-1),o=()=>t(n+1>=a?a:n+1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-80 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden",children:[e.jsxs("nav",{className:"absolute flex items-center gap-2 top-2 left-2 bg-gray-200 px-2 py-1 rounded",children:[e.jsxs("button",{className:"flex items-center gap-1 bg-gray-500 p-1 rounded text-white",onClick:i,children:[e.jsx(E,{}),"Prev"]}),e.jsxs("button",{className:"flex items-center gap-1 bg-gray-500 p-1 rounded text-white",onClick:o,children:["Next",e.jsx(L,{})]}),e.jsxs("p",{children:["Page ",n," of ",a]})]}),e.jsx("button",{className:"absolute top-2 right-2 bg-gray-200 px-2 py-1 rounded",onClick:l,children:"Close PDF"}),e.jsx("div",{className:"h-[calc(100vh-100px)] w-full p-5",children:e.jsx(F,{file:s,onLoadSuccess:c,children:e.jsx(S,{pageNumber:n,renderTextLayer:!1})})})]})})})}function A({attachments:l}){const[s,a]=x.useState(null),r=t=>{const c=t.imageUrl;a(c)},n=()=>{a(null)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 -mx-2",children:[l.map((t,c)=>{var i;return e.jsx("div",{className:"",children:((i=t.imageName)==null?void 0:i.endsWith(".pdf"))&&e.jsx("div",{onClick:()=>r(t),children:e.jsx(X,{url:t.imageUrl})})},c)}),e.jsx(b.PreviewGroup,{children:l.map((t,c)=>{var i;return e.jsx(e.Fragment,{children:!((i=t.imageName)!=null&&i.endsWith(".pdf"))&&e.jsx(b,{width:180,height:120,src:t.imageUrl})})})})]}),s&&e.jsx(H,{handleClosePDF:n,selectedPDF:s})]})})}const{Dragger:K}=z,Z=({setIsModalOpen:l})=>{const{loading:s}=u(o=>o.ticketComment),{id:a}=N(),r=y(),[n]=h.useForm(),t=async o=>{try{const d=new FormData;if(d.append("ticketId",parseInt(a)),d.append("description",o.description),o.files)for(let p=0;p<o.files.length;p++)d.append("files[]",o.files[p].originFileObj);(await r(O(d))).payload.message==="success"?(r(T(a)),n.resetFields(),l(!1)):l(!0)}catch(d){console.log(d.message)}},c=o=>{console.log("Failed:",o)},i=o=>{W.success("File added successfully")};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-w-screen-md mx-auto mt-1",children:e.jsxs(h,{name:"ticketForm",className:"w-full rounded-lg",onFinish:t,form:n,onFinishFailed:c,layout:"vertical",children:[e.jsx(h.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter the description"}],children:e.jsx(V.TextArea,{rows:4,placeholder:"In the ticket"})}),e.jsx(h.Item,{name:"files",label:"Attachments",valuePropName:"fileList",getValueFromEvent:o=>o&&o.fileList,children:e.jsxs(K,{accept:".png,.jpg,.jpeg,.pdf,.doc,.docx",multiple:!0,beforeUpload:()=>!1,onChange:i,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(Y,{})}),e.jsx("p",{className:"ant-upload-text",children:"Drag and drop a files or click to select a files"}),e.jsx("p",{className:"ant-upload-hint",children:"Supported files types: PNG, JPG, JPEG, PDF"})]})}),e.jsx(h.Item,{className:"flex justify-center",children:e.jsx(f,{type:"primary",htmlType:"submit",size:"large",loading:s,children:"Submit"})})]})})})},_=()=>{const[l,s]=x.useState(!1),a=()=>{s(!0)},r=()=>{s(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"px-10",type:"primary",onClick:a,children:"Reply"}),e.jsx(D,{onCancel:r,title:"Reply Support Ticket",open:l,footer:e.jsx(f,{onClick:r,children:"Cancel"}),children:e.jsx(Z,{setIsModalOpen:s})})]})};j.extend(w);const $=()=>{const l=y(),{id:s}=N(),{list:a,loading:r}=u(n=>n.ticketComment);return x.useEffect(()=>{l(T(s))},[l,s]),e.jsxs(e.Fragment,{children:[e.jsx(I,{loading:r,children:e.jsx("div",{children:a==null?void 0:a.map(n=>{var t,c;return e.jsx(U,{className:"bg-gray-100 dark:bg-gray-700 mb-2 rounded-lg px-2",author:n.repliedBy.toUpperCase(),avatar:e.jsx(J,{src:"https://images.freeimages.com/images/large-previews/7e8/man-avatar-1632965.jpg",alt:n.repliedBy.toUpperCase()}),content:e.jsxs("div",{children:[e.jsx("div",{children:n.description}),((t=n==null?void 0:n.images)==null?void 0:t.length)>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-900 font-semibold",children:[" ","Attachments:"," "]}),((c=n==null?void 0:n.images)==null?void 0:c.length)>0&&e.jsx(A,{attachments:n==null?void 0:n.images})]})]}),datetime:e.jsx(q,{title:j(n.createdAt).format("DD/MM/YYYY"),children:e.jsx("span",{children:j(n.createdAt).fromNow()})})},n.id)})})}),e.jsx("div",{className:"flex justify-center items-center mt-4",children:e.jsx(_,{})})]})};j.extend(w);const ee=({ticket:l})=>{var s,a;return e.jsxs("div",{className:"flex justify-start",children:[e.jsx(g,{children:e.jsxs("span",{className:"",children:["Category: ",(s=l==null?void 0:l.ticketCategory)==null?void 0:s.ticketCategoryName]})}),e.jsx(g,{children:e.jsxs("span",{className:"",children:["Priority: ",(a=l==null?void 0:l.priority)==null?void 0:a.name]})}),e.jsx(g,{children:e.jsxs("span",{className:"",children:["Resolve Time:"," ",Math.floor((l==null?void 0:l.ticketResolveTime)/60)+":"+(l==null?void 0:l.ticketResolveTime)%60]})})]})},se=()=>{const[l,s]=x.useState(!1),[a,r]=x.useState(""),{ticket:n,loading:t}=u(m=>m.ticket),{list:c,loading:i}=u(m=>m.ticketStatus),{id:o}=N(),d=y();x.useEffect(()=>{d(k())},[d]);const v=()=>{s(!0)},p=async()=>{(await d(R({id:o,values:{ticketStatusId:a}}))).payload.message==="success"&&(d(P(o)),s(!1),r(""))},M=()=>{s(!1),r("")};return e.jsxs(e.Fragment,{children:[e.jsx(B,{permission:"update-ticket",children:e.jsx(f,{icon:e.jsx(Q,{}),type:"primary",onClick:v,size:"small",className:"flex items-center gap-1",children:"Update Status"})}),e.jsx(D,{title:"Update Ticket Status",open:l,onOk:p,confirmLoading:t,onCancel:M,children:e.jsx(C,{className:"flex justify-center",defaultValue:n.ticketStatus.ticketStatusName,loading:i,onChange:m=>{r(m)},children:c==null?void 0:c.map(m=>e.jsx(C.Option,{value:m.id,children:m.ticketStatusName},m.id))})})]})},ae=({children:l,ticket:s})=>{var a,r;return e.jsx(U,{author:e.jsxs("span",{className:"dark:text-gray-400 text-base font-semibold text-gray-800",children:["Subject : ",s==null?void 0:s.subject]}),content:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:" dark:text-gray-400 ml-2 mt-4 mb-2",children:s==null?void 0:s.description}),((a=s==null?void 0:s.images)==null?void 0:a.length)>0&&e.jsx("span",{className:"dark:text-gray-400 text-xs ml-2 font-semibold text-gray-800",children:"Attachments :"}),((r=s==null?void 0:s.images)==null?void 0:r.length)>0&&e.jsx(A,{attachments:s==null?void 0:s.images})]}),className:"mb-4 p-4 rounded-lg ",children:l})},re=()=>{var n,t;const l=y(),{id:s}=N(),{ticket:a,loading:r}=u(c=>c.ticket);return x.useEffect(()=>(l(P(s)),()=>{l(G())}),[l,s]),e.jsx("div",{children:e.jsxs("div",{className:"container md:w-4/5",children:[e.jsx("div",{className:"flex justify-end p-2",children:a&&e.jsx(se,{})}),e.jsxs("div",{className:"p-6 rounded-lg bg-[#F5F4F4]",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:gap-0 justify-between items-center",children:[e.jsx("div",{className:"",children:e.jsxs("h1",{className:"text-xl flex flex-col md:flex-row gap-2 font-poppins txt-color-secondary mr-3",children:["Support Ticket",e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"font-semibold",children:["#",a==null?void 0:a.ticketId]}),e.jsx(g,{className:"ml-2",color:"green",children:(n=a==null?void 0:a.ticketStatus)==null?void 0:n.ticketStatusName})]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-2",children:[e.jsx(ee,{ticket:a}),e.jsx("h1",{className:"text-xl font-poppins txt-color-secondary",children:((t=a==null?void 0:a.customer)==null?void 0:t.fullName)||"No Name"})]})]})}),e.jsx(I,{loading:r,children:e.jsx(ae,{ticket:a,children:e.jsx($,{})})})]})]})})};export{re as default};
