import{cN as e,cV as R,cL as G,r as N,cM as j}from"./vendor-3a94a37a.js";import{v as H,a as J,t as K,c0 as U,d as W,aP as X,c1 as Y,c2 as Z}from"./index-ed7845ca.js";import{F as a,b as n,h as T,j as $,B as k,P as A,I as Q,D as V}from"./vendor-large-f75deccb.js";function ee({form:t,productList:d,productLoading:o,totalCalculator:x,subTotal:v}){const P=(g,p)=>{const f=t.getFieldValue("quoteProduct"),m=d.find(l=>l.id===g);m.productQuantity===0&&R.error("Product is out of stock");const r=f.map((l,c)=>c===p?{...l,productQuantity:m.productQuantity?1:0,unitPrice:m.productSalePrice}:l);t.setFieldsValue({quoteProduct:r}),x(p)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsx("div",{className:"col-span-1 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"SL"}),e.jsx("div",{className:"col-span-4 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Product"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Quantity"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Price"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Total"}),e.jsx("div",{className:"col-span-1 md:text-base xxs:text-xs sm:text-sm",children:"Delete"})]}),e.jsx("hr",{style:{backgroundColor:"black",marginTop:"0.5rem"}}),e.jsx(a.List,{name:"quoteProduct",rules:[{required:!0,message:"Product is required"}],children:(g,{add:p,remove:f})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-[300px] overflow-y-auto overflow-x-hidden mt-2",children:g.map(({key:m,name:r,...l},c)=>{var b,h;return e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsx("div",{className:"col-span-1",children:c+1}),e.jsx("div",{className:"col-span-4",children:e.jsx(a.Item,{...l,name:[r,"productId"],rules:[{required:!0,message:"Product is required"}],children:e.jsx(n,{placeholder:"Select Product",showSearch:!0,loading:o,optionFilterProp:"children",filterOption:(u,y)=>y.children.toLowerCase().includes(u.toLowerCase()),onChange:u=>{P(u,c)},children:d==null?void 0:d.map(u=>e.jsx(n.Option,{value:u.id,children:u.name},u.id))})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(a.Item,{...l,name:[r,"productQuantity"],rules:[{required:!0,message:"quantity is required"}],children:e.jsx(T,{style:{width:"100%"},size:"small",placeholder:"Quantity",onChange:()=>x(c)})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(a.Item,{...l,name:[r,"unitPrice"],rules:[{required:!0,message:"Price is required"}],children:e.jsx(T,{size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>x(c)})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs mt-2",children:((h=(b=v[c])==null?void 0:b.subPrice)==null?void 0:h.toFixed(2))||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx(a.Item,{children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center bg-red-600 text-white p-2 rounded-md",onClick:()=>{f(r),x(c)},children:e.jsx($,{className:""})})})})]},m)})}),e.jsx(a.Item,{style:{marginTop:"20px"},children:e.jsx(k,{type:"dashed",onClick:()=>p(),block:!0,icon:e.jsx(A,{}),children:"Add Product"})})]})})]})}function ie({createAs:t}){const[d]=a.useForm(),o=G(),[x,v]=N.useState([]),[P,g]=N.useState(0),[p,f]=N.useState(0),[m,r]=N.useState(!1),l=j(s=>s.users.list),{list:c,loading:b}=j(s=>s.products),{list:h,loading:u}=j(s=>s.company),{list:y,loading:L}=j(s=>s.contact),{list:q,loading:E}=j(s=>s.opportunity),{list:I,loading:_}=j(s=>s.quoteStage),F=()=>{const s=d.getFieldValue("quoteProduct"),w=(s==null?void 0:s.reduce((C,i)=>{const D=(i==null?void 0:i.productQuantity)||0,O=(i==null?void 0:i.unitPrice)||0,M=((i==null?void 0:i.productVat)||0)/100*O*D;return[...C,{subVat:(i==null?void 0:i.productVat)||0,subPrice:O*D+M}]},[]))||[];v(w);const S=w.reduce((C,i)=>C+i.subPrice,0)||0;g(S);const B=S&&S-(d.getFieldValue("discount")||0)||0;f(B)};N.useEffect(()=>{o(H()),o(J()),o(K()),o(U()),o(W({query:"all"})),o(X({query:"all"}))},[o]);const z=async s=>{r(!0),(await o(Y(s))).payload.message==="success"&&(t!=null&&t.name?o(t.singleLoadThunk(t.value)):o(Z({status:!0})),d.resetFields()),r(!1)};return e.jsx("div",{className:"px-5",children:e.jsxs(a,{form:d,name:"dynamic_form_nest_item",onFinish:z,size:"large",autoComplete:"off",layout:"vertical",initialValues:t?{[t.name]:t.value}:{},children:[e.jsxs("div",{className:"-mt-5 flex justify-between gap-8",children:[e.jsx(a.Item,{label:"Quote name",name:"quoteName",className:"w-full",rules:[{required:!0,message:"Please input quote name!"}],children:e.jsx(Q,{})}),e.jsx(a.Item,{label:"Quote owner",name:"quoteOwnerId",className:"w-full",rules:[{required:!0,message:"Please input quote owner!"}],children:e.jsx(n,{className:"w-full",loading:!l,showSearch:!0,placeholder:"Select a customer ",optionFilterProp:"children",filterOption:(s,w)=>w.children.toLowerCase().includes(s.toLowerCase()),children:l&&(l==null?void 0:l.map(s=>e.jsx(n.Option,{value:s.id,children:s.username},s.id)))})})]}),e.jsxs("div",{className:"-mt-5 flex justify-between gap-8",children:[e.jsx(a.Item,{label:"Quote date",name:"quoteDate",className:"w-full",rules:[{required:!0,message:"Please input quote date!"}],children:e.jsx(V,{placeholder:"Select Quotation date"})}),e.jsx(a.Item,{label:"Expiration date",name:"expirationDate",className:"w-full",rules:[{required:!0,message:"Please input quote expire date!"}],children:e.jsx(V,{placeholder:"Select Expiration Date"})})]}),e.jsxs("div",{className:"-mt-5 flex gap-8",children:[e.jsx(a.Item,{label:"Company",name:"companyId",className:"w-1/2",children:e.jsx(n,{style:{width:"100%"},loading:u,allowClear:!0,showSearch:!0,placeholder:"Select company Name",disabled:(t==null?void 0:t.name)==="companyId",children:h==null?void 0:h.map(s=>e.jsx(n.Option,{value:s.id,children:s.companyName},s.id))})}),e.jsx(a.Item,{label:"Opportunity",name:"opportunityId",className:"w-1/2",children:e.jsx(n,{style:{width:"100%"},loading:E,allowClear:!0,showSearch:!0,placeholder:"Select opportunity",disabled:(t==null?void 0:t.name)==="opportunityId",children:q==null?void 0:q.map(s=>e.jsx(n.Option,{value:s.id,children:s.opportunityName},s.id))})})]}),e.jsxs("div",{className:"-mt-5 flex justify-between gap-8",children:[e.jsx(a.Item,{label:"Contact",name:"contactId",className:"w-1/2",children:e.jsx(n,{style:{width:"100%"},loading:L,allowClear:!0,showSearch:!0,placeholder:"Select contact name",disabled:(t==null?void 0:t.name)==="contactId",children:y==null?void 0:y.map(s=>e.jsxs(n.Option,{value:s.id,children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]},s.id))})}),e.jsx(a.Item,{label:"Quote stage",name:"quoteStageId",className:"w-1/2",children:e.jsx(n,{style:{width:"100%"},loading:_,allowClear:!0,showSearch:!0,placeholder:"Select opportunity",children:I==null?void 0:I.map(s=>e.jsx(n.Option,{value:s.id,children:s.quoteStageName},s.id))})})]}),e.jsx("div",{className:"-mt-5",children:e.jsx(a.Item,{label:"Terms and conditions",name:"termsAndConditions",className:"w-full",rules:[{required:!0,message:"Please input quote terms and conditions!"}],children:e.jsx(Q,{placeholder:"Terms"})})}),e.jsx("div",{className:"-mt-5 ",children:e.jsx(a.Item,{label:"Description",name:"description",className:"w-full",rules:[{required:!0,message:"Please input quote description!"}],children:e.jsx(Q.TextArea,{placeholder:"description",rows:3})})}),e.jsx(ee,{form:d,totalCalculator:F,subTotal:x,productList:c,productLoading:b}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between my-1 text-[16px] font-medium",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"pr-2",children:P.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center my-1text-[16px] font-medium",children:[e.jsx("span",{children:"Discount:"}),e.jsx(a.Item,{name:"discount",children:e.jsx(T,{className:"mt-4",onChange:()=>F()})})]}),e.jsxs("div",{className:"flex justify-between my-1 text-[16px] font-medium",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{className:"pr-2",children:p.toFixed(2)})]})]}),e.jsx("div",{className:"",children:e.jsx(a.Item,{style:{marginTop:"15px"},children:e.jsx(k,{block:!0,type:"primary",htmlType:"submit",loading:m,children:"Create Quotation"})})})]})})}export{ie as A};
