import{cL as R,r as t,cM as y,cN as e,da as z,cX as U,cU as k}from"./vendor-3a94a37a.js";import{s as A}from"./emailConfigSlice-145edc06.js";import{aZ as M}from"./index-ed7845ca.js";import{p as q}from"./purchasePDF-c30bf5e1.js";import{u as K}from"./useCurrency-4b14dd3d.js";import{F as l,I as C,a as F,c as Q,i as V,B as X,r as I}from"./vendor-large-f75deccb.js";import{T as E}from"./TagInput-f33dd18b.js";import{textEditorModule as Z,textEditorFormats as G}from"./AddProduct-aa890cea.js";function le({setSendForm:p,body:f,invoice:i,subject:v,supplierEmail:B}){const[h]=l.useForm(),x=R(),[S,o]=t.useState(!1),[n,j]=t.useState([]),[d,P]=t.useState([]),[m,N]=t.useState([]),[g,D]=t.useState(f),{purchase:r,loading:L}=y(s=>s.purchases),c=y(s=>{var a;return(a=s==null?void 0:s.setting)==null?void 0:a.data})||null,{currencyName:b}=K()||{},T=async s=>{o(!0);try{let a=new FormData;a.append("receiverEmail",s.receiverEmail),a.append("subject",s.subject),a.append("body",g),n&&n.forEach(u=>{u.name===`Purchase invoice - ${i.id} .pdf`?a.append("files[]",u.originFileObj,`Purchase invoice - ${i.id} .pdf`):a.append("files[]",u.originFileObj)}),d.length>0&&a.append("cc[]",d),m.length>0&&a.append("bcc[]",m),(await x(A(a))).payload.message==="success"&&(p(!1),o(!1),h.resetFields())}catch(a){console.log(a)}o(!1)},$=()=>{};t.useEffect(()=>{!c&&x(M())});const w=s=>{j(s.fileList);const{status:a}=s.file;a==="done"?I.success(`${s.file.name} file uploaded successfully.`):a==="error"&&I.error(`${s.file.name} file upload failed.`)};t.useEffect(()=>{r!=null&&r.singlePurchaseInvoice&&c&&j(s=>s.some(a=>a.name===`Purchase invoice - ${i.id} .pdf`)?s:[...s,{name:`Purchase invoice - ${i.id} .pdf`,originFileObj:q(r,c,"Purchase Invoice",b)}])},[c,b,i.id,r]);const O=s=>{D(s)};return e.jsx(e.Fragment,{children:!L&&r&&e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:" "}),e.jsx("button",{onClick:()=>p(!1),className:"bg-red-100 p-1 rounded text-red-500",children:e.jsx(z,{size:20})})]}),e.jsxs(l,{onFinish:T,onFinishFailed:$,colon:!1,layout:"vertical",form:h,initialValues:{receiverEmail:B,subject:v,body:f},children:[e.jsx(l.Item,{style:{width:"100%"},label:"To",rules:[{required:!0,message:"Please input receiver email!"}],name:"receiverEmail",children:e.jsx(C,{placeholder:"Receiver Email"})}),e.jsx(F,{bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:s})=>e.jsx(Q,{rotate:s?90:0}),className:"site-collapse-custom-collapse mb-4 ",children:e.jsxs(F.Panel,{header:"CC & BCC",children:[e.jsx(E,{label:"CC",tags:d,setTags:P}),e.jsx(E,{label:"BCC",tags:m,setTags:N})]},"1")}),e.jsx(l.Item,{style:{width:"100%"},label:"Subject",name:"subject",children:e.jsx(C,{placeholder:"Subject"})}),e.jsx(l.Item,{label:"Attachment",children:e.jsxs(V,{name:"files",onChange:w,multiple:!0,fileList:n,beforeUpload:()=>!1,children:[e.jsx("div",{className:"ant-upload-drag-icon flex justify-center my-2",children:e.jsx(U,{size:30})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})}),e.jsx(l.Item,{style:{marginBottom:"25px"},label:"Body",children:e.jsx(k,{value:g,onChange:O,modules:Z,formats:G})}),e.jsx(l.Item,{children:e.jsx(X,{loading:S,size:"large",htmlType:"submit",type:"primary",children:"Send"})})]})]})})}export{le as S};
