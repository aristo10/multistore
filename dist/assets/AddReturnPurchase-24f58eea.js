import{cT as F,c_ as k,r as n,cL as L,cM as E,cS as N,cN as e,cO as T}from"./vendor-3a94a37a.js";import{aW as O,aX as V,L as _,aY as H}from"./index-ed7845ca.js";import{P as M}from"./PurchaseProductListCard-59db7397.js";import{P as W}from"./Payments-cf7d9c72.js";import{F as d,C as B,D as U,I as X}from"./vendor-large-f75deccb.js";const K=()=>{const{id:p}=F();let v=k();const[l,P]=n.useState({}),[g,x]=n.useState(!1),[f,I]=n.useState(0),Q=L(),j=E(t=>t.purchases.purchase),{singlePurchaseInvoice:c,returnPurchaseInvoice:h}=j||{},[i,y]=n.useState([]),[w,C]=n.useState(N()),[b]=d.useForm();d.useWatch("name",b),n.useEffect(()=>{Q(O(p))},[p]),n.useEffect(()=>{if(c){const t=c.purchaseInvoiceProduct.map(s=>{const a=h==null?void 0:h.map(u=>u.returnPurchaseInvoiceProduct.find(o=>o.productId===s.productId)).reduce((u,o)=>o?{productQuantity:u.productQuantity+o.productQuantity}:u,{productQuantity:0}),r={...s};return a?(r.returnQuantity=0,r.productQuantity=r.productQuantity-a.productQuantity):(r.returnQuantity=0,r.remainQuantity=s.productQuantity),r});y(t)}},[c]);const R=async({note:t,paidAmount:s})=>{x(!0);const a={purchaseInvoiceId:p,note:t,date:N(w._d).format(),instantReturnAmount:s||[],returnPurchaseInvoiceProduct:Object.entries(l).map(([m,{value:S}])=>({purchaseInvoiceProductId:parseInt(m),productQuantity:S}))},r=a.returnPurchaseInvoiceProduct.filter(m=>m.productQuantity!==0&&m.productQuantity!==null),u={...a,returnPurchaseInvoiceProduct:r};(await H(u)).message==="success"&&v(-1),x(!1)},D=n.useCallback(({id:t,value:s})=>{const a=i.find(r=>r.id===t);a&&(l[t]={value:s},a.returnQuantity=s,a.remainQuantity=a.productQuantity-s,y([...i]),P({...l}))},[i]),A=()=>i.reduce((t,s)=>t+s.returnQuantity*s.productUnitPurchasePrice,0);return n.useEffect(()=>{I(A())},[i]),e.jsx("div",{children:e.jsx("div",{className:"mr-top",children:c?e.jsx(n.Fragment,{children:e.jsxs(B,{bordered:!1,className:"criclebox h-full m-3",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("h5",{className:"text-xl",children:e.jsxs("span",{className:"mr-left",children:["Invoice : ",c.id]})})}),e.jsxs("div",{className:"",children:[e.jsx(M,{formData:l,updateReturn:!0,returnOnChange:D,list:i}),e.jsxs("div",{className:"flex justify-between card-body my-4",children:[e.jsx("div",{className:"mb-auto",children:e.jsxs("p",{className:"mr-left hidden",style:{backgroundColor:"#FDCCCC",padding:"10px",paddingRight:"20px",borderRadius:"2px"},children:["Total Return Amount :",e.jsxs("strong",{children:["  ",f||0]})]})}),e.jsx("div",{className:"mr-right min-w-[400px]",children:e.jsxs(d,{labelAlign:"right",labelCol:{span:4},initialValues:{date:T(new Date)},wrapperCol:{span:26},form:b,onFinish:R,autoComplete:"off",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Date: "}),e.jsx("div",{className:"w-[65%]",children:e.jsx(d.Item,{name:"date",className:"mb-0",children:e.jsx(U,{onChange:t=>C(t._d),style:{width:"100%"}})})})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Note: "}),e.jsx("div",{className:"w-[65%]",children:e.jsx(d.Item,{name:"note",className:"mb-0",children:e.jsx(X.TextArea,{placeholder:"Note"})})})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Paid Amount: "}),e.jsx("div",{className:"w-[65%] flex items-center justify-between gap-2",children:e.jsx(W,{})})]}),e.jsx(d.Item,{style:{marginTop:"20px"},className:"mb-2",children:e.jsx(V,{className:"bg-red-500 hover:bg-red-600 text-white",type:"submit",block:!0,loading:g,children:"Make Return"})})]})})]})]})]})},c.id):e.jsx(_,{})})})};export{K as default};
