import{cT as P,cL as R,r as p,cM as C,cN as e}from"./vendor-3a94a37a.js";import{bu as A,bv as E,bw as T,C as B,bx as I,L as O}from"./index-ed7845ca.js";import{B as D}from"./vendor-large-f75deccb.js";const U=()=>{const{id:i}=P(),o=R(),[u,m]=p.useState([]),[c,f]=p.useState(!0),[j,h]=p.useState(!1),{list:d}=C(s=>s.permission),b=p.useMemo(()=>L(d),[d]),{role:n,loading:g}=C(s=>s.role),S=(s,a)=>{const t=b[s].map(r=>r.id);m(r=>{const x=[...r];return t.forEach(l=>{const N=x.indexOf(l);N!==-1&&x.splice(N,1)}),a?x.concat(t):x})},y=(s,a)=>{m(t=>{const r=[...t],x=d==null?void 0:d.filter(l=>l.name.includes(s)).map(l=>l.id);return x.forEach(l=>{const N=r.indexOf(l);N!==-1&&r.splice(N,1)}),a?r.concat(x):r})},w=async s=>{m(a=>{const t=[...a],r=t.indexOf(s);return r!==-1?t.splice(r,1):t.push(s),t})},v=async()=>{h(!0),(await o(I({roleId:parseInt(i),permissionId:u}))).payload.message==="success"&&o(A(i)),h(!1)};p.useEffect(()=>{n&&m(n==null?void 0:n.rolePermission.map(s=>s.permissionId))},[n]),p.useEffect(()=>(o(A(i)),o(E()),()=>{o(T())}),[o,i]),p.useEffect(()=>{if(n){const s=n.rolePermission.map(t=>t.permissionId)||[];s.sort();const a=[...u];a.sort(),JSON.stringify(s)!==JSON.stringify(a)?f(!1):f(!0)}},[n,u]);let k=null;return g?k=e.jsx(O,{}):!g&&n&&(k=e.jsx(B,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Permissions of "+(n==null?void 0:n.name),extra:e.jsx(e.Fragment,{children:e.jsx(D,{disabled:c,loading:j,type:"primary",className:"",onClick:v,children:"Permit now"})}),children:e.jsx("div",{className:"tableScrollBar overflow-y-auto w-full",children:e.jsx("div",{className:"max-h-[calc(100vh-165px)]",children:e.jsxs("table",{className:"border-collapse w-full ",children:[e.jsx("thead",{className:"font-Popins text-black/70 bg-tableHeaderBg  border-gray-200 sticky top-[-1px] z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border",children:"Permission Name"}),e.jsx("th",{className:"border",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>y("create-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Create"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>y("readAll-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Read All"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>y("readSingle-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Read Single"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>y("update-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Update"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>y("delete-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Delete"})]})})]})}),e.jsx("tbody",{children:Object.keys(b).map(s=>e.jsxs("tr",{className:"",children:[e.jsxs("td",{className:"border pl-4",children:[e.jsx("input",{title:"Select Row",type:"checkbox",onChange:a=>S(s,a.target.checked),className:"mr-4"}),s]}),b[s].map(a=>{const t=u.find(r=>r===a.id);return e.jsx("td",{className:"border align-middle text-center",children:e.jsx("input",{disabled:g,onChange:r=>w(a.id),checked:!!t,type:"checkbox"})},a.id)})]},s))})]})})})})),k};function L(i){if(!Array.isArray(i))return{};function o(c){return(c.match(/[A-Z]?[a-z]+/g)||[]).map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(" ")}const u=i.filter(c=>c.name.includes("create")).map(c=>c.name.replace("create-","")),m={};return u.forEach(c=>{const f=i.filter(j=>j.name.split("-")[1]===c);f.sort((j,h)=>{const d=j.id,b=h.id;return d<b?-1:d>b?1:0}),m[o(c)]=f}),m}export{U as default};
