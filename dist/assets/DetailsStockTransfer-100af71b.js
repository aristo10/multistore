import{cM as F,cS as I,cN as e,cQ as A,cL as E,r as j,da as q,cX as H,cU as V,cT as K,dt as Z,dc as J}from"./vendor-3a94a37a.js";import{fp as _,aX as D,am as O,s as ee,aZ as te,hb as ae,hc as Q,hd as se,C as k,bt as ne,L as re}from"./index-ed7845ca.js";import{L as P}from"./List-9eb27318.js";import{T as oe,a as B}from"./Tabs-8f68912a.js";import{u as L}from"./useCurrency-4b14dd3d.js";import{i as U}from"./invoiceGenerator-eaeb8720.js";import{n as Y}from"./numberToWords-4c291141.js";import{s as le}from"./emailConfigSlice-145edc06.js";import{F as y,I as R,a as w,c as ie,i as ce,B as de,M as ue,b as z,n as me,d as pe}from"./vendor-large-f75deccb.js";import{T as M}from"./TagInput-f33dd18b.js";import{textEditorModule as fe,textEditorFormats as xe}from"./AddProduct-aa890cea.js";import{B as he}from"./BtnLoader-1c0e147f.js";import"./ImageUploader-c0ae741f.js";import"./MediaGallery-5095f29f.js";import"./UploaderWithDrag-568744bd.js";import"./BigDrawer-240149a9.js";import"./AddManufacturer-2f6bafee.js";import"./AddProductBrand-894ab785.js";import"./UploadMany-c4472299.js";import"./AddProductSubcategory-71762def.js";import"./AddProductCategory-6511f02f.js";import"./AddUoM-1dc09ff9.js";import"./AddVatTax-97a0925d.js";import"./FormProductListCard-571d2cbc.js";import"./AddProductAttribute-4ec2c5fe.js";import"./AddProductAttributeValue-d16feddc.js";import"./AddDiscount-05e89f9a.js";function be(a){const{currencySymbol:n}=L()||{},t=F(x=>{var h;return(h=x==null?void 0:x.setting)==null?void 0:h.data})||null,u=_(n),{id:s,date:m,totalPurchaseAmount:l,stockCount:i,totalQuantity:r}=a||{},p=`Stock Transfer ID #${s}`,f=`
<div>Dear <strong>Manager</strong>,</div>
<div>Greetings! We trust this message reaches you in great spirits.</div>
<br>
<strong>Stock transfer Information:</strong><br>
<p>Invoice ID: ${s}</p>
<p>Place Date: ${I(m).format("ll")}</p>
<br>
<strong>Stock transfer details:</strong><br>
Total Transferred Amount: ${u} ${l?Number(l).toFixed(2):0} <br>
Total Unique Stock: ${i||0} <br>
Total Quantity: ${r||0} <br>

<br>
<p>Best Regards,</p>
<p>${t==null?void 0:t.companyName}</p>
<p>${t==null?void 0:t.phone}</p>
<p>${t==null?void 0:t.email}</p>`;return{subject:p,body:f}}function je({stockTransfer:a,title:n}){const{id:t,date:u,note:s,totalPurchaseAmount:m,stockTransferProduct:l,storeFrom:i,storeTo:r}=a||{},{currencyName:p}=L()||{},f=F(c=>{var C;return(C=c==null?void 0:c.setting)==null?void 0:C.data})||null,h=[{label:"GRAND TOTAL IN WORDS: ",value:`${Y(Math.round(m)).toUpperCase()} ${p}`||""},{label:"Notes: ",value:s||""}],T=[{label:"Total Transfer Amount:",value:`${m?Number(m).toFixed(2):0}`}],v=["SL","Name","Purchase price","Quantity","Amount"],b=l.map((c,C)=>[C+1,c.product.name,`${c.productUnitPurchasePrice}`,c.productQuantity,`${c.productFinalAmount}`]),g=[{value:`Transfer From: ${i.name||"N/A"}`},{value:`Transfer To: ${r.name||"N/A"}`}],N=[{value:` Invoice No: ${t}`},{value:`Invoice Date: ${I(u).format("YYYY-MM-DD")}`},{value:`Currency: ${p}`}],S={jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:8,footerFontSize:10};return e.jsx("div",{className:"flex gap-2",children:e.jsx(D,{color:"primary",onClick:()=>U("print",{title:n,TopRightInfo:N,companyInfo:f,customerInfo:g,bottomLeftContent:h,bottomRightContent:T,tableBody:b,tableHead:v,settings:S,leftBottomSecondColumnX:55}),children:"Print"})})}const G=a=>a.map(n=>({...n,key:n.id}));function ge({list:a}){const n=[{id:1,title:"ID",dataIndex:"id",key:"id",render:t=>e.jsx(A,{to:`/admin/transaction/${t}`,children:t})},{id:2,title:"Date",dataIndex:"date",key:"date",render:t=>I(t).format("ll")},{id:3,title:"Debit",dataIndex:"debit",key:"debit",render:t=>t.name},{id:4,title:"Credit",dataIndex:"credit",key:"credit",render:t=>t.name},{id:5,title:"Amount",dataIndex:"amount",key:"amount"},{id:6,title:"Type ",dataIndex:"type",key:"type"},{id:7,title:"Particulars",dataIndex:"particulars",key:"particulars",render:t=>e.jsx("div",{title:t,children:ee(t,20)})}];return e.jsx("div",{className:"m-1 md:mt-4",children:e.jsx(O,{scroll:{x:!0},loading:!a,columns:n,data:a?G(a):[]})})}function Te({list:a}){const n=[{title:"ID",dataIndex:"id",key:"id"},{title:"Name",dataIndex:"product",key:"product.name",render:t=>e.jsx(A,{to:`/admin/product/${t.id}`,children:t.name})},{title:"Purchase Price",dataIndex:"productUnitPurchasePrice",key:"productSalePrice"},{title:"Transfer Quantity",dataIndex:"productQuantity",key:"productQuantity"},{title:"Total Price ",key:"Total Price ",dataIndex:"productFinalAmount"}];return e.jsx("div",{className:"m-1 md:mt-4",children:e.jsx(O,{scroll:{x:!0},loading:!a,columns:n,data:a?G(a):[]})})}function ye(a,n,t,u){const{id:s,date:m,note:l,totalPurchaseAmount:i,stockTransferProduct:r,storeFrom:p,storeTo:f}=a||{},h=[{label:"GRAND TOTAL IN WORDS: ",value:`${Y(Math.round(i)).toUpperCase()} ${u}`||""},{label:"Notes: ",value:l||""}],T=[{label:"Total Transfer Amount:",value:`${i?Number(i).toFixed(2):0}`}],v=["SL","Name","Purchase price","Quantity","Amount"],b=r.map((c,C)=>[C+1,c.product.name,`${c.productUnitPurchasePrice}`,c.productQuantity,`${c.productFinalAmount}`]),g=[{value:`Transfer From: ${p.name||"N/A"}`},{value:`Transfer To: ${f.name||"N/A"}`}],N=[{value:` Invoice No: ${s}`},{value:`Invoice Date: ${I(m).format("YYYY-MM-DD")}`},{value:`Currency: ${u}`}];return U(null,{title:t,TopRightInfo:N,customerInfo:g,companyInfo:n,bottomLeftContent:h,bottomRightContent:T,tableBody:b,tableHead:v,settings:{jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:7,footerFontSize:10},leftBottomSecondColumnX:55})}function Se({setSendEmail:a,body:n,invoice:t,subject:u,email:s}){const[m]=y.useForm(),l=E(),[i,r]=j.useState(!1),[p,f]=j.useState([]),[x,h]=j.useState([]),[T,v]=j.useState([]),b=F(o=>{var d;return(d=o==null?void 0:o.setting)==null?void 0:d.data})||null,[g,N]=j.useState(n),{currencyName:S}=L()||{},c=async o=>{r(!0);try{let d=new FormData;o.receiverEmail&&d.append("receiverEmail",o.receiverEmail),o.subject&&d.append("subject",o.subject),g&&d.append("body",g),p&&p.forEach($=>{$.name===`Stock Transfer invoice - ${t.id} .pdf`?d.append("files[]",$.originFileObj,`Stock Transfer invoice - ${t.id} .pdf`):d.append("files[]",$.originFileObj)}),x.length>0&&d.append("cc[]",x),T.length>0&&d.append("bcc[]",T),(await l(le(d))).payload.message==="success"&&(a(!1),r(!1),m.resetFields(),h([]),v([]),f(null))}catch(d){console.log(d)}r(!1)},C=()=>{};j.useEffect(()=>{!b&&l(te())},[b,l]);const W=o=>{f(o.fileList)};j.useEffect(()=>{t&&b&&f(o=>o.some(d=>d.name===`Stock Transfer invoice - ${t.id} .pdf`)?o:[...o,{name:`Stock Transfer invoice - ${t.id} .pdf`,originFileObj:ye(t,b,"Stock Transfer Invoice",S)}])},[b,S,t]);const X=o=>{N(o)};return e.jsx(e.Fragment,{children:t&&e.jsxs("div",{className:"py-4 px-4 border-t",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:""}),e.jsx("button",{onClick:()=>a(!1),className:"bg-red-100 p-1 rounded text-red-500",children:e.jsx(q,{size:20})})]}),e.jsxs(y,{onFinish:c,onFinishFailed:C,colon:!1,layout:"vertical",form:m,initialValues:{subject:u,body:n,receiverEmail:s},children:[e.jsx(y.Item,{style:{width:"100%"},label:"To",rules:[{required:!0,message:"Please input receiver email!"}],name:"receiverEmail",children:e.jsx(R,{placeholder:"Receiver Email"})}),e.jsx(w,{bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:o})=>e.jsx(ie,{rotate:o?90:0}),className:"site-collapse-custom-collapse mb-4 ",children:e.jsxs(w.Panel,{header:"CC & BCC",children:[e.jsx(M,{label:"CC",tags:x,setTags:h}),e.jsx(M,{label:"BCC",tags:T,setTags:v})]},"1")}),e.jsx(y.Item,{style:{width:"100%"},label:"Subject",name:"subject",children:e.jsx(R,{placeholder:"Subject"})}),e.jsx(y.Item,{label:"Attachment",children:e.jsxs(ce,{name:"files",fileList:p,onChange:W,multiple:!0,beforeUpload:()=>!1,children:[e.jsx("div",{className:"ant-upload-drag-icon flex justify-center my-2",children:e.jsx(H,{size:30})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})}),e.jsx(y.Item,{style:{marginBottom:"25px"},label:"Body",children:e.jsx(V,{value:g,onChange:X,modules:fe,formats:xe})}),e.jsx(y.Item,{children:e.jsx(de,{loading:i,size:"large",htmlType:"submit",type:"primary",children:"Send"})})]})]})})}const ve=({stockTransferId:a,initialStatus:n})=>{const{Option:t}=z,[u,s]=j.useState(!1),[m,l]=j.useState(!1),i=E();j.useEffect(()=>{l(!1)},[]);const r=()=>{s(!0)},p=()=>{s(!1)},f=()=>{s(!1)},x=async h=>{l(!0),(await i(ae({stockTransferId:a,transferStatus:h}))).payload.message==="success"&&(i(Q(a)),s(!1)),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:r,children:"Status"}),e.jsxs(ue,{open:u,onOk:p,onCancel:f,footer:!1,children:[e.jsxs(y,{layout:"vertical",children:[e.jsxs("h1",{className:"text-lg text-center font-semibold text-gray-600",children:[" ","Order ID : ",a," "]}),e.jsx(y.Item,{label:"Update Status",initialValue:n,name:"status",children:e.jsxs(z,{placeholder:"Select Status",style:{width:"100%"},onChange:x,children:[e.jsx(t,{value:"ACCEPTED",children:"Accept"}),e.jsx(t,{value:"PENDING",children:"Pending"}),e.jsx(t,{value:"CANCELLED",children:"Cancel"})]})})]}),e.jsx(y.Item,{children:m&&e.jsx(he,{})})]})]})},Ne=ve;function _e(){const{id:a}=K(),[n,t]=j.useState(!1),u=E(),{stockTransfer:s}=F(S=>S==null?void 0:S.stockTransfer),{subject:m,body:l}=be(s),{storeFrom:i,storeTo:r,stockCount:p,totalQuantity:f,totalPurchaseAmount:x,allTransaction:h,stockTransferProduct:T,createdAt:v,transferStatus:b,transferBy:g,note:N}=s||{};return j.useEffect(()=>(u(Q(a)),()=>{u(se())}),[a,u]),e.jsx(e.Fragment,{children:s?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(k,{className:"w-2/3",bodyClass:"p-0",children:[e.jsx("div",{className:"flex justify-between mx-2 py-2 border-b items-center",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-end ",children:e.jsx(je,{stockTransfer:s,title:"Stock Transfer Invoice"})}),e.jsx(D,{className:"flex-row-reverse",color:"gray",icon:e.jsx(Z,{size:15}),onClick:()=>t(!0),children:"Send"}),e.jsx(me,{content:e.jsx(ne,{items:[{key:"status",label:e.jsx(Ne,{stockTransferId:s.id,initialStatus:b})}]}),placement:"bottomRight",arrow:!1,trigger:"click",children:e.jsx(D,{color:"gray",icon:e.jsx(J,{size:15}),className:"  px-3"})})]})}),n?e.jsx("div",{children:e.jsx(Se,{body:l,subject:m,setSendEmail:t,email:r==null?void 0:r.email,invoice:s})}):e.jsxs(oe,{className:"mt-4",children:[e.jsx(B,{label:"Products",children:e.jsx(Te,{list:T})}),e.jsx(B,{label:"Transactions",children:e.jsx(ge,{list:h})})]})]}),e.jsxs("div",{className:"w-1/3 flex flex-col gap-2 md:gap-4",children:[e.jsx(k,{title:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"font-normal",children:["Invoice No"," ",e.jsxs("span",{className:"font-semibold",children:["#",s.id]})]})}),children:e.jsx(e.Fragment,{children:e.jsx(P,{labelClassName:"w-[40%]",list:[{label:"Invoice Date",value:I(v).format("ll")},{label:"Transfer Status",value:e.jsx(pe,{color:b==="ACCEPTED"?"success":"orange",children:b})},{label:"Transferred By",value:g?e.jsx(A,{to:`/admin/hrm/staff/${g.userId}`,children:`${g.username}`}):"N/A"}]})})}),e.jsx(k,{title:"Other Information",children:e.jsx(P,{labelClassName:"w-[40%]",list:[{label:"From Store",value:i==null?void 0:i.name},{label:"To Store",value:r==null?void 0:r.name},{label:"Total Quantity",value:f},{label:"Total Unique Stock",value:p},{label:"Total Transfer Amount",value:x}]})}),N&&e.jsx(k,{children:e.jsx(P,{labelClassName:"w-[40%] font-bold",list:[{label:"Note",value:N,className:"flex-col gap-1"}]})})]})]})}):e.jsx(re,{})})}export{_e as default};
