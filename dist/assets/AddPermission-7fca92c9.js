import{d4 as f,c_ as F,cT as w,r as m,d8 as L,cN as s,d6 as C,cV as T}from"./vendor-3a94a37a.js";import{U as I,L as S}from"./index-ed7845ca.js";import{F as E,C as k,B as A,w as B,f as U}from"./vendor-large-f75deccb.js";const _=async r=>{try{const{data:t}=await f({method:"post",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},url:"role-permission",data:{...r}});return{data:t,message:"success"}}catch{return{message:"error"}}},q=async()=>{const{data:r}=await f.get("permission?query=all");return r};function z(r){const t=r.permissionNames,{selectedPermission:d,setSelectedPermission:u}=r,n=t.map(e=>s.jsx(m.Fragment,{children:s.jsx(B,{value:e.id,onChange:()=>{u(l=>({...l,[e.id]:!l[e.id]}))},checked:d[e.id],children:e.name})},e.id)),c=[];for(let e=0;e<n.length;e+=5)c.push(s.jsxs("div",{className:"flex flex-col sm:flex-row  justify-between m-4 border-2 border-indigo-100 px-4 py-3  overflow-x-auto ",children:[n.slice(e,e+5),s.jsx("br",{})]},e));return s.jsx("div",{children:c})}const G=()=>{const r=F(),{id:t}=w(),[d,u]=m.useState([]),[n,c]=m.useState({}),e=L(),{data:l}=e.state,j=l.name,h=l.rolePermission,{Title:P}=U,[g]=E.useForm(),[y,p]=m.useState(!1);m.useEffect(()=>{q().then(a=>{u(a);const i=a.reduce((o,x)=>(o[x.id]=h.some(b=>b.permissionId===x.id),o),{});c(i)})},[t,h]);const N=Object.entries(n).reduce((a,[i,o])=>(o&&a.push(i),a),[]),v=async a=>{p(!0);try{const i={roleId:parseInt(t),permissionId:N.map(Number)},o=await _(i);o.message==="success"&&(r(-1),p(!1)),o.message==="error"&&(T.error("Error at giving permission, Try again"),p(!1),g.resetFields()),g.resetFields()}catch{p(!1)}};return!localStorage.getItem("isLogged")?s.jsx(C,{to:"/admin/auth/login",replace:!0}):s.jsx(s.Fragment,{children:s.jsx(I,{permission:"create-rolePermission",children:s.jsxs(k,{bordered:!1,className:" h-full",children:[s.jsxs(P,{level:3,className:"m-3 text-center mb-5",children:["Add Permission : ",s.jsx("span",{className:"text-primary",children:j})]}),d.length>0?s.jsxs(s.Fragment,{children:[s.jsx(z,{permissionNames:d,hasPermissions:h,setSelectedPermission:c,selectedPermission:n}),s.jsx("div",{className:"text-center",children:s.jsx(A,{className:"",onClick:v,type:"primary",htmlType:"submit",size:"large",shape:"round",loading:y,children:"Permit Now"})})]}):s.jsx(S,{})]})})})};export{G as default};
