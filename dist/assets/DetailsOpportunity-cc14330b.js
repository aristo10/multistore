import{cL as D,c_ as q,cT as F,r as p,cM as v,cN as e,cP as M,cS as Y}from"./vendor-3a94a37a.js";import{T as z,N as G,A as S,E as V,Q as _}from"./Attachments-046a2313.js";import{u as H,d as J,a as K,t as U,C as Q,L as W,eQ as X,N as Z,E as $,eR as u,D as ee,eS as se,ae as B}from"./index-ed7845ca.js";import{D as le}from"./DetailsInfo-ac9192ab.js";import{F as f,B as A,b as g,I as P,u as ne,v as oe}from"./vendor-large-f75deccb.js";import"./AddEmail-58ac19a5.js";import"./TagInput-f33dd18b.js";import"./AddProduct-aa890cea.js";import"./ImageUploader-c0ae741f.js";import"./MediaGallery-5095f29f.js";import"./UploaderWithDrag-568744bd.js";import"./BigDrawer-240149a9.js";import"./AddManufacturer-2f6bafee.js";import"./AddProductBrand-894ab785.js";import"./UploadMany-c4472299.js";import"./AddProductSubcategory-71762def.js";import"./AddProductCategory-6511f02f.js";import"./AddUoM-1dc09ff9.js";import"./AddVatTax-97a0925d.js";import"./FormProductListCard-571d2cbc.js";import"./AddProductAttribute-4ec2c5fe.js";import"./AddProductAttributeValue-d16feddc.js";import"./AddDiscount-05e89f9a.js";import"./DetailsNote-cf259519.js";import"./AddQuote-b08df3aa.js";import"./AddTask-88f11895.js";import"./AddAttachment-08320204.js";function te({data:l,loading:o}){const a=D(),x=q(),{OpportunityId:n}=F(),[r]=f.useForm(),[d,t]=p.useState(!1),{list:h,loading:I}=v(s=>s.users),{list:j,loading:C}=v(s=>s.company),{list:y,loading:k}=v(s=>s.contact),T=async()=>{var s=window.confirm("Are you sure you want to delete?");s&&(await a(X(n))).payload.message==="success"&&(x(-1),a(Z({})))},{permissions:N}=H(),E=N==null?void 0:N.includes("update-opportunity"),O=async s=>{const w={...s,opportunityOwnerId:parseInt(s.opportunityOwnerId),contactId:parseInt(s.contactId),companyId:parseInt(s.companyId)};(await a($({id:l.id,values:w}))).payload.message==="success"&&(a(u(l.id)),t(!1))},b=s=>{t(!1),r.resetFields(),console.log("Failed:",s)};return p.useEffect(()=>{a(J({query:"all"})),a(K()),a(U())},[a]),e.jsx(e.Fragment,{children:l?e.jsx(Q,{headStyle:{display:"none"},bodyStyle:{padding:0},children:e.jsx(f,{form:r,colon:!1,disabled:!E,labelCol:{span:2},wrapperCol:{span:8},layout:"inline",onFieldsChange:()=>t(!0),onFinish:O,onFinishFailed:b,initialValues:{opportunityName:l==null?void 0:l.opportunityName,amount:l==null?void 0:l.amount,opportunityOwnerId:l==null?void 0:l.opportunityOwnerId,contactId:l==null?void 0:l.contactId,companyId:l==null?void 0:l.companyId},children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center px-5 p-3 border-b",children:[e.jsxs("div",{className:"flex gap-2 dark:text-white",children:[e.jsx("span",{children:"Opportunity Name:"}),e.jsx("span",{className:"font-bold",children:l==null?void 0:l.opportunityName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx(f.Item,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{type:"primary",htmlType:"submit",children:"Save"}),e.jsx(A,{loading:o,type:"danger",onClick:b,children:"Cancel"})]})}),e.jsx(A,{danger:!0,onClick:T,children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[e.jsx(f.Item,{className:"flex flex-col",label:"Opportunity Owner",name:"opportunityOwnerId",children:e.jsx(g,{bordered:!1,loading:I,className:"md:ml-5",children:h==null?void 0:h.map(s=>e.jsxs(g.Option,{value:s.id,children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]},s.id))})}),e.jsx(f.Item,{label:"Opportunity Name",name:"opportunityName",children:e.jsx(P,{bordered:!1,suffix:e.jsx(M,{}),className:"md:ml-5"})}),e.jsx(f.Item,{className:"flex flex-col",label:"Contact",name:"contactId",children:e.jsx(g,{bordered:!1,loading:k,className:"md:ml-5",children:y==null?void 0:y.map(s=>e.jsxs(g.Option,{value:s.id,children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]},s.id))})}),e.jsx(f.Item,{className:"flex flex-col",label:"Company",name:"companyId",children:e.jsx(g,{bordered:!1,loading:C,className:"md:ml-5",children:j==null?void 0:j.map(s=>e.jsx(g.Option,{value:s.id,children:s.companyName},s.id))})}),e.jsx(f.Item,{label:"Amount",name:"amount",children:e.jsx(P,{bordered:!1,suffix:e.jsx(M,{}),className:"md:ml-5"})})]})]})})}):e.jsx(W,{})})}function ae({opportunityStage:l,currentStage:o}){const{id:a}=F(),x=D(),n=(l==null?void 0:l.length)-1,r=async d=>{(await x($({id:a,values:{opportunityStageId:d}}))).payload.message==="success"&&x(u(a))};return e.jsxs(Q,{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between items-center pb-3 gap-2",children:[e.jsxs("span",{className:"flex gap-2",children:[e.jsx("span",{className:"text-base font-bold",children:"START:"}),e.jsx("span",{className:"text-base font-normal",children:Y(o==null?void 0:o.opportunityCreateDate).format("MMMM Do YYYY")})]}),e.jsxs("span",{className:"text-base font-bold",children:["CLOSING:",e.jsxs("span",{className:"text-base font-normal",children:[" ",Y(o==null?void 0:o.opportunityCloseDate).format("MMMM Do YYYY")]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:l&&l.map((d,t)=>e.jsx("button",{className:`flex items-center justify-center p-2  shadow-sm text-sm font-medium  ${(o==null?void 0:o.opportunityStageId)===d.id?"bg-blue-500 text-white":"bg-gray-300 text-gray-700"} ${n!==t&&t!==0&&"stageBtn"}
              ${n===t&&"stageEndBtn"}
              ${t===0&&"stageStartBtn"}
              `,onClick:()=>r(d.id),disabled:(o==null?void 0:o.opportunityStageId)===d.id,children:d.opportunityStageName},d.id))})]})}function Le(){var b,s,w,R,L;const{id:l}=F(),[o,a]=p.useState(!1),x=D(),{opportunity:n,loading:r}=v(i=>i.opportunity),{list:d}=v(i=>i.opportunityStage);p.useEffect(()=>(x(u(l)),x(ee()),()=>{se()}),[x,l]);const t=p.useRef(null),h=p.useRef(null),I=p.useRef(null),j=p.useRef(null),C=p.useRef(null),y=p.useRef(null),k=()=>{const i=h.current,c=t.current,m=i.offsetTop-c.offsetTop;c.scrollTop=m},T=()=>{const i=I.current,c=t.current,m=i.offsetTop-c.offsetTop;c.scrollTop=m},N=()=>{const i=y.current,c=t.current,m=i.offsetTop-c.offsetTop;c.scrollTop=m},E=()=>{const i=C.current,c=t.current,m=i.offsetTop-c.offsetTop;c.scrollTop=m},O=()=>{const i=j.current,c=t.current,m=i.offsetTop-c.offsetTop;c.scrollTop=m};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative  w-full h-[calc(100vh-52.8px)] overflow-hidden flex flex-row",children:[e.jsx("div",{className:`hidden md:flex dark:bg-transparent bg-[#2A2D3E] dark:border-gray-50 border-primary hover:bg-primary  border-2 text-white absolute top-[10px] left-[225px] w-[30px] h-[30px] leading-[30px] rounded-full justify-center items-center z-30 duration-300  ${o?"top-[10px] left-[4px]":"top-[10px] md:left-[185px] 2xl:left-[225px]"}`,children:o?e.jsx(ne,{onClick:()=>a(!o),className:"text-[16px] cursor-pointer"}):e.jsx(oe,{onClick:()=>a(!o),className:"text-[16px] cursor-pointer"})}),e.jsx("div",{className:B("hidden md:block left-0 top-0 z-10  duration-300 h-screen  w-[200px] 2xl:w-[240px] bg-sideNavBg  text-white select-none",{"w-[20px] 2xl:w-[20px]":o}),children:!o&&e.jsxs("div",{className:"flex items-start flex-col gap-1 select-none",children:[e.jsxs("div",{onClick:N,className:"flex gap-3 items-center mt-12  px-5 py-2 font-semibold",children:["Tasks",e.jsx("span",{className:"px-1 bg-teal-700 text-white rounded-full",children:(b=n==null?void 0:n.crmTask)==null?void 0:b.length})]}),e.jsxs("div",{onClick:T,className:"flex gap-3 items-center  px-5 py-2 font-semibold",children:["Notes",e.jsx("span",{className:"px-1 bg-teal-700 text-white rounded-full",children:(s=n==null?void 0:n.note)==null?void 0:s.length})]}),e.jsxs("div",{onClick:O,className:"flex gap-3 items-center  px-5 py-2 font-semibold",children:["Attachments",e.jsx("span",{className:"px-1 bg-teal-700 text-white rounded-full",children:(w=n==null?void 0:n.attachment)==null?void 0:w.length})]}),e.jsxs("div",{onClick:k,className:"flex gap-3 items-center  px-5 py-2 font-semibold",children:["Emails",e.jsx("span",{className:"px-1 bg-teal-700 text-white rounded-full",children:(R=n==null?void 0:n.emails)==null?void 0:R.length})]}),e.jsxs("div",{onClick:E,className:"flex gap-3 items-center  px-5 py-2 font-semibold",children:["Quotes",e.jsx("span",{className:"px-1 bg-teal-700 text-white rounded-full",children:(L=n==null?void 0:n.quote)==null?void 0:L.length})]})]})}),e.jsxs("div",{ref:t,className:B(`flex flex-col w-full 2xl:w-[calc(100vw-240px)] md:w-[calc(100vw-200px)] duration-300 p-4
            scroll-smooth overflow-y-auto`,{"md:w-[calc(100vw-20px)] 2xl:w-[calc(100vw-20px)]":o}),children:[e.jsx(ae,{opportunityStage:d,currentStage:n}),e.jsx(te,{data:n,loading:r}),e.jsx(le,{data:n,loading:r}),e.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[e.jsx("div",{ref:y,children:e.jsx(z,{data:n,loading:r,name:"opportunityId",singleLoadThunk:u})}),e.jsx("div",{ref:I,className:"",children:e.jsx(G,{data:n,loading:r,name:"opportunityId",singleLoadThunk:u})}),e.jsx("div",{ref:j,children:e.jsx(S,{data:n,loading:r,name:"opportunityId",singleLoadThunk:u})}),e.jsx("div",{ref:h,children:e.jsx(V,{data:n,loading:r,name:"opportunityId",singleLoadThunk:u})}),e.jsx("div",{ref:C,children:e.jsx(_,{data:n,loading:r,name:"opportunityId",singleLoadThunk:u})})]})]})]})})}export{Le as default};
