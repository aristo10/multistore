import{cT as L,c_ as E,r as n,cL as T,cM as O,cS as v,cN as e,cO as V}from"./vendor-3a94a37a.js";import{b0 as _,aX as H,L as M,b1 as B}from"./index-ed7845ca.js";import{S as U}from"./SaleProductListCard-76fb09a1.js";import{P as X}from"./Payments-4aa4b64f.js";import{F as o,C as q,D as z,I as G}from"./vendor-large-f75deccb.js";const $=()=>{const{id:x}=L();let Q=E();const[c,h]=n.useState({}),[j,I]=n.useState(0),[S,y]=n.useState(!1),b=T(),g=O(t=>t.sales.sale),{singleSaleInvoice:d,returnSaleInvoice:m}=g||{},[i,f]=n.useState([]),[w,C]=n.useState(v()),[P]=o.useForm();n.useEffect(()=>{b(_(x))},[b,x]),n.useEffect(()=>{if(d){const t=d.saleInvoiceProduct.map(s=>{const r=m==null?void 0:m.map(l=>l.returnSaleInvoiceProduct.find(u=>u.productId===s.productId)).reduce((l,u)=>u?{productQuantity:l.productQuantity+u.productQuantity+u.damageQuantity}:l,{productQuantity:0}),a={...s};return r?(a.returnQuantity=0,a.productQuantity=s.productQuantity-r.productQuantity,a.damageQuantity=0):(a.returnQuantity=0,a.damageQuantity=0,a.remainQuantity=s.productQuantity),a});f(t)}},[m,d]);const R=async({note:t,paidAmount:s})=>{y(!0);const r={saleInvoiceId:x,note:t,instantReturnAmount:s||[],date:v(w._d).format(),returnSaleInvoiceProduct:Object.entries(c).map(([p,{value:A,damageQuantity:F}])=>({saleInvoiceProductId:parseInt(p),productQuantity:A,damageQuantity:F}))},a=r.returnSaleInvoiceProduct.filter(p=>p.productQuantity!==0&&p.productQuantity!==null),l={...r,returnSaleInvoiceProduct:a};(await B(l)).message==="success"&&Q(-1),y(!1)},D=n.useCallback(({id:t,value:s})=>{const r=i.find(a=>a.id===t);r&&(c[t]={...c[t],value:s},r.returnQuantity=s,f([...i]),h({...c}))},[c,i]),k=n.useCallback(({id:t,value:s})=>{const r=i.find(a=>a.id===t);r&&(c[t]={...c[t],damageQuantity:s},r.damageQuantity=s,f([...i]),h({...c}))},[c,i]),N=n.useCallback(()=>i.reduce((t,s)=>t+s.returnQuantity*s.productUnitSalePrice,0),[i]);return n.useEffect(()=>{I(N())},[i,N]),e.jsx("div",{children:e.jsx("div",{className:"mr-top",children:d?e.jsx(n.Fragment,{children:e.jsxs(q,{bordered:!1,className:"criclebox h-full m-3",children:[e.jsx("div",{className:" flex justify-between ",children:e.jsx("h5",{className:"text-xl",children:e.jsxs("span",{className:"mr-left",children:["Invoice : ",d.id]})})}),e.jsxs("div",{className:"",children:[e.jsx(U,{formData:c,updateReturn:!0,returnOnChange:D,updateDamage:k,list:i}),e.jsxs("div",{className:"flex justify-between card-body my-4",children:[e.jsx("div",{className:"mb-auto",children:e.jsxs("p",{className:"mr-left hidden",style:{backgroundColor:"#FDCCCC",padding:"10px",paddingRight:"20px",borderRadius:"2px"},children:["Total Return Amount :",e.jsxs("strong",{children:["  ",j||0]})]})}),e.jsx("div",{className:"max-w-[400px] min-w-[400px]",children:e.jsxs(o,{labelAlign:"right",initialValues:{date:V()},form:P,onFinish:R,autoComplete:"off",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Date: "}),e.jsx("div",{className:"w-[65%]",children:e.jsx(o.Item,{name:"date",className:"mb-0",children:e.jsx(z,{onChange:t=>C(t._d),style:{width:"100%"}})})})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Note: "}),e.jsx("div",{className:"w-[65%]",children:e.jsx(o.Item,{name:"note",className:"mb-0",children:e.jsx(G.TextArea,{placeholder:"Note"})})})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Paid Amount: "}),e.jsx("div",{className:"w-[65%] flex items-center justify-between gap-2",children:e.jsx(X,{})})]}),e.jsx(o.Item,{style:{marginTop:"20px"},className:"mb-2",children:e.jsx(H,{type:"submit",className:"bg-red-500 text-white hover:bg-red-600",block:!0,loading:S,children:"Make Return"})})]})})]})]})]})},d.id):e.jsx(M,{})})})};export{$ as default};
