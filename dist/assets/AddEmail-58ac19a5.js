import{r as d,cM as s,cL as P,cN as l,cU as Q}from"./vendor-3a94a37a.js";import{t as k,a as D,v as L,w as M,d as K,x as V,U as G,y as H,z as J}from"./index-ed7845ca.js";import{T as I}from"./TagInput-f33dd18b.js";import{textEditorModule as W,textEditorFormats as X}from"./AddProduct-aa890cea.js";import{F as o,b as i,I as f,a as C,c as Y,B as b}from"./vendor-large-f75deccb.js";function ae({onClose:x,createAs:a}){const[y,w]=d.useState([]),[g,q]=d.useState([]),[j,S]=d.useState(""),{list:t,loading:N}=s(e=>e.company),{list:r,loading:E}=s(e=>e.contact),{list:c,loading:v}=s(e=>e.opportunity),{list:m,loading:F}=s(e=>e.quote),{list:u,loading:O}=s(e=>e.users),{loading:T}=s(e=>e.email),{list:p}=s(e=>e.emailConfig),[h]=o.useForm(),n=P();d.useEffect(()=>{n(k()),n(D()),n(L()),n(M()),n(K({query:"all"})),n(V({}))},[n]);const R=async e=>{const z={...e,emailOwnerId:parseInt(e.emailOwnerId),companyId:parseInt(e.companyId),opportunityId:parseInt(e.opportunityId),contactId:parseInt(e.contactId),quoteId:parseInt(e.quoteId),cc:y,bcc:g,body:j};(await n(H(z))).payload.message==="success"&&(h.resetFields(),a!=null&&a.name?n(a.singleLoadThunk(a.value)):n(J({})),x())},B=()=>{h.resetFields(),x()},U=e=>{console.log("Failed:",e)};return l.jsx("div",{className:"flex justify-center mt-5",children:l.jsx(G,{permission:"create-email",children:l.jsxs(o,{className:"w-4/5",onFinish:R,onFinishFailed:U,colon:!1,layout:"vertical",form:h,initialValues:a?{[a==null?void 0:a.name]:a==null?void 0:a.value}:{},children:[l.jsx(o.Item,{style:{width:"100%"},label:"From",name:"emailConfigName",tooltip:"This is a required field",rules:[{required:!0,message:"From Email is Required."}],children:l.jsx(i,{style:{width:"100%"},placeholder:"From Email",children:p==null?void 0:p.map(e=>l.jsx(i.Option,{value:e.emailConfigName,children:e.emailUser},e.emailConfigName))})}),l.jsx(o.Item,{style:{width:"100%"},label:"To",name:"receiverEmail",tooltip:"This is a required field",rules:[{required:!0,message:"Receiver Email is Required."}],children:l.jsx(f,{placeholder:"Receiver Email"})}),l.jsx(o.Item,{style:{width:"100%"},label:"Subject",name:"subject",tooltip:"This is a required field",rules:[{required:!0,message:"Subject is Required."}],children:l.jsx(f,{placeholder:"Subject"})}),l.jsx(C,{bordered:!1,defaultActiveKey:["1"],expandIcon:({isActive:e})=>l.jsx(Y,{rotate:e?90:0}),className:"site-collapse-custom-collapse mb-4",children:l.jsxs(C.Panel,{header:"CC & BCC",children:[l.jsx(I,{label:"CC",tags:y,setTags:w}),l.jsx(I,{label:"BCC",tags:g,setTags:q})]},"1")}),l.jsx(o.Item,{style:{marginBottom:"25px"},label:"Body",name:"body",children:l.jsx(Q,{value:j,onChange:e=>S(e),modules:W,formats:X})}),l.jsx(o.Item,{label:"Email owner",name:"emailOwnerId",tooltip:"This is a required field",rules:[{required:!0,message:"Owner is Required."}],children:l.jsx(i,{style:{width:"100%"},loading:O,allowClear:!0,showSearch:!0,placeholder:"Select note owner name",children:u==null?void 0:u.map(e=>l.jsxs(i.Option,{value:e.id,children:[e==null?void 0:e.firstName," ",e==null?void 0:e.lastName]},e.id))})}),l.jsx(o.Item,{label:"Company",name:"companyId",children:l.jsx(i,{style:{width:"100%"},loading:N,allowClear:!0,showSearch:!0,placeholder:"Select company Name",disabled:(a==null?void 0:a.name)==="companyId",children:t==null?void 0:t.map(e=>l.jsx(i.Option,{value:e.id,children:e.companyName},e.id))})}),l.jsx(o.Item,{label:"Contact",name:"contactId",children:l.jsx(i,{style:{width:"100%"},loading:E,allowClear:!0,showSearch:!0,placeholder:"Select contact",disabled:(a==null?void 0:a.name)==="contactId",children:r==null?void 0:r.map(e=>l.jsx(i.Option,{value:e.id,children:e.fullName?e.fullName:e.firstName+" "+e.lastName},e.id))})}),l.jsx(o.Item,{label:"Opportunity",name:"opportunityId",children:l.jsx(i,{style:{width:"100%"},loading:v,allowClear:!0,showSearch:!0,placeholder:"Select opportunity",disabled:(a==null?void 0:a.name)==="opportunityId",children:c==null?void 0:c.map(e=>l.jsx(i.Option,{value:e.id,children:e.opportunityName},e.id))})}),l.jsx(o.Item,{label:"Quote",name:"quoteId",children:l.jsx(i,{style:{width:"100%"},loading:F,allowClear:!0,showSearch:!0,placeholder:"Select quote",disabled:(a==null?void 0:a.name)==="quoteId",children:m==null?void 0:m.map(e=>l.jsx(i.Option,{value:e.id,children:e.quoteName},e.id))})}),l.jsx(o.Item,{label:"",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(b,{size:"large",htmlType:"submit",type:"primary",loading:T,children:"Create"}),l.jsx(b,{size:"large",htmlType:"submit",type:"danger",onClick:B,children:"Cancel"})]})})]})})})}export{ae as A};
