import{cL as T,r as m,cM as w,cN as e,cU as O,cV as z,cQ as E,db as I,dm as R}from"./vendor-3a94a37a.js";import{aZ as _,d as U,aP as $,c1 as H,w as L,C as G,U as K,T as Z,s as J}from"./index-ed7845ca.js";import{V as W}from"./ViewBtn-ffc9b5cb.js";import{C as X}from"./CreateDrawer-a7af16b9.js";import{s as ee}from"./emailConfigSlice-145edc06.js";import{p as se}from"./purchasePDF-c30bf5e1.js";import{u as te}from"./useCurrency-4b14dd3d.js";import{T as M}from"./TagInput-f33dd18b.js";import{F as a,I as D,a as V,c as ae,B as A,b as k,h as Y,j as le,P as ie,D as B,M as oe}from"./vendor-large-f75deccb.js";import"./invoiceGenerator-eaeb8720.js";import"./numberToWords-4c291141.js";function ne({invoiceId:x,setIsModalOpen:r,invoiceName:f}){const[b]=a.useForm(),v=T(),[N,p]=m.useState(!1),[h,j]=m.useState(""),[d,l]=m.useState([]),[o,c]=m.useState([]),g=w(n=>n.purchases.purchase),y=w(n=>{var u;return(u=n==null?void 0:n.setting)==null?void 0:u.data})||null,{currencySymbol:t}=te()||{},{singlePurchaseInvoice:s}=g||{},C=async n=>{p(!0);try{let u=new FormData;const Q=await se(s,y,"Purchase Invoice",t);u.append("receiverEmail",n.receiverEmail),u.append("subject",n.subject),u.append("body",h),u.append("files[]",Q,"OrderInvoice.pdf"),d.forEach(F=>{u.append("cc[]",F)}),o.forEach(F=>{u.append("bcc[]",F)}),(await v(ee(u))).payload.message==="success"&&(r(!1),p(!1))}catch(u){console.log(u)}p(!1)},q=n=>{j(n)},P={toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{list:"ordered"},{list:"bullet"}],["bold","italic","underline"],["link","image"],[{color:[]},{background:[]}],["clean"]]},i=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","color","background"],S=()=>{};return m.useEffect(()=>{!y&&v(_())}),e.jsxs("div",{className:"py-4 px-4 border-t",children:[e.jsxs("p",{className:"text-[16px] text-red-500 p-4",children:["If send ",f," invoice without the customerâ€˜s default email"]}),e.jsxs(a,{onFinish:C,onFinishFailed:S,colon:!1,layout:"vertical",form:b,children:[e.jsx(a.Item,{style:{width:"100%"},label:"To",name:"receiverEmail",children:e.jsx(D,{placeholder:"Receiver Email"})}),e.jsx(V,{bordered:!1,defaultActiveKey:["1"],expandIcon:({isActive:n})=>e.jsx(ae,{rotate:n?90:0}),className:"site-collapse-custom-collapse mb-4",children:e.jsxs(V.Panel,{header:"CC & BCC",children:[e.jsx(M,{label:"CC",tags:d,setTags:l}),e.jsx(M,{label:"BCC",tags:o,setTags:c})]},"1")}),e.jsx(a.Item,{style:{width:"100%"},label:"Subject",name:"subject",children:e.jsx(D,{placeholder:"Subject"})}),e.jsx(a.Item,{style:{marginBottom:"25px"},label:"Body",children:e.jsx(O,{value:h,onChange:q,modules:P,formats:i})}),e.jsx(a.Item,{children:e.jsx(A,{loading:N,size:"large",htmlType:"submit",type:"primary",children:"Send"})})]})]})}function re({form:x,productList:r,productLoading:f,totalCalculator:b,subTotal:v}){const N=(p,h)=>{const j=x.getFieldValue("quoteProduct"),d=r.find(o=>o.id===p);d.productQuantity===0&&z.error("Product is out of stock");const l=j.map((o,c)=>c===h?{...o,productQuantity:d.productQuantity?1:0,unitPrice:d.productSalePrice}:o);x.setFieldsValue({quoteProduct:l}),b(h)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsx("div",{className:"col-span-1 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"SL"}),e.jsx("div",{className:"col-span-4 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Product"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Quantity"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Price"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs sm:text-sm",children:"Total"}),e.jsx("div",{className:"col-span-1 md:text-base xxs:text-xs sm:text-sm",children:"Delete"})]}),e.jsx("hr",{style:{backgroundColor:"black",marginTop:"0.5rem"}}),e.jsx(a.List,{name:"quoteProduct",rules:[{required:!0,message:"Product is required"}],children:(p,{add:h,remove:j})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-[300px] overflow-y-auto overflow-x-hidden mt-2",children:p.map(({key:d,name:l,...o},c)=>{var g,y;return e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsx("div",{className:"col-span-1",children:c+1}),e.jsx("div",{className:"col-span-4",children:e.jsx(a.Item,{...o,name:[l,"productId"],rules:[{required:!0,message:"Product is required"}],children:e.jsx(k,{placeholder:"Select Product",showSearch:!0,loading:f,optionFilterProp:"children",filterOption:(t,s)=>s.children.toLowerCase().includes(t.toLowerCase()),onChange:t=>{N(t,c)},children:r==null?void 0:r.map(t=>e.jsx(k.Option,{value:t.id,children:t.name},t.id))})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(a.Item,{...o,name:[l,"productQuantity"],rules:[{required:!0,message:"quantity is required"}],children:e.jsx(Y,{style:{width:"100%"},size:"small",placeholder:"Quantity",onChange:()=>b(c)})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(a.Item,{...o,name:[l,"unitPrice"],rules:[{required:!0,message:"Price is required"}],children:e.jsx(Y,{size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>b(c)})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs mt-2",children:((y=(g=v[c])==null?void 0:g.subPrice)==null?void 0:y.toFixed(2))||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx(a.Item,{children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center bg-red-600 text-white p-2 rounded-md",onClick:()=>{j(l),b(c)},children:e.jsx(le,{className:""})})})})]},d)})}),e.jsx(a.Item,{style:{marginTop:"20px"},children:e.jsx(A,{type:"dashed",onClick:()=>h(),block:!0,icon:e.jsx(ie,{}),children:"Add Product"})})]})})]})}function de(){const[x]=a.useForm(),r=T(),[f,b]=m.useState([]),[v,N]=m.useState(0),[p,h]=m.useState(0),[j,d]=m.useState(!1),l=w(t=>t.users.list),{list:o,loading:c}=w(t=>t.products),g=()=>{const t=x.getFieldValue("quoteProduct"),s=(t==null?void 0:t.reduce((P,i)=>{const S=(i==null?void 0:i.productQuantity)||0,n=(i==null?void 0:i.unitPrice)||0,Q=((i==null?void 0:i.productVat)||0)/100*n*S;return[...P,{subVat:(i==null?void 0:i.productVat)||0,subPrice:n*S+Q}]},[]))||[];b(s);const C=s.reduce((P,i)=>P+i.subPrice,0)||0;N(C);const q=C&&C-(x.getFieldValue("discount")||0)||0;h(q)};m.useEffect(()=>{r(U({query:"all"})),r($({page:1,count:10}))},[r]);const y=async t=>{d(!0),(await r(H(t))).payload.message=="success"&&(r(L({status:!0,page:1,count:10})),x.resetFields()),d(!1)};return e.jsx("div",{className:"px-5",children:e.jsxs(a,{form:x,name:"dynamic_form_nest_item",onFinish:y,onFinishFailed:()=>{},size:"large",autoComplete:"off",layout:"vertical",children:[e.jsxs("div",{className:"-mt-5 flex justify-between gap-8",children:[e.jsx(a.Item,{label:"Quote Name",name:"quoteName",className:"w-full",rules:[{required:!0,message:"Please input quote name!"}],children:e.jsx(D,{})}),e.jsx(a.Item,{label:"Quote Owner",name:"quoteOwnerId",className:"w-full",rules:[{required:!0,message:"Please input quote owner!"}],children:e.jsx(k,{className:"w-full",loading:!l,showSearch:!0,placeholder:"Select a customer ",optionFilterProp:"children",filterOption:(t,s)=>s.children.toLowerCase().includes(t.toLowerCase()),children:l&&(l==null?void 0:l.map(t=>e.jsx(k.Option,{value:t.id,children:t.username},t.id)))})})]}),e.jsxs("div",{className:"-mt-5 flex justify-between gap-8",children:[e.jsx(a.Item,{label:"Quote Date",name:"quoteDate",className:"w-full",rules:[{required:!0,message:"Please input quote date!"}],children:e.jsx(B,{placeholder:"Select Quotation date"})}),e.jsx(a.Item,{label:"Expiration date",name:"expirationDate",className:"w-full",rules:[{required:!0,message:"Please input quote expire date!"}],children:e.jsx(B,{placeholder:"Select Expiration Date"})})]}),e.jsx("div",{className:"-mt-5",children:e.jsx(a.Item,{label:"Terms And Conditions",name:"termsAndConditions",className:"w-full",rules:[{required:!0,message:"Please input quote terms and conditions!"}],children:e.jsx(D,{placeholder:"Terms"})})}),e.jsx("div",{className:"-mt-5 ",children:e.jsx(a.Item,{label:"Description",name:"description",className:"w-full",rules:[{required:!0,message:"Please input quote description!"}],children:e.jsx(D.TextArea,{placeholder:"description",rows:3})})}),e.jsx(re,{form:x,totalCalculator:g,subTotal:f,productList:o,productLoading:c}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between my-1 text-[16px] font-medium",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"pr-2",children:v.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center my-1text-[16px] font-medium",children:[e.jsx("span",{children:"Discount:"}),e.jsx(a.Item,{name:"discount",children:e.jsx(Y,{className:"mt-4",onChange:()=>g()})})]}),e.jsxs("div",{className:"flex justify-between my-1 text-[16px] font-medium",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{className:"pr-2",children:p.toFixed(2)})]})]}),e.jsx("div",{className:"",children:e.jsx(a.Item,{style:{marginTop:"15px"},children:e.jsx(A,{block:!0,type:"primary",htmlType:"submit",loading:j,children:"Create Quotation"})})})]})})}function Ne(){const x=T(),[r,f]=m.useState(!1),[b,v]=m.useState(),{list:N,loading:p,total:h}=w(s=>s.quote),{list:j}=w(s=>s.users),[d,l]=m.useState({page:1,count:10,status:"true"}),o=[{id:1,title:"ID",dataIndex:"id",key:"id",render:s=>e.jsx(E,{to:`/admin/quotation/${s}`,children:s}),renderCsv:s=>s},{id:2,title:"Name",dataIndex:"quoteName",key:"quoteName"},{id:3,title:"Owner",dataIndex:"quoteOwner",key:"quoteOwner",render:s=>e.jsx(E,{to:`/admin/hrm/staff/${s==null?void 0:s.id}`,children:s==null?void 0:s.username}),renderCsv:s=>s==null?void 0:s.username},{id:4,title:"Quotation Date",dataIndex:"quoteDate",key:"quoteDate",render:s=>I(s).format("YYYY-MM-DD"),renderCsv:s=>I(s).format("YYYY-MM-DD")},{id:5,title:"Expiration Date",dataIndex:"expirationDate",key:"expirationDate",render:s=>I(s).format("YYYY-MM-DD"),renderCsv:s=>I(s).format("YYYY-MM-DD")},{id:6,title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount"},{id:7,title:"Description",dataIndex:"description",key:"description",render:s=>J(s,20)},{id:8,title:"Create Date",dataIndex:"createdAt",key:"createdAt",render:s=>I(s).format("YYYY-MM-DD"),renderCsv:s=>I(s).format("YYYY-MM-DD")},{id:8,title:"Action",key:"action",render:({id:s})=>[{label:e.jsx(W,{title:"View",path:`/admin/quotation/${s}`}),key:"view"},{label:e.jsxs("div",{onClick:()=>{g(),v(s)},className:"flex gap-2  items-center cursor-pointer",children:[e.jsx(R,{className:"text-[1rem]"}),"Email"]}),key:"SendEmail"}],csvOff:!0}],c=[{key:"quoteOwnerId",label:"Quote Owner",type:"select",options:j==null?void 0:j.map(s=>({label:s==null?void 0:s.username,value:s==null?void 0:s.id})),className:"min-w-[123px] max-w-[150px]",popupClassName:"w-[200px]"},{key:"status",label:"Status",type:"select",options:[{label:"Show",value:"true"},{label:"Hide",value:"false"}],className:"min-w-[85px] max-w-[150px]",popupClassName:"w-[200px]"}];m.useEffect(()=>{x(L(d))},[x,d]);const g=()=>{f(!0)},y=()=>{f(!1)},t=()=>{f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Quotation",extra:e.jsx(X,{permission:"create-quote",title:"Create Quotation",width:70,children:e.jsx(de,{})}),children:e.jsx(K,{permission:"readAll-quote",children:e.jsx(Z,{total:h,columns:o,list:N,loading:p,setPageConfig:l,title:"Quote List",isSearch:!0,filters:c})})}),e.jsx(oe,{title:"Send Quotation Invoice",open:r,onOk:y,onCancel:t,footer:!1,children:e.jsx(ne,{invoiceName:"Quotations",invoiceId:b,setIsModalOpen:f})})]})}export{Ne as default};
