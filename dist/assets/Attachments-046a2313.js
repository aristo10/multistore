import{cN as e,cQ as f,r as g,cS as S,cL as F,cM as I,cO as M,dz as V}from"./vendor-3a94a37a.js";import{U as p,C as T,am as A,de as E,df as $,G as K,H as z,I as G,t as R,a as J,v as X,w as Z,d as O,f_ as ee,f$ as se}from"./index-ed7845ca.js";import{A as te}from"./AddEmail-58ac19a5.js";import{e as C,C as ne,a as v,P as k,M as re,E as de,F as y,I as P,b as u,D as q,B as Q}from"./vendor-large-f75deccb.js";import{A as le,D as ie}from"./DetailsNote-cf259519.js";import{A as ae}from"./AddQuote-b08df3aa.js";import{A as oe}from"./AddTask-88f11895.js";import{A as ce}from"./AddAttachment-08320204.js";function xe({email:t,setSingleEmail:d}){var l,a,c,o,h,s,x,i,r,j,b;const m=()=>{d(!1)};return e.jsx(e.Fragment,{children:e.jsx(p,{permission:"readSingle-email",children:e.jsx(C,{title:"Email",open:!!t,onClose:m,width:1e3,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex justify-evenly items-center gap-10 border-b py-2",children:[(t==null?void 0:t.contact)&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Contact"}),e.jsxs(f,{to:`/admin/crm/contact/${(l=t.contact)==null?void 0:l.id}`,children:[(a=t.contact)==null?void 0:a.firstName," ",(c=t.contact)==null?void 0:c.lastName]})]}),(t==null?void 0:t.company)&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Company"}),e.jsx(f,{to:`/admin/crm/company/${(o=t.company)==null?void 0:o.id}`,children:(h=t.company)==null?void 0:h.companyName})]}),(t==null?void 0:t.opportunity)&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Opportunity"}),e.jsx(f,{to:`/admin/crm/opportunity/${(s=t.opportunity)==null?void 0:s.id}`,children:(x=t.opportunity)==null?void 0:x.opportunityName})]}),(t==null?void 0:t.quote)&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Quote"}),e.jsx(f,{to:`/admin/crm/quote/${(i=t.quote)==null?void 0:i.id}`,children:(r=t.quote)==null?void 0:r.quoteName})]})]}),e.jsxs("div",{className:"border-t border-b px-5 py-3",children:["To ",e.jsx("span",{className:"font-bold ml-2",children:t==null?void 0:t.receiverEmail})]}),e.jsxs(v,{className:"bg-transparent",bordered:!1,defaultActiveKey:[],children:[!!((j=t==null?void 0:t.cc)!=null&&j.length)&&e.jsx(v.Panel,{header:"CC",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:t.cc.map((D,N)=>e.jsxs("span",{children:[D.ccEmail,N!==t.cc.length-1&&","]},N))})},"1"),!!((b=t==null?void 0:t.bcc)!=null&&b.length)&&e.jsx(v.Panel,{header:"BCC",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:t.bcc.map((D,N)=>e.jsxs("span",{children:[D.bccEmail,N!==t.bcc.length-1&&","]},N))})},"2")]}),e.jsxs("div",{className:"border-t border-b px-5 py-3",children:["Subject: ",e.jsx("span",{className:"font-bold ml-2",children:t==null?void 0:t.subject})]}),e.jsx(v,{bordered:!1,className:"bg-transparent",defaultActiveKey:["1"],children:e.jsx(v.Panel,{header:"Body",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:t==null?void 0:t.body}})},"1")})]})})})})}function Ce({ref:t,data:d,loading:m,name:l,singleLoadThunk:a}){const[c,o]=g.useState(!1),[h,s]=g.useState(),x=()=>{o(!1)},i=[{title:"Subject",key:"Subject",render:r=>{var j;return r?e.jsx("div",{className:"cursor-pointer",onClick:()=>s(r),children:((j=r.subject)==null?void 0:j.length)>20?r.subject.slice(0,20):r.subject}):"-"},sorter:(r,j)=>r.subject.localeCompare(j.subject)},{title:"Owner",dataIndex:"emailOwner",key:"owner",render:(r,j)=>e.jsxs(f,{to:`/admin/hrm/staff/${j==null?void 0:j.emailOwnerId}`,children:[r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]})},{title:"Status",key:"emailStatus",dataIndex:"emailStatus",render:r=>e.jsx("span",{className:"text-green-600",children:"Sent"})},{title:"Create date",key:"Create date",dataIndex:"createdAt",render:r=>S(r).format("MMMM Do YYYY")}];return e.jsxs(T,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Emails"}),e.jsx(p,{permission:"create-email",children:e.jsx(k,{onClick:()=>o(!0),className:"bg-primary text-white cursor-pointer rounded-sm text-[14px] p-[2px]"})})]}),bodyStyle:{padding:0},children:[e.jsx("div",{children:e.jsx(p,{permission:"readAll-email",children:e.jsx(A,{bordered:!0,columns:i,loading:m,data:d?d.emails:[],pagination:{hideOnSinglePage:!0},scroll:{x:800,y:300}})})}),e.jsx(p,{permission:"readSingle-email",children:e.jsx(C,{onClose:x,open:c,title:"Create Quote",width:window.innerWidth<=768?"100%":"45%",placement:"right",children:e.jsx(te,{createAs:{name:l,value:d==null?void 0:d.id,singleLoadThunk:a}})})}),e.jsx(p,{permission:"readSingle-email",children:e.jsx(xe,{email:h,setSingleEmail:s})})]})}function ve({data:t,loading:d,name:m,singleLoadThunk:l}){const a=F(),{edit:c}=I(i=>i.note),[o,h]=g.useState(!1),s=()=>{h(!1)},x=[{title:"Title",key:"title",dataIndex:"title",render:(i,r)=>e.jsx("span",{className:"cursor-pointer",onClick:()=>a($(r)),children:i})},{title:"Owner",dataIndex:"noteOwner",key:"owner",render:(i,r)=>e.jsxs(f,{to:`/admin/hrm/staff/${r==null?void 0:r.noteOwnerId}`,children:[i==null?void 0:i.firstName," ",i==null?void 0:i.lastName]})},{title:"Description",key:"description",dataIndex:"description",render:i=>i?`${i.slice(0,30)}...`:"-"},{title:"Create date",key:"Create date",dataIndex:"createdAt",render:i=>S(i).format("MMMM Do YYYY")},{id:5,title:"",key:"action",render:i=>[{label:e.jsx("span",{className:"cursor-pointer",onClick:()=>a($(i)),children:e.jsxs("button",{className:"flex justify-center items-center gap-2 rounded",children:[e.jsx(de,{})," View"]})}),key:"view"}],csvOff:!0}];return e.jsxs(T,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Notes"}),e.jsx(p,{permission:"create-quote",children:e.jsx(k,{onClick:()=>h(!0),className:"bg-primary text-white cursor-pointer rounded-sm text-[14px] p-[2px]"})})]}),children:[e.jsx("div",{children:e.jsx(p,{permission:"readAll-note",children:e.jsx(A,{columns:x,loading:d,data:t?t.note:[]})})}),e.jsx(p,{permission:"create-quote",children:e.jsx(C,{onClose:s,open:o,title:"Create Note",width:window.innerWidth<=768?"100%":"45%",placement:"right",children:e.jsx("div",{className:"mt-4",children:e.jsx(le,{createAs:{values:{[m]:t==null?void 0:t.id},singleLoadThunk:l,id:t==null?void 0:t.id,name:m}})})})}),e.jsx(p,{permission:"readSingle-note",children:e.jsx(re,{footer:null,open:c,onCancel:()=>a(E()),width:window.innerWidth>768?"60%":"100%",closeIcon:null,children:e.jsx(ie,{note:c,onClose:()=>a(E()),load:()=>a(l(t.id))})})})]})}function Se({data:t,loading:d,name:m,singleLoadThunk:l}){const[a,c]=g.useState(!1),o=()=>{c(!1)},h=[{title:"Name",key:"quoteName",render:({quoteName:s,id:x})=>e.jsx(f,{to:`/admin/crm/quote/${x}`,children:s})},{title:"Owner",dataIndex:"quoteOwner",render:(s,x)=>e.jsxs(f,{to:`/admin/hrm/staff/${x==null?void 0:x.quoteOwnerId}`,children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]})},{title:"Quotation Date",dataIndex:"quoteDate",render:s=>S(s).format("MMMM Do YYYY")},{title:"Expiration Date",dataIndex:"expirationDate",render:s=>S(s).format("MMMM Do YYYY")},{title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount"},{title:"Create Date",dataIndex:"createdAt",render:s=>S(s).format("MMMM Do YYYY")}];return e.jsxs(T,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Quotes"}),e.jsx(p,{permission:"create-quote",children:e.jsx(k,{onClick:()=>c(!0),className:"bg-primary text-white cursor-pointer rounded-sm text-[14px] p-[2px]"})})]}),bodyStyle:{padding:0},children:[e.jsx("div",{children:e.jsx(p,{permission:"readAll-quote",children:e.jsx(A,{bordered:!0,columns:h,loading:d,data:t?t.quote:[]})})}),e.jsx(p,{permission:"create-quote",children:e.jsx(C,{onClose:o,open:a,title:"Create Quote",width:window.innerWidth<=768?"100%":"45%",placement:"right",children:e.jsx("div",{className:"mt-4",children:e.jsx(ae,{onClose:o,open:a,createAs:{name:m,value:t==null?void 0:t.id,singleLoadThunk:l}})})})})]})}function pe({onClose:t,task:d,id:m}){const l=F(),[a]=y.useForm(),{list:c,loading:o}=I(n=>n.company),{list:h,loading:s}=I(n=>n.contact),{list:x,loading:i}=I(n=>n.opportunity),{list:r,loading:j}=I(n=>n.quote),{list:b,loading:D}=I(n=>n.priority),{list:N,loading:W}=I(n=>n.taskType),{list:Y,loading:_}=I(n=>n.taskStatus),{list:B,loading:U}=I(n=>n.users);g.useEffect(()=>{l(K()),l(z()),l(G()),l(R()),l(J()),l(X()),l(Z()),l(O({query:"all"}))},[l]);const L=async n=>{const H={...n,assigneeId:parseInt(n.assigneeId),companyId:parseInt(n.companyId),contactId:parseInt(n.contactId),opportunityId:parseInt(n.opportunityId),quoteId:parseInt(n.quoteId),priorityId:parseInt(n.priorityId),crmTaskStatusId:parseInt(n.crmTaskStatusId),taskTypeId:parseInt(n.taskTypeId)};(await l(ee({id:m,values:H}))).payload.message==="success"&&(l(se(m)),t())},w=n=>{a.resetFields(),console.log("Failed:",n),t()};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-center mt-5",children:e.jsxs(y,{className:"w-4/5",form:a,colon:!1,layout:"vertical",onFinish:L,onFinishFailed:w,initialValues:{name:(d==null?void 0:d.name)||"",assigneeId:(d==null?void 0:d.assigneeId)||"",contactId:(d==null?void 0:d.contactId)||"",companyId:(d==null?void 0:d.companyId)||"",opportunityId:(d==null?void 0:d.opportunityId)||"",quoteId:(d==null?void 0:d.quoteId)||"",taskTypeId:(d==null?void 0:d.taskTypeId)||"",crmTaskStatusId:(d==null?void 0:d.crmTaskStatusId)||"",priorityId:(d==null?void 0:d.priorityId)||"",description:(d==null?void 0:d.description)||"",startDate:M(d==null?void 0:d.startDate)||"",endDate:M(d==null?void 0:d.endDate)||""},children:[e.jsxs("div",{children:[e.jsx(y.Item,{style:{width:"100%"},label:"Task Name",name:"name",children:e.jsx(P,{})}),e.jsx(y.Item,{style:{width:"100%"},className:"flex flex-col",label:"Assign",name:"assigneeId",tooltip:"Change the owner of this Task",children:e.jsx(u,{style:{width:"100%"},loading:U,children:B.map(n=>e.jsxs(u.Option,{value:n.id,children:[n==null?void 0:n.firstName," ",n==null?void 0:n.lastName]},n.id))})}),e.jsx(y.Item,{label:"Start date",name:"startDate",children:e.jsx(q,{})}),e.jsx(y.Item,{label:"End date",name:"endDate",children:e.jsx(q,{})}),e.jsx(y.Item,{className:"flex flex-col",label:"Task Type",name:"taskTypeId",tooltip:"Change the task type of this task",children:e.jsx(u,{style:{width:"100%"},loading:W,children:N==null?void 0:N.map(n=>e.jsx(u.Option,{value:n.id,children:n.taskTypeName},n.id))})}),e.jsx(y.Item,{className:"flex flex-col",label:"Task Priority",name:"priorityId",tooltip:"Change the task priority of this task",children:e.jsx(u,{style:{width:"100%"},loading:b,children:b==null?void 0:b.map(n=>e.jsx(u.Option,{value:n.id,children:n.name},n.id))})}),e.jsx(y.Item,{className:"flex flex-col",label:"Task Status",name:"crmTaskStatusId",tooltip:"Change the task status of this task",children:e.jsx(u,{style:{width:"100%"},loading:_,children:Y==null?void 0:Y.map(n=>e.jsx(u.Option,{value:n.id,children:n.taskStatusName},n.id))})}),e.jsx(y.Item,{className:"flex flex-col",label:"Company",name:"companyId",tooltip:"Change the company of this task",children:e.jsx(u,{style:{width:"100%"},loading:o,children:c==null?void 0:c.map(n=>e.jsx(u.Option,{value:n.id,children:n.companyName},n.id))})}),e.jsx(y.Item,{className:"flex flex-col",label:"Contact",name:"contactId",tooltip:"Change the contact of this task",children:e.jsx(u,{style:{width:"100%"},loading:s,children:h==null?void 0:h.map(n=>e.jsxs(u.Option,{value:n.id,children:[n==null?void 0:n.firstName," ",n==null?void 0:n.lastName]},n.id))})}),e.jsx(y.Item,{className:"flex flex-col",label:"Opportunity",name:"opportunityId",tooltip:"Change the opportunity of this task",children:e.jsx(u,{style:{width:"100%"},loading:i,children:x==null?void 0:x.map(n=>e.jsx(u.Option,{value:n.id,children:n.opportunityName},n.id))})}),e.jsx(y.Item,{className:"flex flex-col",label:"Quote",name:"quoteId",tooltip:"Change the quote of this task",children:e.jsx(u,{style:{width:"100%"},loading:j,children:r==null?void 0:r.map(n=>e.jsx(u.Option,{value:n.id,children:n.quoteName},n.id))})}),e.jsx(y.Item,{style:{width:"100%"},label:"Description",name:"description",children:e.jsx(P,{})})]}),e.jsx(y.Item,{children:e.jsxs("div",{className:"flex items-center justify-evenly gap-3",children:[e.jsx(Q,{block:!0,type:"primary",htmlType:"submit",children:"Save"}),e.jsx(Q,{block:!0,type:"danger",onClick:w,children:"Cancel"})]})})]})})})}function he({open:t,onClose:d,id:m,task:l}){return e.jsx(e.Fragment,{children:e.jsx(C,{width:window.innerWidth<=768?"100%":"35%",title:"Update Task",placement:"right",onClose:d,open:t,children:e.jsx(pe,{onClose:d,id:m,task:l})})})}function Te({data:t,loading:d,name:m,singleLoadThunk:l}){const[a,c]=g.useState(!1),[o,h]=g.useState(!1),s=()=>{c(!1)},x=()=>{h(!1)},i=[{title:"Name",dataIndex:"name",key:"TaskName",render:(r,j)=>r?e.jsx(f,{to:`/admin/crm/task/${j.id}`,children:r}):"-"},{title:"Assignee",dataIndex:"assignee",key:"assignee",render:r=>r!=null&&r.firstName?e.jsxs(f,{to:`/admin/hrm/staff/${r==null?void 0:r.id}`,children:[r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]}):"-"},{title:"Type",dataIndex:"taskType",key:"taskType",render:r=>r.taskTypeName?r.taskTypeName:"-"},{title:"Status",dataIndex:"crmTaskStatus",key:"taskType",render:r=>r.taskStatusName?r.taskStatusName:"-"},{title:"priority",dataIndex:"priority",key:"taskType",render:r=>r.name?r.name:"-"},{title:"Description",dataIndex:"description",key:"Description",render:r=>r||"-"},{title:"Action",dataIndex:"id",key:"id",render:(r,j)=>e.jsx("span",{onClick:()=>h(j),className:"bg-teal-500 p-1 cursor-pointer w-8 h-8 flex justify-center items-center rounded",children:e.jsx(V,{className:"text-white"})})}];return e.jsxs(T,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Tasks"}),e.jsx(p,{permission:"create-quote",children:e.jsx(k,{onClick:()=>c(!0),className:"bg-primary text-white cursor-pointer rounded-sm text-[14px] p-[2px]"})})]}),bodyStyle:{padding:0},children:[e.jsx("div",{children:e.jsx(p,{permission:"readAll-crmTask",children:e.jsx(A,{bordered:!0,columns:i,loading:d,data:t?t.tasks:[],pagination:{hideOnSinglePage:!0},scroll:{x:800,y:500}})})}),e.jsx(p,{permission:"update-crmTask",children:e.jsx(he,{open:o,task:o,id:o==null?void 0:o.id,onClose:x})}),e.jsx(p,{permission:"create-crmTask",children:e.jsx(C,{onClose:s,open:a,title:"Create Task",width:window.innerWidth<=768?"100%":"45%",placement:"right",children:e.jsx(oe,{onClose:s,open:a,createAs:{name:m,value:t==null?void 0:t.id,singleLoadThunk:l}})})})]})}function Ae({data:t,loading:d,name:m,singleLoadThunk:l}){const[a,c]=g.useState(!1),o=()=>{c(!1)},h=[{title:"Name",key:"attachmentName",render:({attachmentName:s,attachmentPath:x})=>e.jsx(f,{target:"_blank",to:window.env.VITE_APP_API+"media/view/"+x,children:s}),renderCsv:({attachmentName:s})=>s},{title:"Owner",dataIndex:"attachmentOwner",key:"attachmentOwner",render:s=>e.jsx(f,{to:`/admin/hrm/staff/${s==null?void 0:s.id}`,children:s==null?void 0:s.fullName}),renderCsv:s=>`${s==null?void 0:s.firstName} ${s==null?void 0:s.fullName}`},{title:"Company",key:"company",dataIndex:"company",render:s=>e.jsx(f,{to:`/admin/crm/company/${s==null?void 0:s.id}`,children:s==null?void 0:s.companyName}),renderCsv:s=>s.companyName},{title:"Contact",key:"contact",dataIndex:"contact",render:s=>e.jsxs(f,{to:`/admin/crm/contact/${s==null?void 0:s.id}`,children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),renderCsv:s=>`${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}`},{title:"Opportunity",key:"opportunity",dataIndex:"opportunity",render:s=>e.jsx(f,{to:`/admin/crm/opportunity/${s==null?void 0:s.id}`,children:s==null?void 0:s.opportunityName}),renderCsv:s=>s==null?void 0:s.opportunityName},{title:"Quote",key:"quote",dataIndex:"quote",render:s=>e.jsx(f,{to:`/admin/crm/quote/${s==null?void 0:s.id}`,children:s==null?void 0:s.quoteName}),renderCsv:s=>s.quoteName},{title:"Create date",key:"Create date",dataIndex:"createdAt",render:s=>M(s).format("DD/MM/YYYY"),renderCsv:s=>M(s).format("DD/MM/YYYY")}];return e.jsxs(T,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"Attachments"}),e.jsx(p,{permission:"create-quote",children:e.jsx(k,{onClick:()=>c(!0),className:"bg-primary text-white cursor-pointer rounded-sm text-[14px] p-[2px]"})})]}),bodyStyle:{padding:0},children:[e.jsx("div",{children:e.jsx(p,{permission:"readAll-attachment",children:e.jsx(A,{bordered:!0,columns:h,loading:d,data:t?t.attachment:[],pagination:{hideOnSinglePage:!0},scroll:{x:800,y:300}})})}),e.jsx(p,{permission:"create-attachment",children:e.jsx(C,{onClose:o,open:a,title:"Create Quote",width:window.innerWidth<=768?"100%":"45%",placement:"right",children:e.jsx(ce,{onClose:o,open:a,createAs:{name:m,value:t==null?void 0:t.id,singleLoadThunk:l}})})})]})}export{Ae as A,Ce as E,ve as N,Se as Q,Te as T};
