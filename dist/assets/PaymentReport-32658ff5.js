import{cM as y,cL as R,cS as D,cN as e,r as M,cO as C,cQ as A}from"./vendor-3a94a37a.js";import{aX as N,ac as I,fr as P,fu as T,C as F,c6 as k}from"./index-ed7845ca.js";import{R as L}from"./ReportTable-b23b8ac7.js";import{i as $}from"./invoiceGenerator-eaeb8720.js";import{n as O}from"./numberToWords-4c291141.js";import{u as E}from"./useCurrency-4b14dd3d.js";import{F as x,b as j,D as S}from"./vendor-large-f75deccb.js";function v({data:o,title:l,type:c,info:n,payInfo:s,btnName:d}){const{currencyName:m}=E()||{},i=y(a=>{var f;return(f=a==null?void 0:a.setting)==null?void 0:f.data})||null;R(),O(Math.round((o==null?void 0:o.totalAmount)-(o==null?void 0:o.discount)));const r=[],Y=[{label:"Total",value:` ${n!=null&&n.totalAmount?n.totalAmount:0}`}],b=["SL","Date","Invoice No","Customer","Account No","Method","TRX Id","Amount"],t=o.map((a,f)=>{var w,g;return[`${f+1}`,D(a==null?void 0:a.createdAt).format("DD-MM-YYYY"),a==null?void 0:a.cartOrderId,(w=a.customer)==null?void 0:w.username,a==null?void 0:a.customerAccount,(g=a==null?void 0:a.paymentMethod)==null?void 0:g.methodName,a==null?void 0:a.customerTransactionId,`${a!=null&&a.amount?a.amount:0}`]}),h=[{value:`Customer: ${s!=null&&s.customer?s.customer:"All"}`},{value:`Payment Method: ${s!=null&&s.method?s.method:"All"}`}],u=[{value:`Report Date: ${D().format("YYYY-MM-DD")}`},{value:`Currency: ${m}`}],p={jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:12,bottomLeftFontSize:8,footerFontSize:10};return e.jsx("div",{className:"flex gap-2",children:e.jsx(N,{className:"bg-primary flex justify-center items-center px-4 py-2 text-white rounded",onClick:()=>$(c,{title:l,TopRightInfo:u,companyInfo:i,customerInfo:h,bottomLeftContent:r,bottomRightContent:Y,tableBody:t,tableHead:b,settings:p}),children:d})})}function z({setPageConfig:o,pageConfig:l,setShowTable:c}){const n=R(),{list:s,loading:d}=y(t=>t.customers),{list:m,loading:i}=y(t=>t.paymentMethod),[r,Y]=M.useState(!1),b=async t=>{Y(!0),(await n(T({...t,startDate:t.startDate.format("YYYY-MM-DD"),endDate:t.endDate.format("YYYY-MM-DD"),query:"report"}))).payload.message==="success"&&c(!0),Y(!1)};return M.useEffect(()=>{n(I({query:"all"})),n(P({query:"all"}))},[n]),e.jsx("div",{className:"flex flex-col items-center gap-2 md:p-4 rounded bg-white w-full md:w-1/3",children:e.jsxs(x,{layout:"vertical",className:"w-full",initialValues:{startDate:C(l.startDate,"YYYY-MM-DD"),endDate:C(l.endDate,"YYYY-MM-DD")},onFinish:b,children:[e.jsxs("div",{className:"w-full flex gap-2",children:[e.jsx(x.Item,{label:"Select Payment Method",name:"paymentMethodId",className:"w-1/2",children:e.jsx(j,{placeholder:"All",loading:i,allowClear:!0,showSearch:!1,style:{width:"100%"},maxTagCount:0,onChange:t=>o(h=>{var u;return{...h,method:(u=m.find(p=>p.id===t))==null?void 0:u.methodName}}),children:m==null?void 0:m.map(t=>e.jsx(j.Option,{value:t.id,children:t==null?void 0:t.methodName},t.id))})}),e.jsx(x.Item,{label:"Select Customer",name:"customerId",className:"w-1/2",children:e.jsx(j,{placeholder:"All",loading:d,allowClear:!0,showSearch:!1,style:{width:"100%"},maxTagCount:0,onChange:t=>o(h=>{var u;return{...h,customer:(u=s.find(p=>p.id===t))==null?void 0:u.username}}),children:s==null?void 0:s.map(t=>e.jsx(j.Option,{value:t.id,children:t==null?void 0:t.username},t.id))})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x.Item,{label:"From",name:"startDate",className:"w-1/2",children:e.jsx(S,{onChange:t=>o({...l,startDate:t.format("YYYY-MM-DD")})})}),e.jsx(x.Item,{label:"To",name:"endDate",className:"w-1/2",children:e.jsx(S,{onChange:t=>o({...l,endDate:t.format("YYYY-MM-DD")})})})]}),e.jsx(x.Item,{children:e.jsx(N,{loading:r,type:"submit",className:"w-full bg-green-500 text-white rounded p-2",children:"Generate Report"})})]})})}function W(){const[o,l]=M.useState(!1),{list:c,loading:n,info:s}=y(r=>r.manualPayment),[d,m]=M.useState({startDate:D().startOf("month").format("YYYY-MM-DD"),endDate:D().endOf("month").format("YYYY-MM-DD"),customer:null,method:null}),i=[{id:1,title:"Invoice No",dataIndex:"cartOrderId",key:"cartOrderId",render:r=>e.jsx(A,{to:`/admin/order/${r}`,children:r})},{id:2,title:"Customer",dataIndex:"customer",key:"customer",render:r=>e.jsx(A,{to:`/admin/hrm/staff/${r.id}`,children:r.username})},{id:3,title:"Account No",dataIndex:"customerAccount",key:"customerAccount",render:r=>r||"-"},{id:4,title:"Amount",dataIndex:"amount",key:"amount"},{id:5,title:"Method",dataIndex:"paymentMethod",key:"paymentMethod",render:r=>r.methodName},{id:6,title:"TRX ID",dataIndex:"customerTransactionId",key:"customerTransactionId",render:r=>r||"-"},{id:7,title:"Created At",dataIndex:"createdAt",key:"createdAt",render:r=>D(r).format("YYYY-MM-DD")}];return e.jsx("div",{className:"card card-custom mt-3 ",children:e.jsx("div",{className:"card-body",children:e.jsx(F,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Payment Report",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between p-5 items-start ",children:[e.jsx("div",{children:e.jsx(N,{onClick:()=>l(r=>!r),className:"bg-green-500 text-white",children:"Generate Again"})}),e.jsxs("div",{className:"flex px-5 items-center gap-2 ",children:[e.jsx(v,{data:c,info:s,payInfo:d,title:"Payment Report",pageConfig:d,type:"print",btnName:"Print"}),e.jsx(v,{data:c,payInfo:d,title:"Payment Report",info:s,pageConfig:d,type:"download",btnName:"Export PDF"}),e.jsx("div",{children:e.jsx(k,{className:"bg-primary text-white ",list:c,columns:i,title:"Payment Report",btnName:"Export CSV",children:"Export CSV"})})]})]}),e.jsx(L,{list:c,columns:i,loading:n})]}):e.jsx(z,{setPageConfig:m,pageConfig:d,setShowTable:l})})})})}export{W as default};
