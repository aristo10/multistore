import{cN as s,cS as j,cL as I,r as d,cM as C,da as z,cX as Y,cU as O,cT as U,dt as W}from"./vendor-3a94a37a.js";import{am as X,aZ as G,fp as H,gP as K,C as S,aX as V,L as Z}from"./index-ed7845ca.js";import{L as F}from"./List-9eb27318.js";import{T as J,a as _}from"./Tabs-8f68912a.js";import{N as q}from"./NewQuotationInvoice-63e8ba59.js";import{s as ee}from"./emailConfigSlice-145edc06.js";import{u as A}from"./useCurrency-4b14dd3d.js";import{F as b,I as T,a as P,c as te,i as se,B as ae,d as oe}from"./vendor-large-f75deccb.js";import{textEditorModule as le,textEditorFormats as ie}from"./AddProduct-aa890cea.js";import{T as E}from"./TagInput-f33dd18b.js";import{i as ne}from"./invoiceGenerator-eaeb8720.js";import{n as re}from"./numberToWords-4c291141.js";import"./ImageUploader-c0ae741f.js";import"./MediaGallery-5095f29f.js";import"./UploaderWithDrag-568744bd.js";import"./BigDrawer-240149a9.js";import"./AddManufacturer-2f6bafee.js";import"./AddProductBrand-894ab785.js";import"./UploadMany-c4472299.js";import"./AddProductSubcategory-71762def.js";import"./AddProductCategory-6511f02f.js";import"./AddUoM-1dc09ff9.js";import"./AddVatTax-97a0925d.js";import"./FormProductListCard-571d2cbc.js";import"./AddProductAttribute-4ec2c5fe.js";import"./AddProductAttributeValue-d16feddc.js";import"./AddDiscount-05e89f9a.js";const ce=[{title:"NAME",dataIndex:"product",render:t=>t.name,key:"product",tdClass:"whitespace-normal"},{title:"Unit Price",dataIndex:"unitPrice",key:"unitPrice"},{title:"Quantity",dataIndex:"productQuantity",key:"productQuantity"},{title:"Total",dataIndex:"productQuantity",render:(t,o)=>t*o.unitPrice,key:"total"}];function me({loading:t,list:o}){return s.jsx("div",{className:"m-2",children:s.jsx(X,{loading:t,columns:ce,data:(o==null?void 0:o.map(e=>({...e,key:e.id})))||[]})})}function de(t,o,e,u){var f;const c=[{label:"IN WORDS: ",value:`${re(Math.round(t.totalAmount-(t==null?void 0:t.discount))).toUpperCase()} ${u}`||""},{label:"Terms And Conditions: ",value:t!=null&&t.termsAndConditions?t.termsAndConditions:""}],r=[{label:"Total Amount:",value:`${t!=null&&t.totalAmount?Number(t.totalAmount).toFixed(2):0}`},{label:"Total discount:",value:`${t!=null&&t.discount?Number(t.discount).toFixed(2):0}`}],m=["SL","Product Name","Quantity","Unit Price","Total Price"],i=t.quoteProduct.map((n,v)=>[v+1,n.product.name,n.productQuantity,n.unitPrice,`${n.unitPrice*n.productQuantity}`]),p=[{value:`Quote Owner: ${t==null?void 0:t.quoteOwner.username}`},{value:`Quote Date: ${j(t.quoteDate).format("ll")}`}],x=[{value:`Quote Name: ${t==null?void 0:t.quoteName}`},{value:`Quote Stage: ${t.quoteStage.quoteStageName}`},{value:`Expiration Date: ${j((f=t.data)==null?void 0:f.expirationDate).format("ll")}`}];return ne(null,{title:e,TopRightInfo:x,customerInfo:p,companyInfo:o,bottomLeftContent:c,bottomRightContent:r,tableBody:i,tableHead:m,settings:{jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:7,footerFontSize:10},leftBottomSecondColumnX:45})}function ue({setSendEmail:t,body:o,invoice:e,subject:u,customerEmail:h}){const[c]=b.useForm(),r=I(),[m,i]=d.useState(!1),[p,x]=d.useState([]),[g,f]=d.useState([]),[n,v]=d.useState([]),{quote:N,loading:w}=C(a=>a.quote)||{},y=C(a=>{var l;return(l=a==null?void 0:a.setting)==null?void 0:l.data})||null,[Q,B]=d.useState(o),{currencyName:$}=A()||{},L=async a=>{i(!0);try{let l=new FormData;a.receiverEmail&&l.append("receiverEmail",a.receiverEmail),a.subject&&l.append("subject",a.subject),Q&&l.append("body",Q),p&&p.forEach(D=>{D.name===`Quote invoice - ${e.id} .pdf`?l.append("files[]",D.originFileObj,`Quote invoice - ${e.id} .pdf`):l.append("files[]",D.originFileObj)}),g.length>0&&l.append("cc[]",g),n.length>0&&l.append("bcc[]",n),(await r(ee(l))).payload.message==="success"&&(t(!1),i(!1),c.resetFields(),f([]),v([]),x(null))}catch(l){console.log(l)}i(!1)},M=()=>{};d.useEffect(()=>{!y&&r(G())},[y,r]);const R=a=>{x(a.fileList)};d.useEffect(()=>{N&&y&&x(a=>a.some(l=>l.name===`Quote invoice - ${e.id} .pdf`)?a:[...a,{name:`Quote invoice - ${e.id} .pdf`,originFileObj:de(N,y,"Quote Invoice",$)}])},[y,$,e.id,N]);const k=a=>{B(a)};return s.jsx(s.Fragment,{children:!w&&N&&s.jsxs("div",{className:"py-4 px-4 border-t",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("p",{className:""}),s.jsx("button",{onClick:()=>t(!1),className:"bg-red-100 p-1 rounded text-red-500",children:s.jsx(z,{size:20})})]}),s.jsxs(b,{onFinish:L,onFinishFailed:M,colon:!1,layout:"vertical",form:c,initialValues:{subject:u,body:o,receiverEmail:h},children:[s.jsx(b.Item,{style:{width:"100%"},label:"To",rules:[{required:!0,message:"Please input receiver email!"}],name:"receiverEmail",children:s.jsx(T,{placeholder:"Receiver Email"})}),s.jsx(P,{bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:a})=>s.jsx(te,{rotate:a?90:0}),className:"site-collapse-custom-collapse mb-4 ",children:s.jsxs(P.Panel,{header:"CC & BCC",children:[s.jsx(E,{label:"CC",tags:g,setTags:f}),s.jsx(E,{label:"BCC",tags:n,setTags:v})]},"1")}),s.jsx(b.Item,{style:{width:"100%"},label:"Subject",name:"subject",children:s.jsx(T,{placeholder:"Subject"})}),s.jsx(b.Item,{label:"Attachment",children:s.jsxs(se,{name:"files",fileList:p,onChange:R,multiple:!0,beforeUpload:()=>!1,children:[s.jsx("div",{className:"ant-upload-drag-icon flex justify-center my-2",children:s.jsx(Y,{size:30})}),s.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})}),s.jsx(b.Item,{style:{marginBottom:"25px"},label:"Body",children:s.jsx(O,{value:Q,onChange:k,modules:le,formats:ie})}),s.jsx(b.Item,{children:s.jsx(ae,{loading:m,size:"large",htmlType:"submit",type:"primary",children:"Send"})})]})]})})}function pe(t){var r;const{currencySymbol:o}=A()||{},e=C(m=>{var i;return(i=m==null?void 0:m.setting)==null?void 0:i.data})||null,u=H(o),h="Your Quote is Ready!",c=`
<div>Dear <strong>${(r=t==null?void 0:t.quoteOwner)==null?void 0:r.username}</strong>,</div>
<div>Greetings! We trust this message reaches you in great spirits. We are immensely grateful for the privilege of having you as our esteemed customer.</div>
<br>
<strong>Quote Information:</strong><br>
<p>Quote ID: ${t==null?void 0:t.id}</p>
<p>Quote Name: ${t==null?void 0:t.quoteName}</p>
<p>Quote Date: ${j(t==null?void 0:t.quoteDate).format("ll")}</p>
<p>Quote Expiration Date: ${j(t==null?void 0:t.expirationDate).format("ll")}</p>
<br>
<strong>Invoice Details:</strong><br>
Total Amount: ${u}${t!=null&&t.totalAmount?Number(t==null?void 0:t.totalAmount).toFixed(2):0} <br>
Discount: ${u}${t!=null&&t.discount?Number(t==null?void 0:t.discount).toFixed(2):0} <br>

<p>Best Regards,</p>
<p>${e==null?void 0:e.companyName}</p>
<p>${e==null?void 0:e.phone}</p>
<p>${e==null?void 0:e.email}</p>`;return{subject:h,body:c}}function Oe(){var i,p,x,g,f;const{id:t}=U(),o=I(),{quote:e,loading:u}=C(n=>n.quote)||{},[h,c]=d.useState(!1),{subject:r,body:m}=pe(e);return d.useEffect(()=>{o(K(t))},[o,t]),s.jsx(s.Fragment,{children:e?s.jsxs("div",{className:"flex gap-2 md:gap-4",children:[s.jsxs(S,{className:"w-2/3",bodyClass:"p-0",children:[s.jsx("div",{className:"flex justify-between mx-2 py-2 border-b items-center",children:s.jsxs("div",{className:" flex gap-3",children:[s.jsx("div",{children:s.jsx(q,{title:"Quotation",data:e})}),s.jsx(V,{className:"flex-row-reverse",color:"gray",icon:s.jsx(W,{size:15}),onClick:()=>c(!0),children:"Send"})]})}),h?s.jsx("div",{children:s.jsx(ue,{body:m,subject:r,setSendEmail:c,invoice:e})}):s.jsx(J,{className:"mt-4",children:s.jsx(_,{myKey:"products",label:s.jsxs("span",{children:["Product"," ",s.jsx("span",{className:"ml-2 rounded-full bg-slate-300 text-slate-700 px-1",children:(i=e==null?void 0:e.quoteProduct)==null?void 0:i.length})]}),children:s.jsx(me,{loading:u,list:e==null?void 0:e.quoteProduct})})})]}),s.jsxs("div",{className:"w-1/3 flex flex-col gap-2 md:gap-4",children:[s.jsx(S,{title:"Quote Info",children:s.jsx(F,{labelClassName:"w-[30%]",list:[{label:"Quote Name",value:e==null?void 0:e.quoteName},{label:"Quote Date",value:j(e==null?void 0:e.quoteDate).format("MMMM Do YYYY")},{label:"Expiration Date",value:j(e==null?void 0:e.expirationDate).format("MMMM Do YYYY")},{label:"Quote Stage",value:s.jsx(oe,{color:((p=e==null?void 0:e.quoteStage)==null?void 0:p.quoteStageName)==="Draft"?"blue":((x=e==null?void 0:e.quoteStage)==null?void 0:x.quoteStageName)==="Sent"?"green":((g=e==null?void 0:e.quoteStage)==null?void 0:g.quoteStageName)==="Accepted"?"gold":"red",children:(f=e==null?void 0:e.quoteStage)==null?void 0:f.quoteStageName}),hidden:!(e!=null&&e.quoteStage)}]})}),s.jsx(S,{title:"Price Summary",children:s.jsx(F,{labelClassName:"w-[30%]",list:[{label:"Total Amount",value:e==null?void 0:e.totalAmount},{label:"Discount",value:e==null?void 0:e.discount}]})}),s.jsx(S,{children:s.jsx(F,{labelClassName:"w-[40%] font-bold",list:[{label:"Terms And Conditions",value:e==null?void 0:e.termsAndConditions,className:"flex-col gap-1"},{label:"Description",value:e==null?void 0:e.description,className:"flex-col gap-1"}]})})]})]}):s.jsx(Z,{})})}export{Oe as default};
